<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>

    <script src="http://cdn.speedr.io/speeder.js"></script>
    <script>speeder('55730cc6','df9');</script>
    
    <meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
    <meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
    <meta name="y_key" content="265502be3db4fb6e" />

    <link rel="icon" type="image/png" href="../img/favicon.png">

    <title>Storing Data Submitted From a Form and Displaying Data from a Database - PHundamental PHP Best Practices -</title>

    <link href="../css/nyphp2.css" rel="stylesheet" media="screen" type="text/css" />
    <link href="../css/nyphp2_print.css" rel="stylesheet" media="print" type="text/css" />

    <meta name="robots" content="index,follow" />
    <meta name="description" content="Storing Data Submitted From a Form and Displaying Data from a Database - PHP best practices and LAMP stack strategy." />
    <meta name="author" content="Stackware Web Development - http://stackware.com" />
</head>


<body>


<div id="GlobalContainer">

    <div id="Header">
        
<div class="HeaderContainer">
    <div class="HeaderLeft">
        <a href="../index.html"><img src="../img/new_york_php.gif" alt="New York PHP User Group Community" /></a>
    </div>
    <div class="HeaderRight">
        <h1><a href="http://stackware.com/nyc-php-training">PHP Training</a></h1>
    </div>
    <div class="HeaderFirstBar" style="padding: 0; margin: 0 0 0 -6px;">
    <ul>
        <li>
            <a  href="../index.html" title="Home">Home</a>
        </li>
        <li>
            <a  href="../mailing-lists.html" title="PHP Mailing Lists">Mailing Lists</a>
        </li>
        <li>
            <a style="text-decoration: underline;" href="../phunny/err_sample_include.php.html" title="PHundamentals">PHundamentals</a>
        </li>
        <li>
            <a  href="../php-presentations/index.html" title="Presentations">Presentations</a>
        </li>
        <li>
            <a href="../php-presentations/82_Online-PHP-Forums.html" title="NY PHP Meetup">Contact Us</a>
        </li>
    </ul>
    </div>

    <div class="HeaderSecondBar">
        <div style="margin: 11px 0 0 -4px; padding: 0;">
        <small>don't forget to</small>
        <a style="font-weight: bold;" href="https://www.facebook.com/groups/367255050049061/">facebook friend</a> -
        <a style="font-weight: bold;" href="http://twitter.com/nyphp">twitter follow</a> -
        <a style="font-weight: bold;" href="../php-presentations/82_Online-PHP-Forums.html">NYC PHP meetup</a>
        </div>
    </div>
</div>



    </div>

    <div id="MainLayout">
    <div id="TwoColumn">
        <div id="LeftColumn">
            
<div class="LeftNav">

    <div class="NowLinks">


        <div class="ShowParticipation">
        <a href="../show-participation.html">Show Your Participation
        <img style="margin: 2px;" alt="NYPHP Member" src="../img/nyphporgmember.gif" />
        Click for Details</a>
        </div>

        <div style="height: 15px;"></div>

    </div>

    <div style="height: 15px;"></div>

<div class="LeftNavSection">

    <div class="LeftNavSubSection">
        <a target="_blank" href="https://www.meetup.com/tampa-bay-php/">
            <img width="120px" src="../img/tbphp.gif" alt="Tampa Bay Florida PHP" title="Tampa Bay Florida PHP" />
        </a>
        <a target="_blank" title="Tampa Bay Florida PHP" href="http://www.tbphp.org/">
            Tampa Bay<br />Florida PHP
        </a>
    </div>


    <div class="LeftNavSubSection">
        <a href="http://www.flickr.com/groups/nyphp/">
        <img src="../img/flickr.logo.gif" alt="NYPHP flickr Group" title="New York PHP flickr Group" />
        </a>
        Browse and upload photos of events, at the
        <a href="http://www.flickr.com/groups/nyphp/">NYPHP flickr Group</a>.
    </div>
    <div class="LeftNavSubSection">
        <a href="http://www.linkedin.com/e/gis/110439">
        <img src="../img/linkedin.logo.gif" alt="PHP Community" title="New York PHP Community LinkedIn" />
        </a>
        Link up with NYPHP at the
        <a href="http://www.linkedin.com/groups?about=&amp;gid=110439">PHP LinkedIn Group</a>.
    </div>

</div>


<div class="BoxLinks" style="text-align: left;">
    <p class="BoxLinkHeader">About NYPHP</p>
    <p><a href="../about-us/charter.html">&raquo; Charter</a></p>
    <p><a href="../about-us/mission.html">&raquo; Mission</a></p>
    <p><a href="../about-us/index.html">&raquo; What is NYPHP?</a></p>
    <p><a href="../about-us/principals.html">&raquo; Principals</a></p>
    <p><a href="../about-us/sponsors.html">&raquo; Sponsors</a></p>
</div>


</div>

            <div class="SubLeftColumn">
            
<div class="Event">

<h1>Functions for Storing Data Submitted From a Form and Displaying Data from a Database</h1>
<h2>NYPHP - <span style="color: rgb(0, 0, 153);">PH</span>undamentals</h2>

<p>
In this article we present our <em>best practice</em> for preparing data submitted from a form for use in an SQL query and
preparing that data for display in a browser.
</p>
<h3>Storing Data Submitted From a Form</h3>
<h3>1) mysql_escape_string, mysql_real_escape_string &amp; and other database-specific functions </h3>
<p>
	Storing data in a database requires <em>escaping</em> certain characters that could either be interpreted by the database engine as a command or
	that might generate an error.
	For example, say a user has entered into a form the following data:
	</p><pre>
	<em>My Dear Aunt Sally</em>
	</pre><p>
	Your PHP code might be something like:
	</p><pre>
	$SQL = &quot;INSERT INTO MyTable (MyColumn) VALUES ('{$_POST['MyData']}')&quot;;
	</pre><p>
	where $_POST['MyData'] holds the phrase <em>My Dear Aunt Sally</em>.
	<br />
	The resulting SQL statement will look like this:
	<br />
	</p><pre>
	INSERT INTO MyTable (MyColumn) VALUES ('My Dear Aunt Sally')
	</pre><p>
	Notice how the value is delimited by single quotes, thereby <em>marking</em> the
	beginning and ending of the value to be inserted into the table.

	But what happens if the value you want to insert is the following?
	</p><pre>
	<em>My Dear Aunt Sally's Picnic Basket</em>
	</pre><p>
	The resulting SQL statement will look like this:
	</p><pre>
	INSERT INTO MyTable (MyColumn) VALUES ('My Dear Aunt Sally's Picnic Basket')
	</pre><p>
	</p>
	<p>
	Notice that we now have <em>three</em> single quotes.
	The database engine will see the first single quote, the value
	<em>My Dear Aunt Sally</em> and will then see the second single quote.
	It will <em>assume</em> that the phrase <em>s Picnic Basket')</em> is part
	of -- what? The database engine doesn't know. It will then generate an error.
	Consequently, we need to <em>escape</em> the single quote that appears in the middle
	of the value. (See Note 1 below)
	</p>
	<p>
	PHP provides several different functions for handling this situation which is
	referred to as <em>escaping</em>. It is a method for marking certain characters
	so that they are not interpreted as part of a command.
	</p>
<p>
	<strong>Best Practice:</strong> Do <em>not</em> use the function <em>addslashes</em> but, instead, <strong>use a function that
	is specific to your database</strong> to escape special characters. (See Note 2 below) 
</p>


<ul>
	<li><strong>If you are using MySQL:</strong><br />
		Use <em>mysql_escape_string</em> if you are using a version of PHP prior to ver. 4.3.<br />
		Use <em>mysql_real_escape_string</em> if you are using PHP ver. 4.3 or better.<br />
		The former will escape more than just a single quote, double quote, backslash and NUL byte. The latter will take into account the character set
		of the connection that is in use.
		<br />
		For more information see <a href="http://php.net/mysql_escape_string" target="newwin">http://php.net/mysql_escape_string</a>.
		<br />
		For more information see <a href="http://php.net/mysql_real_escape_string" target="newwin">http://php.net/mysql_real_escape_string</a>.</li>
	<li><strong>If you are using PostgreSQL:</strong><br />
		Use <em>pg_escape_string</em>.
		<br />For more information see <a href="http://php.net/pg_escape_string" target="newwin">http://php.net/pg_escape_string</a>.</li>
	<li><strong>If you are using other databases:</strong><br />
		You might want to consider using something like ADOdb, specifically the <em>qstr</em> function or PEAR's <em>quote</em> function. 
		These libraries will also work well with MySQL, PostgreSQL and other databases.
		<br />For more information on ADOdb, see <a href="http://php.weblogs.com/ADOdb" target="newwin">http://php.weblogs.com/ADOdb</a>.
		<br />For more information on PEAR, see <a href="http://pear.php.net/" target="newwin">http://pear.php.net/</a>.</li>
</ul>

<p>
Here is an example using <em>mysql_escape_string</em>:
</p>
<p>	Assuming that $_POST['MyData'] is <em>My Dear Aunt Sally's Picnic Basket</em>
	and our code is the following:
	</p><pre>
	$data = mysql_escape_string($_POST['MyData']);
	$SQL = &quot;INSERT INTO MyTable (MyColumn) VALUES ('$data')&quot;;
	</pre><p>
	The resulting SQL statement will look like this:
	</p><pre>
	INSERT INTO MyTable (MyColumn) VALUES ('My Dear Aunt Sally\'s Picnic Basket')
	</pre><p>
	which is the desired result.
</p>

<h3>2) magic_quotes</h3>
<p><strong>What are magic_quotes and what's wrong with magic_quotes?</strong><br />
</p>
	<ol>
		<li><em>What are magic quotes?</em><br />
		Magic quotes is a PHP configuration that, when turned on, alters data <strong>before</strong> it becomes available to your script by prepending backslashes to characters that require escaping, such as single quote (&#39;), the double quote (&quot;), the backslash ( \ ), and NUL (the NUL byte with character code zero).
		In other words, it automatically <em>escapes</em> characters for you.</li>
		<li><em>What's wrong with using magic quotes?</em><br />
		The biggest problem with magic quotes is that it reduces the amount of control that the developer has over the data as it &quot;automagically&quot; manipulates your data without your being aware of it.
		For further information on the &quot;evils&quot; of magic quotes, see <a href="http://www.webmasterstop.com/tutorials/magic-quotes.shtml" target="newwin">http://www.webmasterstop.com/tutorials/magic-quotes.shtml</a>.</li>
	</ol>
<p>
<strong>Best Practice:</strong> <em>Turn off magic quotes!</em> There are three php.ini settings that relate to magic_quotes:
</p>

<ol>
	<li>
	<strong>magic_quotes_gpc</strong>:
	When turned on, PHP will alter the contents of the $_ENV, $_REQUEST, $_GET, $_POST, $_COOKIE and $_SERVER
	superglobal variables <em>automagically</em> if they contain a '(single quote), &quot;(double quote), \(backslash) and NUL's
	by adding a backslash before your script even gets to see them.
	</li>
	<li>
		<strong>magic_quotes_sybase</strong>:
		When turned on, the superglobals will instead be escaped 'sybase-style',
		which means that only single quotes are escaped, and this time with a second single quote instead of
		a backslash.  So, while <em>stripslashes</em> could be used to reverse the effect of <em>magic_quotes_gpc</em>,
		if <em>magic_quotes_sybase</em> is enabled, you would need to instead replace every instance of '' (2 single quotes) with '(1 single quote).
	</li>
	<li>
		<strong>magic_quotes_runtime</strong>:
		When turned on, this setting manipulates data returned from a database, text file, etc.
		and, therefore, requires the use of the <em>stripslashes</em> function to &quot;clean up&quot; data coming from a database
		or text file.</li>
</ol>
<p>
By turning off all three &quot;magic_quote&quot; settings, you <strong>eliminate</strong>:
</p>
<ul>
	<li>The possiblity of your data being stored with multiple backslashes.</li>
	<li>The need to replace two single quotes with one single quote (in the case of <em>magic_quotes_sybase</em>).</li>
	<li>The need to use the <em>stripslashes</em> function on data you retrieve from a form or database.</li>
</ul>
<p>
There are two ways to turn off these settings:
</p><ol>
	<li><strong>If you have control over the php.ini file</strong> you can set these configuration options to &quot;Off&quot;.</li>
	<li><strong>If you do <em>not</em> have control over the php.ini file</strong>, such as in the case of a shared server environment,
	you can use the function provided below. You would need to include this function in all of your scripts and it would need to be one of
	the very first functions called by your script.</li>
</ol>
<pre>
function fix_magic_quotes ($var = NULL, $sybase = NULL)
{
	// if sybase style quoting isn't specified, use ini setting
	if ( !isset ($sybase) )
	{
		$sybase = ini_get ('magic_quotes_sybase');
	}

	// if no var is specified, fix all affected superglobals
	if ( !isset ($var) )
	{
		// if magic quotes is enabled
		if ( get_magic_quotes_gpc () )
		{
			// workaround because magic_quotes does not change $_SERVER['argv']
			$argv = isset($_SERVER['argv']) ? $_SERVER['argv'] : NULL; 

			// fix all affected arrays
			foreach ( array ('_ENV', '_REQUEST', '_GET', '_POST', '_COOKIE', '_SERVER') as $var )
			{
				$GLOBALS[$var] = fix_magic_quotes ($GLOBALS[$var], $sybase);
			}

			$_SERVER['argv'] = $argv;

			// turn off magic quotes, this is so scripts which
			// are sensitive to the setting will work correctly
			ini_set ('magic_quotes_gpc', 0);
		}

		// disable magic_quotes_sybase
		if ( $sybase )
		{
			ini_set ('magic_quotes_sybase', 0);
		}

		// disable magic_quotes_runtime
		set_magic_quotes_runtime (0);
		return TRUE;
	}

	// if var is an array, fix each element
	if ( is_array ($var) )
	{
		foreach ( $var as $key => $val )
		{
			$var[$key] = fix_magic_quotes ($val, $sybase);
		}

		return $var;
	}

	// if var is a string, strip slashes
	if ( is_string ($var) )
	{
		return $sybase ? str_replace ('\'\'', '\'', $var) : stripslashes ($var);
	}

	// otherwise ignore
	return $var;
}

</pre><p>
The code above will strip the slashes from the superglobal arrays. It will then set all three ini settings to 0 (off), which will effectively simulate the server having all three settings turned off in the first place, and prevent your data from being mangled.
However, since the <em>ini_set</em> function does not permanently change the setting, it is necessary to call the function
at the beginning of each script.
</p>
<p>See: <a href="http://php.net/ini_set" target="newwin">http://php.net/ini_set</a>.
</p>
<h3>Retrieving Data For Display in a Browser</h3>
<p>
Once you have retrieved data from a database, you will want to display it.  But in the same way
that the data we were inserting into the database may contain characters which 'break' our
SQL, there may be characters which will 'break' our output, so we need to 'escape' (also called 'converting' or 'encoding')
our data for output.
</p>
<h3>1) htmlentities</h3>
<p>
The most common use of PHP is to display the data in an HTML page. However there are many
characters which will wreak havoc with HTML (called HTML 'entities' because
they have special meaning in HTML). <em>Htmlentities</em> will convert these characters to
their html-safe equivalents. The most notorious of these are the greater than (&gt;)
and less than (&lt;) characters.
</p>
<p>
<strong>Best Practice:</strong> Always use <em>htmlentities</em> for displaying data in a browser.
Do <em>not</em> use <em>htmlentities</em> for storing data. (See Note 3 below)</p>

<p>
For more information on <em>htmlentities</em> see <a href="http://php.net/htmlentities" target="newwin">http://php.net/htmlentities</a>.
</p>
<h3>2) htmlspecialchars</h3>
<p>
This function works in the same way as <em>htmlentities</em> but only converts a subset of the
HTML entities (single quotes, double quotes, ampersands, greater than (&gt;) and
less than (&lt;) characters).  In some situations this can be the desired behavior,
but most of the time you will want to use htmlentities.
</p>
<p>
For more information on <em>htmlspecialchars</em> see <a href="http://us3.php.net/htmlspecialchars" target="newwin">http://php.net/htmlspecialchars</a>.
</p>

<h3>Retrieving Data For Plain Text &amp; CSV Files</h3>
<h3>Plain Text &amp; CSV Files</h3>
<p>There are times when you will be retrieving data from a database which will <strong>not</strong>
be displayed in a browser but will, instead, be used for other purposes. Therefore, you
should <strong>not</strong> use <em>htmlentities</em> or <em>htmlspecialchars</em> when:
</p>
<ul>
	<li>You retrieve data from a database and you want to use it as plain text (in an internal report or e-mail message).
	</li>
	<li>You retrieve data from a database and you want to generate a CSV file. Just do the CSV encoding transformations with commas and quotes.
	</li>
</ul>
<h3>What Happened to Addslashes &amp; Stripslashes?</h3>
<p>
	You will notice that two commands - <em>addslashes</em> and <em>stripslashes</em> - are conspicuously absent
	from this article. If you follow our <strong>best practice</strong> recommendations, you will not need to use either of them with the one exception of <em>stripslashes</em> which is used in the <em>fix_magic_quotes</em> function.
</p>

<hr />
<h3>Notes</h3>
<p>
1- Handling embedded single quotes is not the only reason to <em>escape</em> certain characters. An equally important reason
for escaping characters is to prevent SQL Injection, that is, the technique whereby a malicious user may try to insert SQL commands
that may compromise the security of your web site. (The issue of SQL Injection will be examined in a future PHundamentals article. Though our
emphasis has been on MySQL, it is an issue with all databases.)
</p>
<p>2- The main reason for using <em>mysql_real_escape_string</em> instead of <em>addslashes</em> is that
the former will handle many more characters that require special handling.(See: <a href="http://www.mysql.com/doc/en/String_syntax.html" target="newwin">http://www.mysql.com/doc/en/String_syntax.html</a>.) 
Addslashes will only escape &quot; (double quote), ' (single quote) \ (backslash) and NUL (the null byte) with a backslash. <em>Mysql_real_escape_string</em> will 
take into account the character set of the current connection, and escape characters as 
needed.  However, both <em>mysql_escape_string</em> and <em>mysql_real_escape_string</em> will 
<em>additional</em> characters that have a special meaning to MySQL, such as:
</p>
<ul>
<li> \0 An ASCII 0 (NUL) character.</li>
<li> \' A single quote (`'') character.</li>
<li> \&quot; A double quote (`"') character. </li>
<li> \b A backspace character.</li>
<li> \n A newline character.</li>
<li> \r A carriage return character.</li>
<li> \t A tab character.</li>
<li> \z ASCII(26) (Control-Z). This character can be encoded to allow you to work around 
	the problem that ASCII(26) stands for END-OF-FILE on Windows. 
	(ASCII(26) will cause problems if you try to use mysql database &lt; filename.)</li>
<li> \\ A backslash (`\') character.</li>
</ul>
<p>
In addition, <em>mysql_real_escape_string</em> will encode any newlines into their encoded (\n or \r\n) counterpart.
<br />

<br />
All of the database-specific functions (e.g., <em>pg_escape_string</em>) include these kinds of special cases for the 
particular database, whereas <em>addslashes</em> does not.  
For simple data it will work, but there is the possibility you may end up in a situation 
where <em>addslashes</em> alone will fail.
</p>
<p>3- <strong>Best practice</strong> is to <strong>always</strong> store the data as &quot;display-agnostic&quot; thereby
assuring you the maximum amount of flexibility while maintaining the data in its &quot;raw&quot; state. Therefore, if you need to display the data in a browser,
you would use <em>htmlentities</em>. If the data is to be written to a CSV file, it can be 
retrieved as-is and then encoded accordingly with commas and quotes. 
</p>
<hr />
<p>Contributors to this note include the following:</p>
<ul>
<li>Dan Cech</li>
<li>Tim Gales</li>
<li>John Lacey</li>
<li>David Mintz</li>
<li>Chris Shiflett</li>
<li>David Sklar</li>
<li>Hans Zaunere</li>
<li>the PHundamentals team: Jeff Siegel, Mike Southwell</li>
</ul>

</div>


            </div>

        </div>
        <div id="RightColumn">
            

<div class="RightColumnContent">

   
   
       <div class="MiniCal" style="margin: 0px 0 15px 0;">

        <h2>RELATED ARTICLES</h2>
               <div class="MiniCalOdd">
            <p>
                <a title="From Zero to AMP with XAMPP - Installing PHP and MySQL on Windows with XAMPP" href="../PHundamentals/0_Zero-AMP-XAMPP-Installing-PHP-MySQL-Windows.html">From Zero to AMP with XAMPP - Installing PHP and MySQL on Windows with XAMPP</a>
            </p>
        </div>
               <div class="MiniCalEven">
            <p>
                <a title="PHP Initialization and php.ini" href="../PHundamentals/1_PHP-Initialization-phpini.html">PHP Initialization and php.ini</a>
            </p>
        </div>
               <div class="MiniCalOdd">
            <p>
                <a title="Virtual Hosting with PHP" href="../PHundamentals/2_Virtual-Hosting-PHP.html">Virtual Hosting with PHP</a>
            </p>
        </div>
               <div class="MiniCalEven">
            <p>
                <a title="PHP Site Structure: Where to Locate Includes?" href="../PHundamentals/3_PHP-Site-Structure-Where-Locate-Includes.html">PHP Site Structure: Where to Locate Includes?</a>
            </p>
        </div>
               <div class="MiniCalOdd">
            <p>
                <a title="Variable Evaluation in PHP" href="../PHundamentals/4_Variable-Evaluation-in-PHP.html">Variable Evaluation in PHP</a>
            </p>
        </div>
               <div class="MiniCalEven">
            <p>
                <a title="Storing Data Submitted From a Form and Displaying Data from a Database" href="../PHundamentals/5_Storing-Data-Submitted-Form-Displaying-Database.html">Storing Data Submitted From a Form and Displaying Data from a Database</a>
            </p>
        </div>
               <div class="MiniCalOdd">
            <p>
                <a title="Spoofed Form Submissions" href="../PHundamentals/6_Spoofed-Form-Submissions.html">Spoofed Form Submissions</a>
            </p>
        </div>
               <div class="MiniCalEven">
            <p>
                <a title="PHP Error Handling" href="../PHundamentals/7_PHP-Error-Handling.html">PHP Error Handling</a>
            </p>
        </div>
               <div class="MiniCalOdd">
            <p>
                <a title="Preventing Email Header Injection" href="../PHundamentals/8_Preventing-Email-Header-Injection.html">Preventing Email Header Injection</a>
            </p>
        </div>
    </div>
   


    <div class="RightColumnSubSection" style="text-align: center; margin: 35px 0 25px 0; ">
        <a href="http://cnvyr.io/">
        <img src="../img/cnvyrio.logo.sm.png" alt="CSS JS minify thumbnail maker online API" title="CSS JS minify thumbnail maker online API" />
        </a>
        <p><a href="http://cnvyr.io/">free PHP thumbnail maker CSS &amp; Javascript minify gzip pipeline online API and console</a>
        <br />
        <br />Free API and developer tools console for PageSpeed optimization.
        </p>
    </div>



   
</div>

        </div>
    </div>
    </div>

    <div id="Footer">
        
<div style="float: left;">
11.8</div>

<a href="http://www.meetup.com/new-york-php">NYC PHP Meetup Community </a>
    </div>

</div>

</body>
</html>

