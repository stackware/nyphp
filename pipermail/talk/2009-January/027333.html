<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] PHP Scope in foreach construct.
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20PHP%20Scope%20in%20foreach%20construct.&In-Reply-To=%3CC5A3640D.324F%25anthony%40thrillist.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027332.html">
   <LINK REL="Next"  HREF="027349.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] PHP Scope in foreach construct.</H1>
    <B>Anthony Wlodarski</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20PHP%20Scope%20in%20foreach%20construct.&In-Reply-To=%3CC5A3640D.324F%25anthony%40thrillist.com%3E"
       TITLE="[nycphp-talk] PHP Scope in foreach construct.">anthony at thrillist.com
       </A><BR>
    <I>Mon Jan 26 12:58:53 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="027332.html">[nycphp-talk] PHP Scope in foreach construct.
</A></li>
        <LI>Next message: <A HREF="027349.html">[nycphp-talk] PHP Scope in foreach construct.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27333">[ date ]</a>
              <a href="thread.html#27333">[ thread ]</a>
              <a href="subject.html#27333">[ subject ]</a>
              <a href="author.html#27333">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Brent,

Thanks for the feedback, we are going to do the XML file in batches but it is interesting to see that the memory from within the foreach never gets returned (tested with memory_get_usage).  Now there are a couple of other variables to assume with this application.  It is Drupal based so yeah there is bloat but we take that into consideration (our memory size is set to 128mb per operation) and we also assume that the postgresql db driver in Drupal is doing its job on not creating un necessary connections for each call to node_load() but we haven't dug that deep into the Drupal core for times sake.  But I didn't know you could use the variable in a foreach as a reference, I will have to take that into consideration when being a memory conservationist in the future.

-Anthony
--
Anthony Wlodarski
www.thrillist.com &lt;<A HREF="http://www.thrillist.com">http://www.thrillist.com</A>&gt;
Web Applications Developer
568 Broadway Ste. 605
New York, NY, 10012
(o) 646.786.1944


________________________________
From: Brent Baisley &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">brenttech at gmail.com</A>&gt;
Reply-To: NYPHP Talk &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
Date: Mon, 26 Jan 2009 09:50:38 -0800
To: NYPHP Talk &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
Subject: Re: [nycphp-talk] PHP Scope in foreach construct.

foreach makes a copy of the array element you are processing. If the
current &quot;value&quot; is large, like another array, then you have 2 large
arrays. Use a for loop instead or use a reference for the value
variable:
foreach ( $array as &amp;$value ) ...

If you are running into memory problems, you probably should rethink
how you are processing the data. You should process it in chunks and
stream it out to the XML file. Then it does matter how large the data
set gets.

You can also just adjust the php memory limit if you haven't done that
already. It defaults to 8MB or 16MB (5.2).

Use memory_get_usage to see where your memory is jumping.

Hope that helps.

Brent Baisley

On Mon, Jan 26, 2009 at 12:27 PM, Anthony Wlodarski
&lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">anthony at thrillist.com</A>&gt; wrote:
&gt;<i> When working with foreach constructs do the functions and variables defined
</I>&gt;<i> get returned to the garbage collector on each iteration or does the foreach
</I>&gt;<i> have to finish execution before things can be returned to the garbage
</I>&gt;<i> collector?
</I>&gt;<i>
</I>&gt;<i> The reason that I ask is because we are generating data for Google Maps and
</I>&gt;<i> they require one very large XML file which keeps blowing our memory size
</I>&gt;<i> definition inside the php.ini file.  What we might end up doing is creating
</I>&gt;<i> the XML file in batches of lets say 500 items or less and then append the
</I>&gt;<i> files manually.
</I>&gt;<i>
</I>&gt;<i> I figured this was an interesting question and I can't find any answers
</I>&gt;<i> anywhere else (even on php.net docs).
</I>&gt;<i>
</I>&gt;<i> -Anthony
</I>&gt;<i> --
</I>&gt;<i> Anthony Wlodarski
</I>&gt;<i> www.thrillist.com &lt;<A HREF="http://www.thrillist.com">http://www.thrillist.com</A>&gt;
</I>&gt;<i> Web Applications Developer
</I>&gt;<i> 568 Broadway Ste. 605
</I>&gt;<i> New York, NY, 10012
</I>&gt;<i> (o) 646.786.1944
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> New York PHP User Group Community Talk Mailing List
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;<i>
</I>_______________________________________________
New York PHP User Group Community Talk Mailing List
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>

<A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20090126/77eff66d/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20090126/77eff66d/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027332.html">[nycphp-talk] PHP Scope in foreach construct.
</A></li>
	<LI>Next message: <A HREF="027349.html">[nycphp-talk] PHP Scope in foreach construct.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27333">[ date ]</a>
              <a href="thread.html#27333">[ thread ]</a>
              <a href="subject.html#27333">[ subject ]</a>
              <a href="author.html#27333">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
