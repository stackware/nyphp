<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Bullet proofing &quot;rmdir&quot; command
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2003-August/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Bullet%20proofing%20%22rmdir%22%20command&In-Reply-To=%3CNFBBJNKBNKCIKGKJIFPJOEGHGIAA.sklar%40sklar.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004607.html">
   <LINK REL="Next"  HREF="004613.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Bullet proofing &quot;rmdir&quot; command</H1>
    <B>David Sklar</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Bullet%20proofing%20%22rmdir%22%20command&In-Reply-To=%3CNFBBJNKBNKCIKGKJIFPJOEGHGIAA.sklar%40sklar.com%3E"
       TITLE="[nycphp-talk] Bullet proofing &quot;rmdir&quot; command">sklar at sklar.com
       </A><BR>
    <I>Tue Aug 12 09:56:50 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="004607.html">[nycphp-talk] Bullet proofing &quot;rmdir&quot; command
</A></li>
        <LI>Next message: <A HREF="004613.html">[nycphp-talk] Bullet proofing &quot;rmdir&quot; command
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4608">[ date ]</a>
              <a href="thread.html#4608">[ thread ]</a>
              <a href="subject.html#4608">[ subject ]</a>
              <a href="author.html#4608">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Where is $sSubDir set? If it's set by users, then before either call to
rmdir() you should canonicalize the pathname with realpath() and then make
sure that the canonicalized pathname has the correct prefix.

For example:

// The directory under which image-storage subdirectories can be created
$sImagePrefix = '/www/some/place/images';

$sSubDir = realpath($sSubDir);
if ($sSubDir &amp;&amp; ($sImagePrefix == dirname($sImageName)) {
  for ($i = 0; $i &lt; 5; $i++) {
    $sImageName = $sSubDir . &quot;image$i.jpg&quot;;
    if (file_exists($sImageName)) { unlink($sImageName); }
  }
  unlink($sSubDir);
}

realpath() returns false if the canonicalized pathname doesn't exist.

David


On Tuesday, August 12, 2003 9:45 AM,  wrote:

&gt;<i> Great! Thanks!
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>
</I>&gt;<i> [mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>] On Behalf Of pswebcode, nyc
</I>&gt;<i> Sent: Tuesday, August 12, 2003 8:41 AM To: 'NYPHP Talk'
</I>&gt;<i> Subject: RE: [nycphp-talk] Bullet proofing &quot;rmdir&quot; command
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> //Delete subdir
</I>&gt;<i> if(file_exists($sSubDir) &amp;&amp; $sSubDir!=&quot;.&quot; &amp;&amp; $sSubDir != &quot;..&quot;){
</I>&gt;<i> rmdir($sSubDir); }
</I>&gt;<i>
</I>&gt;<i> ...better.
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>
</I>&gt;<i> [mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>] On Behalf Of Jeff
</I>&gt;<i> Sent: Tuesday, August 12, 2003 9:27 AM
</I>&gt;<i> To: 'NYPHP Talk'
</I>&gt;<i> Subject: [nycphp-talk] Bullet proofing &quot;rmdir&quot; command
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have a specific subdirectory on my site where users can upload
</I>&gt;<i> images files associated with some text stored in a database. The
</I>&gt;<i> question concerns deleting those uploaded images. Deleting the record
</I>&gt;<i> is the easy part...even deleting the images and subdirectory is easy.
</I>&gt;<i> However, my concern is what precautions should I take to make sure
</I>&gt;<i> that the wrong subdir (or the whole site!!) doesn't get blown away.
</I>&gt;<i> In the code below I'm using file_exists to delete the images and
</I>&gt;<i> subdir but is there anything else that I should do to bullet proof
</I>&gt;<i> the procedure?
</I>&gt;<i>
</I>&gt;<i> //Note: $sSubDir is the subdirectory path stored in the corresponding
</I>&gt;<i> MySQL record.
</I>&gt;<i>
</I>&gt;<i> //Delete images
</I>&gt;<i> for($i=0;$i&lt;5;$i++){
</I>&gt;<i> 		$sImageName = $sSubDir . &quot;image$i.jpg&quot;;
</I>&gt;<i> 		if(file_exists($sImageName)){
</I>&gt;<i> 			unlink($sImageName);
</I>&gt;<i> 		}
</I>&gt;<i> 	}
</I>&gt;<i> //Delete subdir
</I>&gt;<i> if(file_exists($sSubDir)){
</I>&gt;<i> 	rmdir($sSubDir);
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> Jeff
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> talk mailing list
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> talk mailing list
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> talk mailing list
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004607.html">[nycphp-talk] Bullet proofing &quot;rmdir&quot; command
</A></li>
	<LI>Next message: <A HREF="004613.html">[nycphp-talk] Bullet proofing &quot;rmdir&quot; command
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4608">[ date ]</a>
              <a href="thread.html#4608">[ thread ]</a>
              <a href="subject.html#4608">[ subject ]</a>
              <a href="author.html#4608">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
