<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] need another pair of eyes!
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20need%20another%20pair%20of%20eyes%21&In-Reply-To=%3C5986AA64-9CC6-4929-A7F6-E5BFA1336421%40o2group.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026259.html">
   <LINK REL="Next"  HREF="026262.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] need another pair of eyes!</H1>
    <B>Tim Lieberman</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20need%20another%20pair%20of%20eyes%21&In-Reply-To=%3C5986AA64-9CC6-4929-A7F6-E5BFA1336421%40o2group.com%3E"
       TITLE="[nycphp-talk] need another pair of eyes!">tim_lists at o2group.com
       </A><BR>
    <I>Wed Jul 23 18:21:16 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026259.html">[nycphp-talk] need another pair of eyes!
</A></li>
        <LI>Next message: <A HREF="026262.html">[nycphp-talk] need another pair of eyes!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26260">[ date ]</a>
              <a href="thread.html#26260">[ thread ]</a>
              <a href="subject.html#26260">[ subject ]</a>
              <a href="author.html#26260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I suppose you could try just rendering the page, along with your  
hidden form that automagically submits... something like:

--BEGIN--
&lt;?PHP
	if (! empty($_POST['txid']) &amp;&amp; ! !empty($_POST['pdfid'])){
		//Send headers and PDF data
		die();
	}
?&gt;
&lt;html&gt;&lt;head&gt;...
&lt;script type=&quot;text/javascript&quot;&gt;
doDownload=function(){
	document.getElementById('secretForm').submit();
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body onload=&quot;doDownload();&quot;&gt;
Hi, and thanks.

Here's yer file.
&lt;form id=&quot;secretForm&quot; action=&quot;&quot; method=&quot;POST&quot;&gt;
&lt;input type=&quot;hidden&quot; name=&quot;txid&quot; value=&quot;&lt;?PHP echo $txid; ?&gt;&quot; /&gt;
&lt;inpu type=&quot;hidden&quot; name=&quot;pdfid&quot; value=&quot;&lt;?PHP echo $pdfid; ?&gt; /&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;

--END--

So the first time through (with no posted txid and pdfid) you just  
get the page, which as soon as it loads everything, submits it's own  
hidden form back to itself (posting txid and pdfid).

I believe, without testing, that if your headers are correct, most or  
all browsers will just do their standard &quot;download a file&quot; behavior,  
and continue to display your content from the first request.  But you  
should test thoroughly.

-Tim

On Jul 23, 2008, at 4:11 PM, Kristina Anderson wrote:

&gt;<i> Hi Tim -- is there any way to get it to work by submitting the form
</I>&gt;<i> twice and then including the file with the headers/pdf content?
</I>&gt;<i>
</I>&gt;<i> thanks.
</I>&gt;<i>
</I>&gt;&gt;<i> So why not approach it like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	1) Redirect back from paypal.  Display whatever text you need.
</I>&gt;&gt;<i> 	2) Include in that page a good ole &quot;Your download should start
</I>&gt;&gt;<i> momentarily, if not, &lt;a ...&gt;click here&lt;/a&gt;
</I>&gt;&gt;<i> 	3) Include a hidden iframe pointing at an empty page
</I>&gt;&gt;<i> 	4) Include a hidden form that targets the iframe
</I>&gt;&gt;<i> 	5) Use javascript to trigger to form submit
</I>&gt;&gt;<i> 	6) Whatever the form-handler script is, I'm assuming it's the
</I>&gt;<i> bit
</I>&gt;&gt;<i> that outputs some headers and then emits the PDF content.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This seems to be close to what you're trying to do, but with the
</I>&gt;&gt;<i> addition of the iframe.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Tim
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Jul 23, 2008, at 3:52 PM, Kristina Anderson wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The situation is this...the full app needs to
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 1.  upon redirection from Paypal, display some text on an HTML page,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 2.  post some data that is passed to the download page, and
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> 3.  serve up a file for download.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> In order for me to use headers to serve up the file, I have to
</I>&gt;<i> pass
</I>&gt;&gt;&gt;<i> the
</I>&gt;&gt;&gt;<i> data on the transation to another page after I render the HTML.
</I>&gt;<i> There
</I>&gt;&gt;&gt;<i> is database validation stuff which is stripped out for this sample
</I>&gt;<i> but
</I>&gt;&gt;&gt;<i> which is working in the original code.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Not entirely clear on what you're trying to accomplish.  Can you
</I>&gt;&gt;&gt;<i> give
</I>&gt;&gt;&gt;&gt;<i> us some context, maybe tell us a user story?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> -Tim
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> On Jul 23, 2008, at 3:28 PM, Kristina Anderson wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Hi everyone, I really need another pair of eyes to take a look at
</I>&gt;&gt;&gt;&gt;&gt;<i> this.  I'm pretty sure this form needs to be submitted twice in
</I>&gt;&gt;&gt;<i> order
</I>&gt;&gt;&gt;&gt;&gt;<i> to pass the post array to the included file (see code below)...is
</I>&gt;&gt;&gt;<i> that
</I>&gt;&gt;&gt;&gt;&gt;<i> the only issue here..?  this is a bare bones code sample which i
</I>&gt;&gt;&gt;<i> will
</I>&gt;&gt;&gt;&gt;&gt;<i> have to integrate into my paypal app.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> the code modification was prompted by the fact that the buyers
</I>&gt;&gt;&gt;<i> were
</I>&gt;&gt;&gt;&gt;&gt;<i> not
</I>&gt;&gt;&gt;&gt;&gt;<i> seeing an html page on my client's website before the download box
</I>&gt;&gt;&gt;&gt;&gt;<i> popped up, and this needs to be rectified.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Thanks in advance!
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> FILE 1 - testdowndisp.php
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> $itemno = &quot;333&quot;;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> ?&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;html&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;head&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;script language=&quot;javascript&quot;&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> var flag = true;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> function laLoad(){
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> if (flag) {
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> document.fred.submit();
</I>&gt;&gt;&gt;&gt;&gt;<i> //var flag = false;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> }
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> }
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;/script&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;/head&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;body onload=&quot;laLoad()&quot;&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> Thanks for your purchase.  The charge will appear on your
</I>&gt;<i> statement
</I>&gt;&gt;&gt;<i> as
</I>&gt;&gt;&gt;&gt;&gt;<i> Rough Draft P.&lt;p&gt;Welcome back to Proof Magazine website.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;form name=&quot;fred&quot; action=&quot;testdowndisp.php&quot; method=&quot;POST&quot;&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;input type=&quot;hidden&quot; name=&quot;transid&quot; value=&quot;&lt;? echo $tx ?&gt;&quot;&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;input type=&quot;hidden&quot; name=&quot;pdfid&quot; value=&quot;&lt;? echo $itemno ?&gt;&quot;&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;/form&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> ob_clean();
</I>&gt;&gt;&gt;&gt;&gt;<i> include('downloadfile2.php');
</I>&gt;&gt;&gt;&gt;&gt;<i> //exit(0);
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> ?&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;/body&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;/html&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> FILE 2 -- downloadfile2.php
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> &lt;?
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> $pdfid = $_POST['pdfid'];
</I>&gt;&gt;&gt;&gt;&gt;<i> $filename = $pdfid.&quot;.pdf&quot;;
</I>&gt;&gt;&gt;&gt;&gt;<i> //echo $pdfid.&quot;&lt;br&gt;&quot;;
</I>&gt;&gt;&gt;&gt;&gt;<i> //echo $filename.&quot;&lt;br&gt;&quot;;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> //====
</I>&gt;&gt;&gt;&gt;&gt;<i> $path = '/usr431/home/p/r/proof/PDFs/';
</I>&gt;&gt;&gt;&gt;&gt;<i> $filesize=filesize($path.$filename);
</I>&gt;&gt;&gt;&gt;&gt;<i> header(&quot;Content-Type: application/pdf&quot;);
</I>&gt;&gt;&gt;&gt;&gt;<i>     header(&quot;Content-Length: &quot;.$filesize);
</I>&gt;&gt;&gt;&gt;&gt;<i>     header(&quot;Content-Disposition: attachment; filename=$filename&quot;);
</I>&gt;&gt;&gt;&gt;&gt;<i>     header(&quot;Content-Transfer-Encoding: binary&quot;);
</I>&gt;&gt;&gt;&gt;&gt;<i> readfile($path.$filename);
</I>&gt;&gt;&gt;&gt;&gt;<i> //fopen($path.$filename);
</I>&gt;&gt;&gt;&gt;&gt;<i> //===
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> ?&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> -- Kristina_______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i> New York PHP Community Talk Mailing List
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> NYPHPCon 2006 Presentations Online
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Show Your Participation in New York PHP
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> New York PHP Community Talk Mailing List
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> NYPHPCon 2006 Presentations Online
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Show Your Participation in New York PHP
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> New York PHP Community Talk Mailing List
</I>&gt;&gt;&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> NYPHPCon 2006 Presentations Online
</I>&gt;&gt;&gt;<i> <A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Show Your Participation in New York PHP
</I>&gt;&gt;&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> New York PHP Community Talk Mailing List
</I>&gt;&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> NYPHPCon 2006 Presentations Online
</I>&gt;&gt;<i> <A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Show Your Participation in New York PHP
</I>&gt;&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> New York PHP Community Talk Mailing List
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i>
</I>&gt;<i> NYPHPCon 2006 Presentations Online
</I>&gt;<i> <A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>
</I>&gt;<i>
</I>&gt;<i> Show Your Participation in New York PHP
</I>&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026259.html">[nycphp-talk] need another pair of eyes!
</A></li>
	<LI>Next message: <A HREF="026262.html">[nycphp-talk] need another pair of eyes!
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26260">[ date ]</a>
              <a href="thread.html#26260">[ thread ]</a>
              <a href="subject.html#26260">[ subject ]</a>
              <a href="author.html#26260">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
