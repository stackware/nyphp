<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Displaying images from a database 
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2005-April/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Displaying%20images%20from%20a%20database%20&In-Reply-To=%3COFB98C80CA.8BDFABE9-ON85256FEC.0015AE14-85256FEC.00194852%40us.ibm.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014313.html">
   <LINK REL="Next"  HREF="014322.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Displaying images from a database </H1>
    <B>Daniel Krook</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Displaying%20images%20from%20a%20database%20&In-Reply-To=%3COFB98C80CA.8BDFABE9-ON85256FEC.0015AE14-85256FEC.00194852%40us.ibm.com%3E"
       TITLE="[nycphp-talk] Displaying images from a database ">krook at us.ibm.com
       </A><BR>
    <I>Sat Apr 23 00:36:14 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014313.html">[nycphp-talk] session size important?
</A></li>
        <LI>Next message: <A HREF="014322.html">[nycphp-talk] Displaying images from a database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14321">[ date ]</a>
              <a href="thread.html#14321">[ thread ]</a>
              <a href="subject.html#14321">[ subject ]</a>
              <a href="author.html#14321">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello folks,

I'm trying to display image content that has been stored in a DB2 v8.2 
database as a BLOB along with its filename, size, and content type which 
was passed along when they were inserted via a form upload.  Storing links 
to physical files outside the database is not an option for this 
application.

I know that the data that is stored is not corrupt because the non-PHP 
content management tool that works with the uploads can redisplay them 
properly.   It's displaying them in PHP that is the issue.  I'm able to 
get the values I need from the database into a Photo object correctly with 
the following function.  [The FOR READ ONLY bit is a solution for getting 
BLOB data through ODBC correctly in PHP].

    public function getCatPhoto ($catId) {
        global $db;
        $retPhoto = new Photo();
        $sql = 'SELECT NAME, SIZE, TYPE, DATA
                FROM DB2INST1.PHOTOS P, DB2INST1.CAT_PHOTO CP 
                WHERE CP.CAT_ID = ? 
                AND CP.PHOTO_ID = P.PHOTO_ID FOR READ ONLY';
        $res =&amp; $db-&gt;query($sql, (int)$catId);
        if (PEAR::isError($res)) {
            die($res-&gt;getMessage());
        } else {
            if ($row =&amp; $res-&gt;fetchRow()) {
                $retPhoto-&gt;name = $row['NAME'];
                $retPhoto-&gt;size = $row['SIZE'];
                $retPhoto-&gt;type = $row['TYPE'];
                $retPhoto-&gt;data = $row['DATA'];
            }
        }
        $res-&gt;free();
        return $retPhoto;
    }

I then take this Photo object and try to display it in the browser.  Note 
that there's no whitespace anywhere that's messing with the headers.  I 
have experimented with quite a few cache control headers to no avail. 
Firefox and IE on the PC and Safari on the Mac all fail to display the 
image.  IE gives me the stream of data as it looks in the database. 
Firefox sometimes displays the data and other times tells me that &quot;The 
image &quot;x&quot; cannot be displayed, because it contains errors.&quot;  I've also 
tried unsuccessfully using force download techniques with 
header('Content-Disposition: attachment; filename=&quot;' . $photo-&gt;name . 
'&quot;');

    $photo = getCatPhoto($_GET['catId']);
    header('Content-Type: ' . $photo-&gt;type);
    header('Content-Length: ' . $photo-&gt;size);
    echo $photo-&gt;data;

The script can can be tested here:
<A HREF="http://catabase.krook.org/inc/util/view-photo.php?catId=34">http://catabase.krook.org/inc/util/view-photo.php?catId=34</A> (JPEG)
<A HREF="http://catabase.krook.org/inc/util/view-photo.php?catId=60">http://catabase.krook.org/inc/util/view-photo.php?catId=60</A> (GIF)

Can anyone see something that I'm missing?  Everything I've Googled points 
to examples that state that at a minimum the case-sensitive Content-Type 
header must be there and to use the echo function (as opposed to print 
because it's not so picky about unstructured data).  Are there any other 
things I'm overlooking?

Thanks in advance.





Daniel Krook, Advisory IT Specialist 
Application Development, Production Services - Tools, ibm.com

Personal: <A HREF="http://info.krook.org/">http://info.krook.org/</A>
BluePages: <A HREF="http://w3.ibm.com/bluepages?searchcnum=9A9796897">http://w3.ibm.com/bluepages?searchcnum=9A9796897</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014313.html">[nycphp-talk] session size important?
</A></li>
	<LI>Next message: <A HREF="014322.html">[nycphp-talk] Displaying images from a database
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14321">[ date ]</a>
              <a href="thread.html#14321">[ thread ]</a>
              <a href="subject.html#14321">[ subject ]</a>
              <a href="author.html#14321">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
