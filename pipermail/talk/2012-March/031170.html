<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] I've been hit with an eval(base64_decode(&quot;....&quot;)) injection attack
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2012-March/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20I%27ve%20been%20hit%20with%20an%20eval%28base64_decode%28%22....%22%29%29%0A%20injection%20attack&In-Reply-To=%3C20120327180139.GA29478%40panix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031167.html">
   
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] I've been hit with an eval(base64_decode(&quot;....&quot;)) injection attack</H1>
    <B>Daniel Convissor</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20I%27ve%20been%20hit%20with%20an%20eval%28base64_decode%28%22....%22%29%29%0A%20injection%20attack&In-Reply-To=%3C20120327180139.GA29478%40panix.com%3E"
       TITLE="[nycphp-talk] I've been hit with an eval(base64_decode(&quot;....&quot;)) injection attack">danielc at analysisandsolutions.com
       </A><BR>
    <I>Tue Mar 27 14:01:40 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="031167.html">[nycphp-talk] I've been hit with an eval(base64_decode(&quot;....&quot;)) injection attack
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31170">[ date ]</a>
              <a href="thread.html#31170">[ thread ]</a>
              <a href="subject.html#31170">[ subject ]</a>
              <a href="author.html#31170">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi David:

On Tue, Mar 27, 2012 at 10:47:16AM -0400, David Mintz wrote:
&gt;<i> 
</I>&gt;<i> Yeah, I assembled the regex based specifically on the malicious code that I
</I>&gt;<i> was looking at in all my files. I suppose the trick is to fashion a regex
</I>&gt;<i> that catches an actual eval call inside php tags -- there's  always a
</I>&gt;<i> chance that the string &quot;eval&quot; is is somehow legitimately contained inside
</I>&gt;<i> some php tags.
</I>
Sure, that's why you identify the files using grep, then do targeted
editing.  If all uses found need to be blown away, then you can use your
regex search and replace.  Otherwise handle the &quot;good&quot; files manually and
direct your regex search and replace handle the rest.

Oh, and &lt;?php tags should not even be part of the regex.  There can be
other code between the opening tag and the injected code.


&gt;<i> Except when it really needs to, like for writing data to a file-based
</I>&gt;<i> cache, or accepting file uploads. How do you recommend handling those cases?
</I>
Specific directories can be left writable.


&gt;<i> I have been wondering, why not chmod ALL your php files to 400? Indeed I
</I>&gt;<i> did this with one site after my infection, but not the several others. Then
</I>&gt;<i> I got hit again, but the site whose php files were 400 was not affected --
</I>&gt;<i> probably not a coincidence.
</I>
Probably?  Certainly!


&gt;<i> It's perhaps a bit of an inconvenience when you
</I>&gt;<i> need to update/overwrite, but I see no reason we can't relax permissions
</I>&gt;<i> temporarily for code deployments and reset them back when we're done.
</I>
That's why you automate your deploy process.  Easiest way is via shell
scripts.  chmod writable; update files; chmod readable.

--Dan

-- 
 T H E   A N A L Y S I S   A N D   S O L U T I O N S   C O M P A N Y
            data intensive web and database programming
                <A HREF="http://www.AnalysisAndSolutions.com/">http://www.AnalysisAndSolutions.com/</A>
 4015 7th Ave #4, Brooklyn NY 11232  v: 718-854-0335 f: 718-854-0409

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031167.html">[nycphp-talk] I've been hit with an eval(base64_decode(&quot;....&quot;)) injection attack
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31170">[ date ]</a>
              <a href="thread.html#31170">[ thread ]</a>
              <a href="subject.html#31170">[ subject ]</a>
              <a href="author.html#31170">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
