<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Copy-on-write
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2003-October/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Copy-on-write&In-Reply-To=%3C3FA2C27B.5010309%40nyphp.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006144.html">
   <LINK REL="Next"  HREF="006145.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Copy-on-write</H1>
    <B>Hans Zaunere</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Copy-on-write&In-Reply-To=%3C3FA2C27B.5010309%40nyphp.org%3E"
       TITLE="[nycphp-talk] Copy-on-write">hans at nyphp.org
       </A><BR>
    <I>Fri Oct 31 15:13:47 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006144.html">[nycphp-talk] Copy-on-write
</A></li>
        <LI>Next message: <A HREF="006145.html">[nycphp-talk] Copy-on-write
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6173">[ date ]</a>
              <a href="thread.html#6173">[ thread ]</a>
              <a href="subject.html#6173">[ subject ]</a>
              <a href="author.html#6173">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

George Webb wrote:

&gt;<i> Hi!  This is a followup to Hans's comment about passing variables to
</I>&gt;<i> functions (from 'Passing Arrays' thread, Tuesday afternoon).
</I>&gt;<i> 
</I>&gt;<i> 	So is it true that, even though PHP documentation says
</I>&gt;<i> variables passed to functions are, by default, passed-by-value,
</I>&gt;<i> really they are passed by *reference* -- BUT -- only when an actual
</I>&gt;<i> change (i.e. write) is attempted on the variable does a &quot;copy&quot; be
</I>&gt;<i> made?
</I>
Yes.  And no.  Perhaps this helps:

<A HREF="http://www.zend.com/zend/art/ref-count.php">http://www.zend.com/zend/art/ref-count.php</A>

Basically, (and I know there are some Zend Engine coders here, so feel free to correct me) the Zend Engine uses references internally; all variables in php land (those starting with '$') are references to underlying C data structures, called zvals.  Each zval can have any number of other names in php land, or aliases (think symbolic links), which are created explicitly by using the ampersand.  However, the Zend Engine also will create these references automatically at times, for instance to implement the copy-on-write for passing arguments into functions.  More or less, references are at the Zend Engine level; aliases are in php land.

&gt;<i> 	This seems like a really cool trick to try to maximize the
</I>&gt;<i> convenience of duplicating a variable's data only when it is actually
</I>&gt;<i> necessary to do so.  If no change is actually made to the data,
</I>&gt;<i> then there is no need to duplicate it; the function can simply
</I>&gt;<i> use the original variable -- because it is only *reading* it.
</I>
Exactly.

&gt;<i> 	Is this really how PHP 4 works?  If so, I'm somewhat impressed!
</I>
And you can illustrate this easily with a simple script that reads 10mb of data and then passes it into a function.  If the function changes even a single byte, you'll see the memory usage of the process double (or more).  Otherwise, it remains around 10mb, plus overhead of php itself.

&gt;<i> 	Does anyone know if PHP 5 will do this silent optimization
</I>&gt;<i> as well?
</I>
Yes, and I believe there will be improvements to it.  Especially important will be the implementing of copy-on-write, or reference counting for objects.  PHP 4 *does not* do this (ie, objects are truely passed by value - they are copied).

&gt;<i> 	As an offshoot topic, is it really good that the documentation
</I>&gt;<i> hides this important performance issue, by simply stating that
</I>&gt;<i> function variables are by default pass-by-value?  I would think that,
</I>&gt;<i> as the prior thread shows, users *do* need to know this.
</I>
I think this topic is essential to understand.  So essential, maybe it should be queued up as a PHundamentals?

H


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006144.html">[nycphp-talk] Copy-on-write
</A></li>
	<LI>Next message: <A HREF="006145.html">[nycphp-talk] Copy-on-write
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6173">[ date ]</a>
              <a href="thread.html#6173">[ thread ]</a>
              <a href="subject.html#6173">[ subject ]</a>
              <a href="author.html#6173">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
