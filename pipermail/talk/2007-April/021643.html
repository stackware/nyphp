<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] PCRE, utf8, Exceptions and you
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20PCRE%2C%20utf8%2C%20Exceptions%20and%20you&In-Reply-To=%3C002d01c77edc%24f5e6ff90%246400a8c0%40enobrev%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021647.html">
   <LINK REL="Next"  HREF="021651.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] PCRE, utf8, Exceptions and you</H1>
    <B>Mark Armendariz</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20PCRE%2C%20utf8%2C%20Exceptions%20and%20you&In-Reply-To=%3C002d01c77edc%24f5e6ff90%246400a8c0%40enobrev%3E"
       TITLE="[nycphp-talk] PCRE, utf8, Exceptions and you">lists at enobrev.com
       </A><BR>
    <I>Sat Apr 14 17:36:27 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="021647.html">[nycphp-talk] SQL Full text searcing and storing
</A></li>
        <LI>Next message: <A HREF="021651.html">[nycphp-talk] PCRE, utf8, Exceptions and you
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21643">[ date ]</a>
              <a href="thread.html#21643">[ thread ]</a>
              <a href="subject.html#21643">[ subject ]</a>
              <a href="author.html#21643">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Afternoon all,

What I'm trying to do...
------------------------
The validation classes in my library use PCRE's utf8 modifier.
<A HREF="http://us2.php.net/manual/en/reference.pcre.pattern.modifiers.php">http://us2.php.net/manual/en/reference.pcre.pattern.modifiers.php</A> (look for
PCRE_UTF8)

This allows me to do something like this:
echo preg_replace('/[^\p{L}\p{Nd}\p{Zs}]/u', '', 'abc123@#$'); // outputs
abc123

Which for ASCII is the equivalent of:
echo preg_replace('/[^\d\w\s]/', '', 'abc123@#$'); // outputs abc123 - or
echo preg_replace('/[^a-zA-Z0-9 ]/', '', 'abc123@#$'); // outputs abc123

Or rather, replaces anything that's not a letter, number or space, but with
the added benefit of supporting Unicode characters.
 

The Problem
-----------
Unfortunately, some (definitely not all) of my clients' on managed hosting
servers don't have PCRE's Unicode support configured.  I'm dealing with
their support staff to resolve the issue when possible, but would like to
look for these issues in my library as well to degrade and handle them
gracefully.

It seems php does not allow you to catch the PCRE warning given by the
server if PCRE isn't compiled to support Unicode.  I've seen this in the
past with named captures ('/(?P&lt;numbers&gt;[\d]+)/'), and resorted to just
taking out the named parts instead of working around the error.


Proposed Solution
-----------------
In this case, I would like to be able to fall back to ASCII checks if the
support isn't built in, like this:
try {
	echo preg_replace('/[^\p{L}\p{Nd}\p{Zs}]/u', '', $sVar);
}
catch (Exception $e) {
      echo preg_replace('/[^\d\w\s]/', '', $sVar);
}

And then probably output to a log warning me (and not my beloved visitors)
that the server needs to be reconfigured)


The Error
---------
Unfortunately this doesn't throw the exception.  It just outputs:

&quot;Warning: preg_replace() [function.preg-replace]: Compilation failed: PCRE
does not support \L, \l, \N, \P, \p, \U, \u, or \X at offset 3 in
/home/whatever/pcretest.php on line 3&quot;

I suppose I could capture the error with an error handler and try to figure
out if it was the error I'm looking for, but that seems so messy and
potentially unreliable.  Aren't we supposed to be able to use exceptions for
this sort of thing in php5+?


The Question
------------
Does anyone have experience with catching PCRE errors or just preg function
errors in general and dealing with them accordingly?


Thank You
---------
Mark Armendariz


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021647.html">[nycphp-talk] SQL Full text searcing and storing
</A></li>
	<LI>Next message: <A HREF="021651.html">[nycphp-talk] PCRE, utf8, Exceptions and you
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21643">[ date ]</a>
              <a href="thread.html#21643">[ thread ]</a>
              <a href="subject.html#21643">[ subject ]</a>
              <a href="author.html#21643">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
