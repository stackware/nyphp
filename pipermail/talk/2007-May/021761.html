<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] form spoofing
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20form%20spoofing&In-Reply-To=%3C463779EF.50508%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021760.html">
   <LINK REL="Next"  HREF="021762.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] form spoofing</H1>
    <B>Alvaro P.</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20form%20spoofing&In-Reply-To=%3C463779EF.50508%40gmail.com%3E"
       TITLE="[nycphp-talk] form spoofing">apg88zx at gmail.com
       </A><BR>
    <I>Tue May  1 13:33:35 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="021760.html">[nycphp-talk] form spoofing
</A></li>
        <LI>Next message: <A HREF="021762.html">[nycphp-talk] Overriding Array's
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21761">[ date ]</a>
              <a href="thread.html#21761">[ thread ]</a>
              <a href="subject.html#21761">[ subject ]</a>
              <a href="author.html#21761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I had the same problem, I used a random session variable, but they still 
got through.
I devised a way of avoiding several types of spam bots with some scripts 
I made.

First of all, the form has no action=&quot;&quot; when it is loaded, and therefore 
the simplest spam bots won't know where to send the information to.
When the form is submitted, javascript validates it, if it is valid, it 
generates a random variable with a random number in it, they are related 
by a simple mathematical formula I made up.
This variable is sent to a php script using the xmlhttpPost() function. 
The php script then checks to see if this variable matches it's criteria.
Once it is checked, it generates the actual form processing script from 
a pre-made template and saves it with a random name.
The name of the new form processor is then sent back to the actual form 
which then sets the action=&quot;&quot; and finally submits the form.

The neat thing about it is that I can set an 'expiration' date on the 
randomly named form processors, that way, if the spammer figures out the 
name of the file, he can only use it for 30 seconds after it is created. 
Old files are deleted when new ones are created.

This is all pretty invisible to the end user, who now doesn't have to 
fill out annoying CAPTCHA fields, the only downside is that it requires 
javascript.

The form processor can be any php script, it is read by the main script, 
and then re-saved with the random name and timeout added at the top.

I have all the files if you want to try it out.

Alvaro

Michael Southwell wrote:
&gt;<i> I thought I was following best practices ( 
</I>&gt;<i> <A HREF="http://www.nyphp.org/phundamentals/spoofed_submission.php">http://www.nyphp.org/phundamentals/spoofed_submission.php</A> ) in 
</I>&gt;<i> creating a comment form for a restaurant client (There is no security 
</I>&gt;<i> issue here; the comments are emailed):
</I>&gt;<i>
</I>&gt;<i> I stored a random token in the session:
</I>&gt;<i>
</I>&gt;<i> session_start();
</I>&gt;<i> if ( ! isset( $_SESSION['secret'] ) ) $_SESSION['secret'] = uniqid( 
</I>&gt;<i> rand(), TRUE );
</I>&gt;<i>
</I>&gt;<i> I hid that token in the form:
</I>&gt;<i>
</I>&gt;<i> &lt;form action=&quot;comments.php&quot; method=&quot;post&quot; onSubmit=&quot;return 
</I>&gt;<i> checkForm(this)&quot;&gt;
</I>&gt;<i> &lt;input type=&quot;hidden&quot; name=&quot;secret&quot; value=&quot;&lt;?= $_SESSION['secret'] ?&gt;&quot; /&gt;
</I>&gt;<i>
</I>&gt;<i> Upon submission, I checked for the token:
</I>&gt;<i>
</I>&gt;<i> if ( $_POST['secret'] !== $_SESSION['secret'] ) die( 'invalid form 
</I>&gt;<i> submission' );
</I>&gt;<i>
</I>&gt;<i> But I still got obvious spoofed submissions, not very many of them, 
</I>&gt;<i> and all vapid and often nonsensical (a sample: &quot;I consider that beside 
</I>&gt;<i> Your site there is future!&quot;), but still maddening.  So I added a 
</I>&gt;<i> five-minute timeout:
</I>&gt;<i>
</I>&gt;<i> if ( ! isset( $_SESSION['timeout'] ) ) {
</I>&gt;<i>   $timeout = time() + 5 * 60;
</I>&gt;<i>   $_SESSION['timeout'] = $timeout;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> and checked for that as well:
</I>&gt;<i>
</I>&gt;<i> $now = time();
</I>&gt;<i> if ( $_POST['secret'] !== $_SESSION['secret'] || $now &gt; 
</I>&gt;<i> $_SESSION['timeout'] ) die( 'invalid form submission' );
</I>&gt;<i>
</I>&gt;<i> But this hasn't helped much; I still get a few of them, though I can't 
</I>&gt;<i> figure out how they can be generated.  Any advice?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Michael Southwell, Vice President for Education
</I>&gt;<i> New York PHP
</I>&gt;<i> <A HREF="http://www.nyphp.com/training">http://www.nyphp.com/training</A> - In-depth PHP Training Courses
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> New York PHP Community Talk Mailing List
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i>
</I>&gt;<i> NYPHPCon 2006 Presentations Online
</I>&gt;<i> <A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>
</I>&gt;<i>
</I>&gt;<i> Show Your Participation in New York PHP
</I>&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021760.html">[nycphp-talk] form spoofing
</A></li>
	<LI>Next message: <A HREF="021762.html">[nycphp-talk] Overriding Array's
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21761">[ date ]</a>
              <a href="thread.html#21761">[ thread ]</a>
              <a href="subject.html#21761">[ subject ]</a>
              <a href="author.html#21761">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
