<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Can't do PHP 'exec' for an rsync command via web	server
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2012-June/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Can%27t%20do%20PHP%20%27exec%27%20for%20an%20rsync%20command%20via%20web%0A%09server&In-Reply-To=%3CCAN7%3DVv8avXZQamzWYkgdXRS25X7juH_o%3DyqRwWfjsCVs3F8G%2BQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031412.html">
   <LINK REL="Next"  HREF="031414.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Can't do PHP 'exec' for an rsync command via web	server</H1>
    <B>David Roth</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Can%27t%20do%20PHP%20%27exec%27%20for%20an%20rsync%20command%20via%20web%0A%09server&In-Reply-To=%3CCAN7%3DVv8avXZQamzWYkgdXRS25X7juH_o%3DyqRwWfjsCVs3F8G%2BQ%40mail.gmail.com%3E"
       TITLE="[nycphp-talk] Can't do PHP 'exec' for an rsync command via web	server">davidalanroth at gmail.com
       </A><BR>
    <I>Mon Jun 25 00:57:01 EDT 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="031412.html">[nycphp-talk] Can't do PHP 'exec' for an rsync command via web	server
</A></li>
        <LI>Next message: <A HREF="031414.html">[nycphp-talk] Can't do PHP 'exec' for an rsync command via web server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31413">[ date ]</a>
              <a href="thread.html#31413">[ thread ]</a>
              <a href="subject.html#31413">[ subject ]</a>
              <a href="author.html#31413">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm happy to report this is working now!

To recap the adventure for those of you who arrived late...:-)

CentOS 6.2. as shipped with PHP 5.3.3. Out of the box I couldn't execute a
PHP function (exec or system) to do an rsync with a remote host. The reason
was that Apache runs as user apache and doesn't have access to the /root's
ssh keys. This was causing an error code of 255 to be returned and no
output. A very puzzling and annoying situation as you can well imagine,
especially when the thing worked perfectly using PHP on the command line.

The fix was to bring apache into the *family*, and make it a regular user
on the system and gave it a home. Well, almost a regular user, no password
is set so the only way to login to it is through root using 'su'. Logging
into apache was needed to generate the ssh keys which were exchanged with
the remote host. It was very wise of Hans to also recommend to create
/home/apache instead of using the default /var/www because a nasty user
could have easily accessed the .ssh directory there and gotten the
public/private keys, and the known hosts.

Now that apache has its own home, the Tax Assessor will be by Monday to
start collecting property taxes. :-)

Thanks to everyone who e-mailed me and especially Hans!

David Roth


On Sun, Jun 24, 2012 at 8:25 PM, Hans Zaunere &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">zaunere at gmail.com</A>&gt; wrote:

&gt;<i> &gt; # grep apache /etc/passwd
</I>&gt;<i> &gt; apache:x:48:48:Apache:/var/www:/sbin/nologin
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You suggesting I change apache to just another user, like this?
</I>&gt;<i> &gt; apache:x:48:48:Apache:/var/www:/bin/bash
</I>&gt;<i>
</I>&gt;<i> Yes, though I'd make its own home directory, /home/apache, and give
</I>&gt;<i> appropriate rights as needed to the doc root.
</I>&gt;<i>
</I>&gt;<i> &gt; Maybe generate apache's own set of ssh keys to access the remote server
</I>&gt;<i> &gt; for rsync?
</I>&gt;<i>
</I>&gt;<i> Yeah - just cleanse your input well :)
</I>&gt;<i>
</I>&gt;<i> H
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20120625/2357adc3/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20120625/2357adc3/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031412.html">[nycphp-talk] Can't do PHP 'exec' for an rsync command via web	server
</A></li>
	<LI>Next message: <A HREF="031414.html">[nycphp-talk] Can't do PHP 'exec' for an rsync command via web server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31413">[ date ]</a>
              <a href="thread.html#31413">[ thread ]</a>
              <a href="subject.html#31413">[ subject ]</a>
              <a href="author.html#31413">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
