<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Not-so-subtle attack on PHP
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2007-September/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Not-so-subtle%20attack%20on%20PHP&In-Reply-To=%3C6431a0f40709290333p3f82a0b4r7877f54670221ff9%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023495.html">
   <LINK REL="Next"  HREF="023498.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Not-so-subtle attack on PHP</H1>
    <B>Jiju Thomas Mathew</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Not-so-subtle%20attack%20on%20PHP&In-Reply-To=%3C6431a0f40709290333p3f82a0b4r7877f54670221ff9%40mail.gmail.com%3E"
       TITLE="[nycphp-talk] Not-so-subtle attack on PHP">lists at silmail.com
       </A><BR>
    <I>Sat Sep 29 06:33:33 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023495.html">[nycphp-talk] Not-so-subtle attack on PHP
</A></li>
        <LI>Next message: <A HREF="023498.html">[nycphp-talk] Not-so-subtle attack on PHP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23496">[ date ]</a>
              <a href="thread.html#23496">[ thread ]</a>
              <a href="subject.html#23496">[ subject ]</a>
              <a href="author.html#23496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Would some of you comment on the following bit?

class sqlDb
{
    var $link;
    function sqlDb($dsn){
        $pdsn = parse_url($dsn);
        if($pdsn['scheme'] !== 'mysql')
            die(&quot;System is designed for MySQL only.. Please Correct the
dsn&quot;);
        $mysql_db = preg_replace(&quot;@^\/@&quot;,'',$pdsn['path']);

        $this-&gt;link =
mysql_connect($pdsn['host'],$pdsn['user'],$pdsn['pass']) or die(&quot;Could not
connect&quot;);
        mysql_select_db($mysql_db) or die (&quot;Could not select database&quot;);
    }

    function error($query, $errno, $error) {
        echo $error . &quot;&lt;br&gt;&quot; . $query;
        mysql_query(&quot;rollback&quot;);
        return false;
    }

    /**
     * Sends a query to the database
     *
     * @param sqlquery $query
     * @return result-resource
     */

      function query($query) {
            $result = mysql_query($query, $this-&gt;link) or
$this-&gt;error($query, mysql_errno(), mysql_error());
            return $result;
      }

      /**
       * Perform a modification query on database
       *
       * @param string $table
       * @param object $data
       * @param string $action
       * @param string $parameters
       * @return data resource
       */
  function perform($table, $data, $action = 'insert', $parameters = '') {
    reset($data);
    if ($action == 'insert') {
      $query = 'INSERT INTO ' . $table . ' (' . join(', ',
array_keys($data)) . ') VALUES (';
      reset($data);
      foreach ($data as $value){
          if(eregi(&quot;^func:&quot;, $value)){
               $query .= substr($value,5) . ', ';
          }else {
            switch ((string)$value) {
              case 'now()':
                $query .= 'NOW(), ';
                break;
              case 'null':
                $query .= 'NULL, ';
                break;
              default:
                $query .= '\'' . $this-&gt;input($value) . '\', ';
                break;
            }
        }
      }
      $query = substr($query, 0, -2) . ')';
    } elseif ($action == 'update') {
      $query = 'UPDATE ' . $table . ' SET ';
      foreach ($data as $columns =&gt; $value) {
          if(eregi(&quot;^func:&quot;, $value)){
               $query .= $columns . substr($value,5) . ', ';
          }else {
            switch ((string)$value) {
              case 'now()':
                $query .= $columns . ' = NOW(), ';
                break;
              case 'null':
                $query .= $columns . ' = NULL, ';
                break;
              case '++':
                $query .= $columns .' = '.$columns.' + 1, ';
                break;
              default:
                $query .= $columns . ' = \'' . $this-&gt;input($value) . '\',
';
                break;
            }
        }
      }
      $query = substr($query, 0, -2);
      if($parameters !== '')
          $query .= ' WHERE ' . $parameters;
    }
        return $this-&gt;query($query);
  }

  function fetch_object($result){
    return mysql_fetch_object($result);
  }

  function fetch_array($result) {
    return mysql_fetch_array($result, MYSQL_ASSOC);
  }

  function fetch_row($result) {
    return mysql_fetch_row($result);
  }

  function num_rows($result) {
    return mysql_num_rows($result);
  }

  function data_seek($result, $row_number) {
    return mysql_data_seek($result, $row_number);
  }

  function insert_id() {
    return mysql_insert_id();
  }

  function affected_rows() {
    return mysql_affected_rows();
  }

  function free_result($result) {
    return mysql_free_result($result);
  }

  function fetch_fields($result) {
    return mysql_fetch_field($result);
  }

  function output($string) {
    return htmlspecialchars($string);
  }

  function input($string) {
    return addslashes($string);
  }

  function prepare_input($string) {
    if (is_string($string)) {
      return trim(stripslashes($string));
    } elseif (is_array($string)) {
      reset($string);
      while (list($key, $value) = each($string)) {
        $string[$key] = $this-&gt;prepare_input($value);
      }
      return $string;
    } else {
      return $string;
    }
  }
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20070929/2be2653a/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20070929/2be2653a/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023495.html">[nycphp-talk] Not-so-subtle attack on PHP
</A></li>
	<LI>Next message: <A HREF="023498.html">[nycphp-talk] Not-so-subtle attack on PHP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23496">[ date ]</a>
              <a href="thread.html#23496">[ thread ]</a>
              <a href="subject.html#23496">[ subject ]</a>
              <a href="author.html#23496">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
