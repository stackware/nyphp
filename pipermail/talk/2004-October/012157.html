<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] NEW PHundamentals Question - Headers &amp; Downloads
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2004-October/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20NEW%20PHundamentals%20Question%20-%20Headers%20%26%20Downloads&In-Reply-To=%3C41EE526EC2D3C74286415780D3BA9F8704F13BAC%40ehost011-1.exch011.intermedia.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012154.html">
   <LINK REL="Next"  HREF="012160.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] NEW PHundamentals Question - Headers &amp; Downloads</H1>
    <B>Hans Zaunere</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20NEW%20PHundamentals%20Question%20-%20Headers%20%26%20Downloads&In-Reply-To=%3C41EE526EC2D3C74286415780D3BA9F8704F13BAC%40ehost011-1.exch011.intermedia.net%3E"
       TITLE="[nycphp-talk] NEW PHundamentals Question - Headers &amp; Downloads">hans at nyphp.com
       </A><BR>
    <I>Wed Oct 13 14:00:18 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="012154.html">[nycphp-talk] simple problem with sessions
</A></li>
        <LI>Next message: <A HREF="012160.html">[nycphp-talk] NEW PHundamentals Question - Headers &amp; Downloads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12157">[ date ]</a>
              <a href="thread.html#12157">[ thread ]</a>
              <a href="subject.html#12157">[ subject ]</a>
              <a href="author.html#12157">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
It's PHunny Time! - 

&gt;<i> &gt; For the next PHundamentals article, we are exploring best practices
</I>in
&gt;<i> &gt; the use of headers.  Over the next few weeks, we'll be asking about
</I>the
&gt;<i> &gt; various ways in which headers are used.  This week's question (see
</I>&gt;<i> &gt; below) concerns the use of headers which force downloads.
</I>&gt;<i> 
</I>&gt;<i> I have used this combination of headers with pretty good success:
</I>&gt;<i> 
</I>&gt;<i> Given an array containing the details of the file like:
</I>&gt;<i> 
</I>&gt;<i> $attach = array(
</I>&gt;<i>    'filename' =&gt; 'myfile.pdf',
</I>&gt;<i>    'mimetype' =&gt; 'application/pdf',
</I>&gt;<i>    'content'  =&gt; 'pdf here'
</I>&gt;<i> );
</I>&gt;<i> 
</I>&gt;<i> header('Content-Disposition: attachment; filename='.
</I>$attach['filename']);
&gt;<i> header('Content-length: '. strlen($attach['content']));
</I>&gt;<i> header('Content-type: '. $attach['mimetype']);
</I>&gt;<i> echo $attach['content'];
</I>&gt;<i> exit;
</I>&gt;<i> 
</I>&gt;<i> The Content-Disposition header tells the browser to open the download
</I>&gt;<i> dialog, and lets it know the correct filename/extension.
</I>&gt;<i> 
</I>&gt;<i> The Content-length header allows the browser to display a meaningful
</I>&gt;<i> progress bar.
</I>&gt;<i> 
</I>&gt;<i> The Content-type header lets the browser correctly display an
</I>indication
&gt;<i> of the file type to the user (PDF,XLS,EXE etc).  In most browsers it
</I>&gt;<i> will also influence the default action (open vs download).
</I>&gt;<i> 
</I>&gt;<i> For some files (pdf mostly) it can be a good idea to use a different
</I>&gt;<i> Content-Disposition header, namely:
</I>&gt;<i> 
</I>&gt;<i> header('Content-Disposition: inline; filename='. $attach['filename']);
</I>&gt;<i> 
</I>&gt;<i> In most browsers this will result in the pdf file being opened within
</I>&gt;<i> the browser window.
</I>&gt;<i> 
</I>&gt;<i> I have a bunch more information regarding the use of headers for cache
</I>&gt;<i> control...but that wasn't what you were asking was it ;)
</I>
Maybe that'll be the next PHunny question on headers :)

Anyway, I've done much the same as Dan.

For instance, to force a download, even if a plugin for the file type
exists, this I think generally works:

header('Content-type: application/x-download');


And of course the disposition - we don't want a grumpy file...

header(&quot;Content-Disposition: attachment; filename=$filesaveas&quot;);

Then spit the file out:

readfile($filepath);

This of course would be an echo for non-filesystem content.

That's all well and good, but I've run into some tricky problems with IE
and SSL.  Now some would argue that this is a bug, but I think IE is
actually inline with the standard.  Details are at:

<A HREF="http://support.microsoft.com/default.aspx?scid=KB;EN-US;q316431&amp;">http://support.microsoft.com/default.aspx?scid=KB;EN-US;q316431&amp;</A>

Basically, when a previous header has been sent to not cache anything,
it won't let you save a file - that actually makes sense.  So, the
workaround, which I've found works all the time, it to replace the
default caching headers (ie, no-cache) with this:

header('Cache-Control: must-revalidate', TRUE);
header('Pragma: ', TRUE);

Next would be to send the standard disposition, type and so forth
headers, per above.

So that's one little gotcha, that I think I've been able to resolve.

Another gotcha, that I can't resolve, actually involves Mozilla.  For
instance, Mozilla (and derivatives) always append the file extension of
the type of page originally viewed.  What do people do for this?  For
instance, in phpMyAdmin, downloading a .sql file will be saved as a
.sql.php file.  I frankly haven't looked too deeply, but a work around
for the future would be nice.

So at the end of the day, I think it's somewhat of a black art.  On
occasion, trying to force a download vs a file open seems impossible,
depending on browser, version, and plugins.  Has anyone developed a
matrix like:

Browser -&gt; Version -&gt; Required Behavior -&gt; Use These Headers?

Getting some definitive answers from the Browser/HTTP/Front-End guys
would be invaluable.

---
Hans Zaunere
President, Founder
New York PHP
<A HREF="http://www.nyphp.org">http://www.nyphp.org</A>



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012154.html">[nycphp-talk] simple problem with sessions
</A></li>
	<LI>Next message: <A HREF="012160.html">[nycphp-talk] NEW PHundamentals Question - Headers &amp; Downloads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12157">[ date ]</a>
              <a href="thread.html#12157">[ thread ]</a>
              <a href="subject.html#12157">[ subject ]</a>
              <a href="author.html#12157">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
