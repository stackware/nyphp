<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Translating XML to SQL
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2004-February/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Translating%20XML%20to%20SQL&In-Reply-To=%3C001f01c3f17d%24c620cbf0%248b01a8c0%40DB%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007786.html">
   <LINK REL="Next"  HREF="007789.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Translating XML to SQL</H1>
    <B>Eric Rank</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Translating%20XML%20to%20SQL&In-Reply-To=%3C001f01c3f17d%24c620cbf0%248b01a8c0%40DB%3E"
       TITLE="[nycphp-talk] Translating XML to SQL">erank at isthmus.com
       </A><BR>
    <I>Thu Feb 12 10:34:59 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="007786.html">[nycphp-talk] Session question
</A></li>
        <LI>Next message: <A HREF="007789.html">[nycphp-talk] Translating XML to SQL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7788">[ date ]</a>
              <a href="thread.html#7788">[ thread ]</a>
              <a href="subject.html#7788">[ subject ]</a>
              <a href="author.html#7788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After I went home last night my wheels were still spinning about this idea,
and I started re-thinking the design from the ground up, using what I've
learned from this project so far. Currently the use of rulesets makes the
design a little bit too complex. The ruleset itself consists of a list of
tables in the database, within it are children tags containing &lt;if&gt; and
&lt;else&gt; tags. Within those condition tags are statements that would need to
occur to get the value for a specific column. This gets extremely messy and
confusing. Not only do you have to figure out what column relies on the
inserted id from another, but you also have to know what kind of SQL
statements to make. Confused? yeah, me too.

After thinking about it, all this ruleset is, is a combination of
XML-to-table.column mappings and primary key-foreign key pairs. Combining
them gets sloppy, but seperating them seems the way to go. It's much easier
to write 2 seperate files. 1. an xml file with Primary key - Foreign key
pairs and 2. an xml-to-table.column map xml file. I can also say that it'd
be much easier to write a parser for those files. Right now, parsing through
a ruleset xml file with pseudo logic embedded is ugly. Parsing this
psuedo-logic xml is half the battle. Once it has been incorporated into the
rule object, that rule object has to follow that logic. Yuck.

So, since I was off the clock, I cracked open a beer and started putting
together a new design for this project (beer, I find, is the only way to
really justify thinking about work stuff when I'm at home). A rough UML
diagram is here:

<A HREF="http://lo-fi.net/~eric/default.gif">http://lo-fi.net/~eric/default.gif</A>

All the objects are there, all the methods and properties are not.

The idea is this, the xml translator has a database property which holds
regular database stuff, but also an xml-to-table.column map and a primary
key to foreign key map. The tables hold record objects. the record objects
are created when the data file gets parsed by the data xml parser. When the
parser gets to an element that holds data, it looks at the xml-db map on the
database object, and knows what table to create a record for. After the data
has all been parsed into record objects for the tables, it's time to insert
the records. At that point, the translator goes through all the tables,
making inserts for records that have not yet been saved, ignoring those that
already exist. If an incomplete record is found during this process, where
an id is needed from a different record insertion, the translator-&gt;database
object knows where look by virtue of it's Primary Key - Foreign Key map. If
the id that we need is there, great, grab it and put it in the record. If
not, try to insert the record (or SELECT the record ID if it already exists,
eg. an authors name) for the table that we need the id from. Then you can go
back and save the first record. This process would need to be a recursive
one.

What kind of problems do you think I might run into using a design like
this? Is anything missing?

I'll consider the article idea. At this point, I've done enough head
scratching that I think it'd be nice to save anyone else the grief. I'll
work on collecting and writing up my experiences.

Eric Rank



----- Original Message ----- 
From: &quot;Hans Zaunere&quot; &lt;hans not <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">junk at nyphp.com</A>&gt;
To: &quot;NYPHP Talk&quot; &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
Sent: Wednesday, February 11, 2004 5:00 PM
Subject: RE: [nycphp-talk] Translating XML to SQL


&gt;<i>
</I>&gt;<i> This is interesting, Eric.  If you write your emails anywhere as complete
</I>as you'd write an article, this might make a good Advanced PHundamentals  :)
&gt;<i>
</I>&gt;<i> H
</I>&gt;<i>
</I>&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>
</I>&gt;<i> &gt; [mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>] On Behalf Of Eric Rank
</I>&gt;<i> &gt; Sent: Wednesday, February 11, 2004 5:40 PM
</I>&gt;<i> &gt; To: NYPHP Talk
</I>&gt;<i> &gt; Subject: Re: [nycphp-talk] Translating XML to SQL
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks for your suggestions Dan (other Dan too). I should
</I>&gt;<i> &gt; apologize for
</I>&gt;<i> &gt; being a little vague in my previous post about the details of
</I>&gt;<i> &gt; the project
</I>&gt;<i> &gt; I'm working on. I mainly wanted to see if any of y'all had
</I>&gt;<i> &gt; faced similar
</I>&gt;<i> &gt; XML-&gt;SQL challenges and if there might be packaged solution
</I>&gt;<i> &gt; was out there to
</I>&gt;<i> &gt; solve it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Parsing the XML and encapsulating it into objects is the easy
</I>&gt;<i> &gt; part in this
</I>&gt;<i> &gt; project. It's trying to unpack it all that gets a little screwy.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My solution is to do the following:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1. First parse the XML content into a multidimensional array
</I>&gt;<i> &gt; that reflects
</I>&gt;<i> &gt; the xml structure (After thinking about it, this should
</I>&gt;<i> &gt; probably be a more
</I>&gt;<i> &gt; structured object)
</I>&gt;<i> &gt; 2. Create a database object to encapsulate the database structure
</I>&gt;<i> &gt; 3. parse an xml formatted ruleset file into an object that
</I>&gt;<i> &gt; will determine
</I>&gt;<i> &gt; how to execute sql statements.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This ruleset object is the key to making the whole thing come
</I>&gt;<i> &gt; together.
</I>&gt;<i> &gt; Essentially, it does the same thing as a stored procedure would. The
</I>&gt;<i> &gt; likeness is obvious now that you bring up the topic. I hadn't
</I>&gt;<i> &gt; thought of
</I>&gt;<i> &gt; that before. Basically, this creates a 'rule' for each table, and
</I>&gt;<i> &gt; contigencies for the columns and tables as needed. This also
</I>&gt;<i> &gt; serves as a
</I>&gt;<i> &gt; place to map out the relationship between an xml file and a database
</I>&gt;<i> &gt; structure. The cool thing is that I should be able to take
</I>&gt;<i> &gt; just about any
</I>&gt;<i> &gt; database &amp; XML pair, create a ruleset file defining the
</I>&gt;<i> &gt; relationships &amp;
</I>&gt;<i> &gt; contigencies, and it should all work. Although a new xml
</I>&gt;<i> &gt; parser would need
</I>&gt;<i> &gt; to be created for the xml file holding the data in order to create the
</I>&gt;<i> &gt; multidimensional struct the translator object expects.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Right now, I'm to the point where:
</I>&gt;<i> &gt; 1. I'm looping through the list of tables from the database object
</I>&gt;<i> &gt;     1.1 checking the rules for that table
</I>&gt;<i> &gt;         1.1.1 if the rule passes, the insert query happens and returns
</I>&gt;<i> &gt;                 success
</I>&gt;<i> &gt;         1.1.2 if the rule does NOT pass, i need to look at a
</I>&gt;<i> &gt; different table
</I>&gt;<i> &gt;                 so i go through the process recursively.
</I>&gt;<i> &gt; checking table
</I>&gt;<i> &gt; rules,
</I>&gt;<i> &gt;                 inserting where possible until all records
</I>&gt;<i> &gt; have been saved,
</I>&gt;<i> &gt;                 or, at this point, ad infinitum
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I can insert data, and to a certain degree it gets inserted
</I>&gt;<i> &gt; correctly, but
</I>&gt;<i> &gt; I'm winding up with some corruption of data, which I'm trying
</I>&gt;<i> &gt; to pin down.
</I>&gt;<i> &gt; Infinite loops are happening right now... Recursion is cool
</I>&gt;<i> &gt; when it works. I
</I>&gt;<i> &gt; kind of feel like I'm working magic when it happens, but
</I>&gt;<i> &gt; until that magical
</I>&gt;<i> &gt; point, it's fairly hair raising.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----- Original Message ----- 
</I>&gt;<i> &gt; From: &quot;Dan Cech&quot; &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">dcech at phpwerx.net</A>&gt;
</I>&gt;<i> &gt; To: &quot;NYPHP Talk&quot; &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
</I>&gt;<i> &gt; Sent: Wednesday, February 11, 2004 1:13 PM
</I>&gt;<i> &gt; Subject: Re: [nycphp-talk] Translating XML to SQL
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; From the work I've done on adodb-xmlschema, I would advise an object
</I>&gt;<i> &gt; &gt; oriented approach, it really helps to break up the logic.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I would create a class to hold the methods for parsing a
</I>&gt;<i> &gt; document, etc,
</I>&gt;<i> &gt; &gt; and another class to represent an article.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Once you have a class for the article you can build up all
</I>&gt;<i> &gt; the article
</I>&gt;<i> &gt; &gt; details from the xml, and finally generate and run the SQL
</I>&gt;<i> &gt; to insert all
</I>&gt;<i> &gt; &gt; the required records.  You could also use the class for
</I>&gt;<i> &gt; accessing the
</I>&gt;<i> &gt; &gt; data once it is in the database....
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; You may also want to create classes for author, etc which
</I>&gt;<i> &gt; could handle
</I>&gt;<i> &gt; &gt; the logic for updating/inserting the relevant details into
</I>&gt;<i> &gt; those tables.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Anyway, it appears you are looking at a procedural solution
</I>&gt;<i> &gt; right now,
</I>&gt;<i> &gt; &gt; which will work too....honestly I'd have to have more
</I>&gt;<i> &gt; details about the
</I>&gt;<i> &gt; &gt; specific issues you are working around in order to give you
</I>&gt;<i> &gt; any concrete
</I>&gt;<i> &gt; &gt; advice.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Dan
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Eric Rank wrote:
</I>&gt;<i> &gt; &gt; &gt; I'm working on a PHP app that will translate XML to SQL based on a
</I>&gt;<i> &gt; &gt; &gt; configuration file with rules, and as I'm getting to the
</I>&gt;<i> &gt; end of this
</I>&gt;<i> &gt; &gt; &gt; project, all the quirks and airbubbles (yes, ok, they're BUGS) are
</I>&gt;<i> &gt; &gt; &gt; getting squeezed out. And man, it's no fun. So now I'm looking for
</I>&gt;<i> &gt; &gt; &gt; solutions that may have been created before me.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Specifically, the xml contains information from articles
</I>&gt;<i> &gt; in a newspaper.
</I>&gt;<i> &gt; &gt; &gt; Author, issue, volumne, section, category, headline,
</I>&gt;<i> &gt; story, etc. This
</I>&gt;<i> &gt; &gt; &gt; xml we get from an export from QuarkXPress (which is its
</I>&gt;<i> &gt; own nightmare)
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I'm trying to  take this xml structure that contains NO database
</I>&gt;<i> &gt; &gt; &gt; specific information and place it into a MySQL database
</I>&gt;<i> &gt; with about a
</I>&gt;<i> &gt; &gt; &gt; dozen related tables. The trick is that in going through
</I>&gt;<i> &gt; an xml file,
</I>&gt;<i> &gt; &gt; &gt; there are a lot of contigencies to cover before finally
</I>&gt;<i> &gt; reaching the
</I>&gt;<i> &gt; &gt; &gt; database. For example, some INSERT statements require the
</I>&gt;<i> &gt; inserted id of
</I>&gt;<i> &gt; &gt; &gt; a previous insert statement in order to make the records
</I>&gt;<i> &gt; relational (eg.
</I>&gt;<i> &gt; &gt; &gt; we need to insert the 'story' info into the 'article'
</I>&gt;<i> &gt; table to get the
</I>&gt;<i> &gt; &gt; &gt; inserted id for the article, which then gets inserted
</I>&gt;<i> &gt; into the 'photos'
</I>&gt;<i> &gt; &gt; &gt; table in the 'articleID' column.). Some insert statements
</I>&gt;<i> &gt; might not need
</I>&gt;<i> &gt; &gt; &gt; to happen because the information already exists (eg. an
</I>&gt;<i> &gt; author that
</I>&gt;<i> &gt; &gt; &gt; already exists in the database). You get the idea.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Anyone have experience doing this? Is there an open
</I>&gt;<i> &gt; source project out
</I>&gt;<i> &gt; &gt; &gt; there that's working on this? Third party software even?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Thanks for your help,
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Eric Rank
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; talk mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; talk mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> talk mailing list
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>

&gt;<i>From hans not <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">junk at nyphp.com</A>  Thu Feb 12 10:38:33 2004
</I>Return-Path: &lt;hans not <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">junk at nyphp.com</A>&gt;
Received: from ehost011-1.exch011.intermedia.net (unknown [64.78.21.3])
	by virtu.nyphp.org (Postfix) with ESMTP id 0F13EA8628
	for &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;; Thu, 12 Feb 2004 10:38:33 -0500 (EST)
X-MimeOLE: Produced By Microsoft Exchange V6.5.6944.0
Content-class: urn:content-classes:message
MIME-Version: 1.0
Content-Type: text/plain;
	charset=&quot;us-ascii&quot;
Content-Transfer-Encoding: quoted-printable
Subject: RE: [nycphp-talk] Session question
Date: Thu, 12 Feb 2004 07:38:30 -0800
Message-ID: &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">41EE526EC2D3C74286415780D3BA9F87772AAD at ehost011-1.exch011.intermedia.net</A>&gt;
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
Thread-Topic: [nycphp-talk] Session question
Thread-Index: AcPxJHy9pDAV8hSzTQe+pOowrTE7iwAWaxUQ
From: &quot;Hans Zaunere&quot; &lt;hans not <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">junk at nyphp.com</A>&gt;
To: &quot;NYPHP Talk&quot; &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
X-BeenThere: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
X-Mailman-Version: 2.1.2
Precedence: list
Reply-To: NYPHP Talk &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
List-Id: NYPHP Talk  &lt;talk.lists.nyphp.org&gt;
List-Unsubscribe: &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>&gt;,
	&lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-request at lists.nyphp.org</A>?subject=unsubscribe&gt;
List-Archive: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk">http://lists.nyphp.org/pipermail/talk</A>&gt;
List-Post: &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
List-Help: &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-request at lists.nyphp.org</A>?subject=help&gt;
List-Subscribe: &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>&gt;,
	&lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-request at lists.nyphp.org</A>?subject=subscribe&gt;
X-List-Received-Date: Thu, 12 Feb 2004 15:38:33 -0000



&gt;<i> In createTireImg.php, code like following:
</I>&gt;<i> -------
</I>&gt;<i> &lt;?php
</I>&gt;<i> include (&quot;img_text_config.inc.php&quot;);
</I>&gt;<i> include (&quot;tbContent.php&quot;);
</I>&gt;<i>    session_start( );
</I>&gt;<i> ?&gt;
</I>
Are you also doing a session_start(); in the other pages?
session_start() has to be called at every page, or in a file that is
included by all your pages.

Also..

&gt;<i>       Text color: &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;
</I>&gt;<i>       &lt;select name=3D&quot;tt_color&quot;&gt;
</I>&gt;<i>       &lt;?php
</I>&gt;<i>          if (isSet($_POST['tt_color']))
</I>&gt;<i>          {
</I>&gt;<i>             $tt_color_def =3D ($_POST['tt_color']);
</I>&gt;<i>=20
</I>&gt;<i>          }
</I>&gt;<i>             $_SESSION['tt_color'] =3D $_POST['tt_color'];
</I>
Keep in mind, that even if $_POST['tt_color'] is not set, you are
assigning it to $_SESSION['tt_color'];

You might want to add a else in there.

HTH,
H


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007786.html">[nycphp-talk] Session question
</A></li>
	<LI>Next message: <A HREF="007789.html">[nycphp-talk] Translating XML to SQL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7788">[ date ]</a>
              <a href="thread.html#7788">[ thread ]</a>
              <a href="subject.html#7788">[ subject ]</a>
              <a href="author.html#7788">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
