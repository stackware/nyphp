<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Working with recursive &quot;single-referenced&quot; methods	and	static variables
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2004-February/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Working%20with%20recursive%20%22single-referenced%22%20methods%0A%09and%09static%20variables&In-Reply-To=%3C403BDE39.8070502%40phpwerx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008072.html">
   <LINK REL="Next"  HREF="008075.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Working with recursive &quot;single-referenced&quot; methods	and	static variables</H1>
    <B>Dan Cech</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Working%20with%20recursive%20%22single-referenced%22%20methods%0A%09and%09static%20variables&In-Reply-To=%3C403BDE39.8070502%40phpwerx.net%3E"
       TITLE="[nycphp-talk] Working with recursive &quot;single-referenced&quot; methods	and	static variables">dcech at phpwerx.net
       </A><BR>
    <I>Tue Feb 24 18:28:57 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008072.html">[nycphp-talk] Working with recursive &quot;single-referenced&quot; methods	and static variables
</A></li>
        <LI>Next message: <A HREF="008075.html">[nycphp-talk] Working with recursive &quot;single-referenced&quot; methods	and	static variables
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8074">[ date ]</a>
              <a href="thread.html#8074">[ thread ]</a>
              <a href="subject.html#8074">[ subject ]</a>
              <a href="author.html#8074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Phil Powell wrote:

&gt;<i> [CODE]
</I>&gt;<i> class DepartmentTree {
</I>&gt;<i> 
</I>&gt;<i> function &amp;buildTree($id) {
</I>&gt;<i>   static $html;
</I>&gt;<i>   if (!isset($html)) {
</I>&gt;<i>    // DO STUFF HERE TO $html
</I>&gt;<i>   }
</I>&gt;<i>   // DO MORE STUFF
</I>&gt;<i>   if ($condition_is_met) $this-&gt;buildTree($newID);
</I>&gt;<i>   $this-&gt;html = $html;
</I>&gt;<i>  }
</I>&gt;<i> 
</I>&gt;<i> }
</I>&gt;<i> [/CODE]
</I>&gt;<i> 
</I>&gt;<i> The above (and greatly paraphrased from the 100-line actual class) class 
</I>&gt;<i> and method, in its real form, totally works inasmuch as it successfully 
</I>&gt;<i> always creates an HTML hierarchial tree of departments mapped with child 
</I>&gt;<i> departments.  I have no problem with this.. as long as I only use the 
</I>&gt;<i> class once.
</I>&gt;<i> 
</I>&gt;<i> However, there is a case where I need the entire contents of the 
</I>&gt;<i> departments table dumped out into a resultset, and to do that I figured 
</I>&gt;<i> I would just loop through a query of records that have no parent ID; 
</I>&gt;<i> each id in each row I seed into $tree-&gt;buildTree():
</I>&gt;<i> 
</I>&gt;<i> [CODE]
</I>&gt;<i> for ($i = 0; $i &lt; @sizeof($result); $i++) {
</I>&gt;<i> $tree-&gt;buildTree($result[$i]-&gt;id);
</I>&gt;<i> $this-&gt;deptArray += $tree-&gt;convert_to_array();
</I>&gt;<i> $tree-&gt;clearTreeHTML();
</I>&gt;<i> }
</I>&gt;<i> [/CODE]
</I>&gt;<i> 
</I>&gt;<i> The &quot;convert_to_array()&quot; method will convert the contents of $this-&gt;html 
</I>&gt;<i> from HTML content to an array, keeping the original hierarchial order; 
</I>&gt;<i> the &quot;clearTreeHTML()&quot; method will set $this-&gt;html to NULL or &quot;&quot;.
</I>&gt;<i> 
</I>&gt;<i> Problem is, it does not do that, because apparently &quot;static $html&quot; keeps 
</I>&gt;<i> an instance of it running in the single-referenced instance of 
</I>&gt;<i> &quot;buildTree&quot; method. 
</I>&gt;<i> Based on how best I can explain my problem, and sorry I can't explain it 
</I>&gt;<i> any better w/o dumping the actual code line by line, how have you all 
</I>&gt;<i> figured out the best way to generate multiple, unique instances from a 
</I>&gt;<i> single-referenced method that uses a static local variable?
</I>
If you are always going to use $tree as an object, and not call 
DepartmentTree::buildTree (), then just remove the 'static $html;' and 
'$this-&gt;html = $html;' lines and replace all instances of '$html' with 
'$this-&gt;html'.

This is the normal method for object oriented design, the only reason to 
use static variables is if you are trying to do something tricky like 
the singleton class.

Your code would then be:

class DepartmentTree {

   var $html;

   function &amp;buildTree($id) {
     if (!isset($this-&gt;html)) {
      // DO STUFF HERE TO $this-&gt;html
     }
     // DO MORE STUFF
     if ($condition_is_met) {
       $this-&gt;buildTree($newID);
     }
   }

   function clearTreeHTML () {
     $this-&gt;html = NULL;
   }

   function convert_to_array () {
     // PUT YOUR ARRAY CONVERSION HERE
     return (array) $this-&gt;html;
   }
}

Which will perform as expected.

Dan


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008072.html">[nycphp-talk] Working with recursive &quot;single-referenced&quot; methods	and static variables
</A></li>
	<LI>Next message: <A HREF="008075.html">[nycphp-talk] Working with recursive &quot;single-referenced&quot; methods	and	static variables
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8074">[ date ]</a>
              <a href="thread.html#8074">[ thread ]</a>
              <a href="subject.html#8074">[ subject ]</a>
              <a href="author.html#8074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
