<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Active Directory Authentication using LDAP + PHP
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2004-February/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Active%20Directory%20Authentication%20using%20LDAP%20%2B%20PHP&In-Reply-To=%3C12257.65.211.92.98.1077638965.squirrel%40www.keithjr.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008048.html">
   <LINK REL="Next"  HREF="008051.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Active Directory Authentication using LDAP + PHP</H1>
    <B>keith at keithjr.net</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Active%20Directory%20Authentication%20using%20LDAP%20%2B%20PHP&In-Reply-To=%3C12257.65.211.92.98.1077638965.squirrel%40www.keithjr.net%3E"
       TITLE="[nycphp-talk] Active Directory Authentication using LDAP + PHP">keith at keithjr.net
       </A><BR>
    <I>Tue Feb 24 11:09:25 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008048.html">[nycphp-talk] MAC development environment
</A></li>
        <LI>Next message: <A HREF="008051.html">[nycphp-talk] MAC development environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8055">[ date ]</a>
              <a href="thread.html#8055">[ thread ]</a>
              <a href="subject.html#8055">[ subject ]</a>
              <a href="author.html#8055">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I noticed someone asking about Active Directory authentication using
straight up php - so I

figured that I would send this along.

This is a snippet of a login script for a calendar scheduling ap that I
wrote in PHP for a

local intranet. You would make a login form, with post variables of
username and password,

and it will authenticate them to the AD server.

How this works: it connects to the LDAP server with a valid login - which
I created the

username ldap in active directory, to query the database, since it would
not allow anonymous

access. You would look up the correct username for that account by
querying the

smaaccountname field for the username that they entered. If that exists,
then get the

correct username to bind to the server with, disconnect, and retry to
connect with the users

proper username and their password. If it connects, you know that it is a
valid username.

I have used this script in their helpdesk application so that passwords
were being checked

vs active directory instead of the internal help desk application's
passwords.

This is just one way of doing it - if anyone else has comments or
questions, please feel

free to let me now!

// connect to LDAP server
$ldap = ldap_connect(&quot;172.17.1.11&quot;) or die(&quot;Cannot connect to the ldap
server :/&quot;);
$oudc = &quot;cn=Users, dc=thompsonhealth, dc=org&quot;;
$searchdc = &quot;dc=thompsonhealth, dc=org&quot;;
$dn2 = &quot;cn=ldap, &quot;.$oudc;
$password = &quot;password&quot;;
$auth = false;
//look up OU
if (!($res = ldap_bind($ldap,$dn2,$password)))
{
  print(ldap_error($ldap) . &quot;&lt;br&gt;&quot;);
  die(&quot;Could not bind to $dn&quot;);
}
else
{
  // set search critia for OU
  $filter = &quot;samaccountname=&quot;.$_POST['username'];
  // search OU
  $sr = ldap_search($ldap,$searchdc,$filter);
  if (!$sr)
  {
    die(&quot;search failed\n&quot;);
  }
  else
  {
    // get fields from search
    $info = ldap_get_entries($ldap,$sr);
    if ($info[&quot;count&quot;] == 0)
    {
      $auth = false;
    }
    else
    {
      $auth = true;
      $user_cn = $info[0][&quot;cn&quot;][0];
    }
    // disconnect from LDAP server
    ldap_unbind($ldap);
  }
}
if ($auth == false)
{
  die(&quot;Could not authenticate you to the Active Directory Server.&quot;);
}

$ldap = ldap_connect(&quot;172.17.1.11&quot;) or die(&quot;Cannot connect to AD server :/&quot;);
$oudc = &quot;cn=users, dc=thompsonhealth, dc=org&quot;;
$dn2 = &quot;cn=&quot;.$user_cn.&quot;, &quot;.$oudc;
$password = $_POST['password'];

//look up OU
if (!($res = ldap_bind($ldap,$dn2,$password)))
{
  $login = 0;
  $message = &quot;Invalid Active Directory Password.&quot;;
}
else
{
  $sr = ldap_search($ldap,&quot;dc=thompsonhealth, dc=org&quot;,&quot;cn=&quot;.$user_cn);
  $info = ldap_get_entries($ldap,$sr);
  $login = 1;
  $message = &quot;You have successfully logged in to Active Directory.&lt;br&gt;
	&lt;ul&gt;
	  &lt;li&gt;Email : &quot;.$info[0]['mail'][0].&quot;&lt;/li&gt;
		&lt;li&gt;Phone Number : &quot;.$info[0]['telephonenumber'][0].&quot;&lt;/li&gt;
	&lt;/ul&gt;&quot;;
}

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008048.html">[nycphp-talk] MAC development environment
</A></li>
	<LI>Next message: <A HREF="008051.html">[nycphp-talk] MAC development environment
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8055">[ date ]</a>
              <a href="thread.html#8055">[ thread ]</a>
              <a href="subject.html#8055">[ subject ]</a>
              <a href="author.html#8055">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
