<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] New PHundamentals Article
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2004-January/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20New%20PHundamentals%20Article&In-Reply-To=%3C3FF989E4.1000802%40phpwerx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006951.html">
   <LINK REL="Next"  HREF="006954.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] New PHundamentals Article</H1>
    <B>Dan Cech</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20New%20PHundamentals%20Article&In-Reply-To=%3C3FF989E4.1000802%40phpwerx.net%3E"
       TITLE="[nycphp-talk] New PHundamentals Article">dcech at phpwerx.net
       </A><BR>
    <I>Mon Jan  5 10:59:32 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="006951.html">[nycphp-talk] New PHundamentals Article
</A></li>
        <LI>Next message: <A HREF="006954.html">[nycphp-talk] New PHundamentals Article
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6952">[ date ]</a>
              <a href="thread.html#6952">[ thread ]</a>
              <a href="subject.html#6952">[ subject ]</a>
              <a href="author.html#6952">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the code John,

It is really preferable to take care of magic_quotes_gpc at the 
beginning of the script, rather than at the time of insertion into the 
database.  By doing it that way any validation, redisplay, etc of 
submitted data can be done without needing to worry about the effects of 
magic_quotes.

 From the looks of your code it should be very easy to convert it into 
an ADOdb wrapper library.

Dan

John Lacey wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Jeff Siegel wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> We're starting off the New Year with a new PHundamentals article 
</I>&gt;&gt;<i> entitled &quot;Storing Data Submitted From a Form and Displaying Data from 
</I>&gt;&gt;<i> a Database.&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> See: <A HREF="http://phundamentals.nyphp.org/">http://phundamentals.nyphp.org/</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> Here's a file for phpTest I've modified to add SQLite support.  It 
</I>&gt;<i> illustrates a way of handling different escape methods depending on 
</I>&gt;<i> whether magic_quotes_gpc is on or off.
</I>&gt;<i> The next step is to convert it to use ADODB.
</I>&gt;<i> 
</I>&gt;<i> you're welcome to post the prep_vars() snippet or whatever
</I>&gt;<i> 
</I>&gt;<i> John
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> db_host = DB_HOST; $this-&gt;db_username = DB_USERNAME; $this-&gt;db_password 
</I>&gt;<i> = DB_PASSWORD; $this-&gt;db_use_pconnect = DB_USE_PCONNECT; 
</I>&gt;<i> $this-&gt;default_db = DEFAULT_DB; $this-&gt;db_type = DB_TYPE; $this-&gt;db_mode 
</I>&gt;<i> = DB_MODE; // added SQLITE open database file mode $this-&gt;debug = FALSE; 
</I>&gt;<i> $this-&gt;logfile = 'db_queries.txt'; if ($this-&gt;debug) { $this-&gt;fp = 
</I>&gt;<i> fopen($this-&gt;logfile, 'a'); } if ($this-&gt;db_use_pconnect) { 
</I>&gt;<i> $this-&gt;pconnect($this-&gt;default_db); } else { 
</I>&gt;<i> $this-&gt;connect($this-&gt;default_db); } if (($this-&gt;db_type != 'mysql') &amp;&amp; 
</I>&gt;<i> ($this-&gt;db_type != 'sqlite')) { die(&quot;Invalid database type in 
</I>&gt;<i> config.inc.php&quot;); } } function affected_rows($result) { switch 
</I>&gt;<i> ($this-&gt;db_type) { case 'mysql': return 
</I>&gt;<i> mysql_affected_rows($this-&gt;result); case 'sqlite': return 
</I>&gt;<i> sqlite_changes($this-&gt;link_id); } } function auto_insert($table_name = 
</I>&gt;<i> '') { switch ($this-&gt;db_type) { case 'mysql': $value = 'NULL'; break; 
</I>&gt;<i> case 'sqlite': $value = 'NULL'; break; } if ($this-&gt;debug) echo 
</I>&gt;<i> &quot;auto_insert is $value
</I>&gt;<i> &quot;; return $value; } function connect($db_name) { switch ($this-&gt;db_type) 
</I>&gt;<i> { case 'mysql': $this-&gt;link_id = mysql_connect($this-&gt;db_host, 
</I>&gt;<i> $this-&gt;db_username, $this-&gt;db_password) or $this-&gt;sql_error(); 
</I>&gt;<i> mysql_select_db($db_name, $this-&gt;link_id) or $this-&gt;sql_error(); break; 
</I>&gt;<i> case 'sqlite': $this-&gt;link_id = sqlite_open($this-&gt;default_db, 
</I>&gt;<i> $this-&gt;db_mode, &amp;$this-&gt;sqlite_error_msg) or $this-&gt;sql_error(); break; 
</I>&gt;<i> } if ($this-&gt;debug) { fwrite($this-&gt;fp, $this-&gt;format_date() . &quot; --- 
</I>&gt;<i> Connected to &quot; . $this-&gt;db_type . &quot;---\n&quot;); } return; } // this function 
</I>&gt;<i> only used for escape in uploaded images function escape_data($data, 
</I>&gt;<i> $size = 0) { switch ($this-&gt;db_type) { case 'mysql': $escaped_data = 
</I>&gt;<i> addslashes($data); break; case 'sqlite': $escaped_data = 
</I>&gt;<i> sqlite_escape_string($data); break; } return $escaped_data; } function 
</I>&gt;<i> insert_id() { switch ($this-&gt;db_type) { case 'mysql': $insert_id = 
</I>&gt;<i> mysql_insert_id($this-&gt;link_id); break; case 'sqlite': $insert_id = 
</I>&gt;<i> sqlite_last_insert_rowid($this-&gt;link_id); break; } if ($this-&gt;debug) { 
</I>&gt;<i> fwrite($this-&gt;fp, $this-&gt;format_date() . &quot; Insert ID is &quot; . $insert_id . 
</I>&gt;<i> &quot;\n&quot;); } return $insert_id; } function fetch_array($result, $row = '0') 
</I>&gt;<i> { switch ($this-&gt;db_type) { case 'mysql': return 
</I>&gt;<i> mysql_fetch_array($result); case 'sqlite': return 
</I>&gt;<i> sqlite_fetch_array($result); } } function fetch_object($result, $row = 
</I>&gt;<i> '0') { switch ($this-&gt;db_type) { case 'mysql': return 
</I>&gt;<i> mysql_fetch_object($result); case 'sqlite': if 
</I>&gt;<i> (sqlite_has_more($result)) { return (object)sqlite_fetch_array($result, 
</I>&gt;<i> SQLITE_ASSOC); } else { return FALSE; } } } function fetch_row($result, 
</I>&gt;<i> $row = '') { switch ($this-&gt;db_type) { case 'mysql': return 
</I>&gt;<i> mysql_fetch_row($result); case 'sqlite': return 
</I>&gt;<i> sqlite_fetch_array($result, SQLITE_NUM); } } function format_date() { 
</I>&gt;<i> switch ($this-&gt;db_type) { case 'mysql': return date('Y-m-d H:i:s'); // 
</I>&gt;<i> 2001-12-06 18:00:00 case 'sqlite': return date('Y-m-d H:i:s'); } } // 
</I>&gt;<i> returns an array with the field names for a given table_name function 
</I>&gt;<i> list_fields($table_name) { switch ($this-&gt;db_type) { case 'mysql': 
</I>&gt;<i> $fields = mysql_list_fields($this-&gt;default_db, $table_name, 
</I>&gt;<i> $this-&gt;link_id); $columns = mysql_num_fields($fields); for ($i = 0; $i &lt; 
</I>&gt;<i> $columns; $i++) { $field[] = mysql_field_name($fields, $i); } break; 
</I>&gt;<i> case 'sqlite': // TODO: this function only called from config_views -- 
</I>&gt;<i> not used break; } // if ($this-&gt;debug) echo '
</I>&gt;<i> ' . print_r($field) . '
</I>&gt;<i> '; sort($field); return $field; } function num_rows($result) { switch 
</I>&gt;<i> ($this-&gt;db_type) { case 'mysql': $numrows = mysql_num_rows($result); 
</I>&gt;<i> break; case 'sqlite': $numrows = sqlite_num_rows($result); break; } if 
</I>&gt;<i> ($this-&gt;debug) { fwrite($this-&gt;fp, $this-&gt;format_date() . &quot; Numrows is 
</I>&gt;<i> $numrows\n&quot;); } return $numrows; } function pconnect($db_name) { switch 
</I>&gt;<i> ($this-&gt;db_type) { case 'mysql': $this-&gt;link_id = 
</I>&gt;<i> mysql_pconnect($this-&gt;db_host, $this-&gt;db_username, $this-&gt;db_password); 
</I>&gt;<i> if (!$this-&gt;link_id) { $this-&gt;sql_error(); // database connection failed 
</I>&gt;<i> } if (!mysql_select_db($db_name)) { $this-&gt;sql_error(); // unable to 
</I>&gt;<i> select database } break; case 'sqlite': $this-&gt;link_id = 
</I>&gt;<i> sqlite_popen($this-&gt;default_db, $this-&gt;db_mode, 
</I>&gt;<i> &amp;$this-&gt;sqlite_error_msg); if (!$this-&gt;link_id) { $this-&gt;sql_error(); } 
</I>&gt;<i> break; } if ($this-&gt;debug) { fwrite($this-&gt;fp, $this-&gt;format_date() . &quot; 
</I>&gt;<i> --- Connected to &quot; . $this-&gt;db_type . &quot;---\n&quot;); } } function prep_vars() 
</I>&gt;<i> { $num_args = func_num_args(); $vars = array(); $magic_quotes_gpc = 
</I>&gt;<i> get_magic_quotes_gpc(); switch ($this-&gt;db_type) { case 'mysql': if 
</I>&gt;<i> ($magic_quotes_gpc) { for ($i = 0; $i &lt; $num_args; $i++) { $vars[$i] = 
</I>&gt;<i> func_get_arg($i); } } else { for ($i = 0; $i &lt; $num_args; $i++) { 
</I>&gt;<i> $vars[$i] = addslashes(func_get_arg($i)); } } break; case 'sqlite': if 
</I>&gt;<i> ($magic_quotes_gpc) { for ($i = 0; $i &lt; $num_args; $i++) { $vars[$i] = 
</I>&gt;<i> sqlite_escape_string(stripslashes(func_get_arg($i))); } } else { for ($i 
</I>&gt;<i> = 0; $i &lt; $num_args; $i++) { $vars[$i] = 
</I>&gt;<i> sqlite_escape_string(func_get_arg($i)); } } break; } return $vars; } 
</I>&gt;<i> function query($sql_query) { if ($this-&gt;debug) { fwrite($this-&gt;fp, 
</I>&gt;<i> $this-&gt;format_date() . &quot; Query: $sql_query\n&quot;); } switch 
</I>&gt;<i> ($this-&gt;db_type) { case 'mysql': $result = mysql_query($sql_query, 
</I>&gt;<i> $this-&gt;link_id); break; case 'sqlite': $result = 
</I>&gt;<i> sqlite_query($sql_query, $this-&gt;link_id); break; } if (!$result) { 
</I>&gt;<i> $this-&gt;sql_error($sql_query); } return $result; } function 
</I>&gt;<i> sql_error($query = FALSE) { global $admin_email; switch ($this-&gt;db_type) 
</I>&gt;<i> { case 'mysql': $this-&gt;sql_error_number = mysql_errno($this-&gt;link_id); 
</I>&gt;<i> $this-&gt;sql_error_name = mysql_error($this-&gt;link_id); break; case 
</I>&gt;<i> 'sqlite': $this-&gt;sql_error_name = 
</I>&gt;<i> sqlite_error_string(sqlite_last_error($this-&gt;link_id)); break; } 
</I>&gt;<i> $admin_blurb = (ADMIN_EMAIL) ? &quot;site administrator &lt;\&quot;mailto:&quot;&gt;&quot; : &quot;site 
</I>&gt;<i> administrator&quot;; echo &quot;
</I>&gt;<i> There was an SQL error. The error message is:
</I>&gt;<i> *$this-&gt;sql_error_name*&quot; . &quot;
</I>&gt;<i> Please notify the $admin_blurb.
</I>&gt;<i> &quot;; if ($this-&gt;debug) { fwrite($this-&gt;fp, $db-&gt;format_date() . &quot; Error: 
</I>&gt;<i> $this-&gt;sql_error_name\n&quot;); } if ($query) { echo &quot;The SQL Query that 
</I>&gt;<i> failed is: *$query*&quot;; } die(); } } ?&gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> talk mailing list
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006951.html">[nycphp-talk] New PHundamentals Article
</A></li>
	<LI>Next message: <A HREF="006954.html">[nycphp-talk] New PHundamentals Article
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6952">[ date ]</a>
              <a href="thread.html#6952">[ thread ]</a>
              <a href="subject.html#6952">[ subject ]</a>
              <a href="author.html#6952">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
