<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Phundamentals Title Change: Email Header Injection
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2005-September/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Phundamentals%20Title%20Change%3A%20Email%20Header%20Injection&In-Reply-To=%3C0MKp2t-1EIknW2BEN-0006Gg%40mrelay.perfora.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016006.html">
   <LINK REL="Next"  HREF="016075.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Phundamentals Title Change: Email Header Injection</H1>
    <B>Hans Zaunere</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Phundamentals%20Title%20Change%3A%20Email%20Header%20Injection&In-Reply-To=%3C0MKp2t-1EIknW2BEN-0006Gg%40mrelay.perfora.net%3E"
       TITLE="[nycphp-talk] Phundamentals Title Change: Email Header Injection">lists at zaunere.com
       </A><BR>
    <I>Fri Sep 23 06:28:53 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="016006.html">[nycphp-talk] Phundamentals Title Change: Email Header Injection
</A></li>
        <LI>Next message: <A HREF="016075.html">[nycphp-talk] Phundamentals Title Change: Email Header Injection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16070">[ date ]</a>
              <a href="thread.html#16070">[ thread ]</a>
              <a href="subject.html#16070">[ subject ]</a>
              <a href="author.html#16070">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Dan Cech wrote on Monday, September 19, 2005 8:24 AM:
&gt;<i> Jeff &amp; list,
</I>&gt;<i> 
</I>&gt;<i> I believe I managed to avoid weighing into the various debates raging
</I>&gt;<i> back and forth in the thread.
</I>&gt;<i> 
</I>&gt;<i> The idea of checking for particular email addresses in the mail logs
</I>&gt;<i> does seem pretty naive, especially as they are such a throwaway item
</I>&gt;<i> these days.
</I>
This is absolutely true.  However, it is an easy first step to detect the
use of this exploit.  It's not exhaustive by any means (as only recoding
some key input validation code would be), but it can be a first step to
catching this early on.

&gt;<i> Personally I'm of the opinion that these kinds of forms should require
</I>&gt;<i> inputs that are supposed to be email addresses to look like email
</I>&gt;<i> addresses.  Not only will that remove the possibility of this exploit,
</I>&gt;<i> it will also cut down (ever so slightly) on malformed addresses being
</I>&gt;<i> sent through to the mail subsystem.  Good user feedback for 'invalid'
</I>&gt;<i> addresses should allow anyone using the form to 'correct' them, so I
</I>&gt;<i> see little point in blindly accepting something that isn't obviously
</I>&gt;<i> an email address.
</I>&gt;<i>
</I>&gt;<i> The other common vulnerable field seems to be the Subject, though I
</I>&gt;<i> see very little reason not to restrict that (or any other
</I>&gt;<i> non-address) field to something like
</I>&gt;<i> /^([-a-z0-9!@#$%^&amp;*()_\[\]{}\\|;:'&quot;,.&lt;&gt;\/?+= ]+)$/i, especially
</I>&gt;<i> considering the fact that non-ascii characters are usually frowned
</I>&gt;<i> upon in email headers. 
</I>&gt;<i> 
</I>&gt;<i> Also, correct me if I'm wrong but I believe the %0A encoding is purely
</I>&gt;<i> used in the request string, once it gets into PHP it will just see
</I>&gt;<i> either \n or \r, the literal string %0A does not pose any risk to
</I>&gt;<i> emails as a string itself.
</I>
The combination of email address checking and subject field checking is one
way of preventing this exploit.  And of course, it's always a good idea to
validate input, and prevent odd characters from entering your runtime
environment.

However for this particular exploit, it's easy to prevent.  It's simply not
possible for this exploit to work without the Content-Type: string.
Searched for, in a case-insensitive manner, across all submitted form
fields, will detect and thrawt this exploit immediately.

The only caveat that I've found is when character encoding might be
involved.  I haven't seen that it's very common, but it's out there:

<A HREF="http://www.faqs.org/rfcs/rfc2047.html">http://www.faqs.org/rfcs/rfc2047.html</A>

Does anyone have access to a SMTP server that is known to work with
non-ASCII headers for testing?

And as an FYI, Wikipedia scores again with an excellent resource on MIME and
email from a technical perspective:

<A HREF="http://en.wikipedia.org/wiki/MIME">http://en.wikipedia.org/wiki/MIME</A>



---
Hans Zaunere / President / New York PHP
   www.nyphp.org  /  www.nyphp.com



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016006.html">[nycphp-talk] Phundamentals Title Change: Email Header Injection
</A></li>
	<LI>Next message: <A HREF="016075.html">[nycphp-talk] Phundamentals Title Change: Email Header Injection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16070">[ date ]</a>
              <a href="thread.html#16070">[ thread ]</a>
              <a href="subject.html#16070">[ subject ]</a>
              <a href="author.html#16070">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
