<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] worm/virus's hammering feedback scripts?
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2005-September/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20worm/virus%27s%20hammering%20feedback%20scripts%3F&In-Reply-To=%3CPine.BSF.4.58.0509111619520.17701%40emra.pair.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015897.html">
   <LINK REL="Next"  HREF="015901.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] worm/virus's hammering feedback scripts?</H1>
    <B>David Mintz</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20worm/virus%27s%20hammering%20feedback%20scripts%3F&In-Reply-To=%3CPine.BSF.4.58.0509111619520.17701%40emra.pair.com%3E"
       TITLE="[nycphp-talk] worm/virus's hammering feedback scripts?">dmintz at davidmintz.org
       </A><BR>
    <I>Mon Sep 12 14:24:07 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="015897.html">[nycphp-talk] worm/virus's hammering feedback scripts?
</A></li>
        <LI>Next message: <A HREF="015901.html">[nycphp-talk] worm/virus's hammering feedback scripts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15899">[ date ]</a>
              <a href="thread.html#15899">[ thread ]</a>
              <a href="subject.html#15899">[ subject ]</a>
              <a href="author.html#15899">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
I am a little confused about how my contact.php has been abused, or
whether the attack actually succeeded or just annoyed me.

There are fields for contact data such as phone number etc but these are
validated and then end up as part of the message body.

The To (site owner, and me) and Subject headers are hard-coded.  The
user-supplied email goes into Reply-to header as a convenience to the
ultimate human receiver. However, that email is validated against this
regex by HTML_QuickForm:

/^((\&quot;[^\&quot;\f\n\r\t\v\b]+\&quot;)|([\w\!\#\$\%\&amp;\'\*\+\-\~\/\^\`\|\{\}]+(\.[\w\!\#\$\%\&amp;\'\*\+\-\~\/\^\`\|\{\}]+)*))@((\[(((25[0-5])|(2[0-4][0-9])|([0-1]?[0-9]?[0-9]))\.((25[0-5])|(2[0-4][0-9])|([0-1]?[0-9]?[0-9]))\.((25[0-5])|(2[0-4][0-9])|([0-1]?[0-9]?[0-9]))\.((25[0-5])|(2[0-4][0-9])|([0-1]?[0-9]?[0-9])))\])|(((25[0-5])|(2[0-4][0-9])|([0-1]?[0-9]?[0-9]))\.((25[0-5])|(2[0-4][0-9])|([0-1]?[0-9]?[0-9]))\.((25[0-5])|(2[0-4][0-9])|([0-1]?[0-9]?[0-9]))\.((25[0-5])|(2[0-4][0-9])|([0-1]?[0-9]?[0-9])))|((([A-Za-z0-9\-])+\.)+[A-Za-z\-]+))$/


It isn't optimized for readability but I really don't think you can slip
newlines and &quot;\r\nCc: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">whatever at example.org</A>&quot; and 'Content-type:...' in
there. Messages come to me like the following (site domain name changed
for discretion's sake). I looks like the nasty part only made it into the
message body. Does this nevertheless mean the mail function actually sent
mail to the now famous <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jrubin3546 at aol.com</A>?

Date: 11 Sep 2005 16:55:58 -0000
From: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">webmaster at example.org</A>
Reply-To: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
To: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">site-owner at example.org</A>, <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">dmintz at davidmintz.org</A>
Subject: EXAMPLE Mailing List

The following request to be added to the EXAMPLE mailing list was
submitted via EXAMPLE.org on 11-Sep-2005 at 12:55 pm

<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>, <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
Content-Type: multipart/mixed; boundary=&quot;===============2144621942==&quot;
MIME-Version: 1.0
Subject: a29babd0
To: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
bcc: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jrubin3546 at aol.com</A>
From: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>

This is a multi-part message in MIME format.

--===============2144621942==
Content-Type: text/plain; charset=&quot;us-ascii&quot;
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit

bsmiaujtd
--===============2144621942==--
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>, <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>

Business phone <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
Business fax   <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
Cellular       <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
Home phone     <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>
Email          <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jkbfi at example.org</A>

[end example]

Meawhile I have hardened this script along the lines suggested by Hans Z
et al and started logging the state of the input after validation on every
invocation of the script, and these logs show that the bot is being
thwarted and the script is exiting harmlessly, so thank you very much.

I think it's time to propose some white-list style regexps instead of
trying to filter out the evil stuff (thanks Shiflett). For example, would
you agree that a proper name (of a person) in most any Western
European language ought to pass this test?

function checkProperName($name) {
    return preg_match(&quot;/[^a-zA-Z\xC0-\xFF .,'-]/&quot;,$name) == false;
}

---
David Mintz
<A HREF="http://davidmintz.org/">http://davidmintz.org/</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015897.html">[nycphp-talk] worm/virus's hammering feedback scripts?
</A></li>
	<LI>Next message: <A HREF="015901.html">[nycphp-talk] worm/virus's hammering feedback scripts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15899">[ date ]</a>
              <a href="thread.html#15899">[ thread ]</a>
              <a href="subject.html#15899">[ subject ]</a>
              <a href="author.html#15899">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
