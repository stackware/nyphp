<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] worm/virus's hammering feedback scripts? POLISHED VERSION
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2005-September/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20worm/virus%27s%20hammering%20feedback%20scripts%3F%20POLISHED%0A%20VERSION&In-Reply-To=%3C6.2.3.4.2.20050912120926.0244d060%40mail.optonline.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015892.html">
   <LINK REL="Next"  HREF="015913.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] worm/virus's hammering feedback scripts? POLISHED VERSION</H1>
    <B>Michael Southwell</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20worm/virus%27s%20hammering%20feedback%20scripts%3F%20POLISHED%0A%20VERSION&In-Reply-To=%3C6.2.3.4.2.20050912120926.0244d060%40mail.optonline.net%3E"
       TITLE="[nycphp-talk] worm/virus's hammering feedback scripts? POLISHED VERSION">michael.southwell at nyphp.org
       </A><BR>
    <I>Mon Sep 12 12:15:21 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="015892.html">[nycphp-talk] worm/virus's hammering feedback scripts?
</A></li>
        <LI>Next message: <A HREF="015913.html">[nycphp-talk] worm/virus's hammering feedback scripts? POLISHED	VERSION
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15893">[ date ]</a>
              <a href="thread.html#15893">[ thread ]</a>
              <a href="subject.html#15893">[ subject ]</a>
              <a href="author.html#15893">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I polished this up a bit.

IMPORTANT:  Ken's original function did not work in my testing, 
because (1) the \ in \r and \n needed to be escaped, and (2) he had 
the letter O instead of the numeral 0 in the hex numbers.  Somebody 
smarter than I am, please check carefully the modified version included below.
===========================

Problem:
Bot-net scanning to locate php scripts which are vulnerable to a email
header injection exploit. All PHP scripts which send email based on
input data are vulnerable.

Discussion:
A large scale distributed network of machines is currently being
employed to scan php-based websites in search of scripts which are
vulnerable to an injection-style security exploit. The exploit permits
an attacker to send emails to arbitrary destinations. A common target
is the kind of web-based feedback form which submits an email to a
designated address, but any form which results in an email being sent
could be vulnerable. The bot-net script injects malicious email
headers into the form's fields, which are then passed to the mail server.
The mail server parses those headers and then sends email to the
address designated in the maliciously injected headers. We assume the
attacker is collecting a list of vulnerable sites which may be used
later as an open relay for spam or large scale deployment of
viruses/worms.

For more information about the attack, see
<A HREF="http://securephp.damonkohler.com/index.php/Email_Injection">http://securephp.damonkohler.com/index.php/Email_Injection</A>

(Thanks to Billy Reisinger for this link.)

A Google search for the injected email addresses reveals that scans have been
taking place since at least July 8, 2005

Detection and Solution:
The current bot-net probe is known to send its reply to one of several
known email addresses on the following list (current as of this writing:
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jrubin3546 at aol.com</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">mkoch321 at aol.com</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">wnacyiplay at aol.com</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">kshmng at aol.com</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">Homeiragtime at aol.com</A>
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">bergkoch8 at aol.com</A>

Grep through your mail server logs for the list of emails, using a 
command something like this:

grep -f exploitaddresses.lst /var/log/maillog (or wherever your mail 
log is located)

If any are found, cross reference the time of the mailing to times in
your web server logs to help determine the exploitable script. Modify
any such scripts to properly filter input fields, with a function
something like this:

function safe( $name ) {
   return( str_replace(
     array( &quot;\\r&quot;, &quot;\\n&quot;, &quot;%0A&quot;, &quot;%0a&quot;, &quot;%0D&quot;, &quot;%0d&quot;, 
&quot;Content-Type:&quot;, &quot;BCC:&quot;, &quot;bcc:&quot; ),
     &quot;&quot;, $name ) );
}

(Thanks to Ken Robinson for the original version of this function.)

To follow the mailing list thread on this topic, see
<A HREF="http://lists.nyphp.org/pipermail/talk/2005-September/thread.html#16123">http://lists.nyphp.org/pipermail/talk/2005-September/thread.html#16123</A>


Michael Southwell, Vice President for Education
New York PHP
<A HREF="http://www.nyphp.com/training">http://www.nyphp.com/training</A> - In-depth PHP Training Courses 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015892.html">[nycphp-talk] worm/virus's hammering feedback scripts?
</A></li>
	<LI>Next message: <A HREF="015913.html">[nycphp-talk] worm/virus's hammering feedback scripts? POLISHED	VERSION
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15893">[ date ]</a>
              <a href="thread.html#15893">[ thread ]</a>
              <a href="subject.html#15893">[ subject ]</a>
              <a href="author.html#15893">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
