<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] preventing randomized session variable from	changing	when page is refreshed
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20preventing%20randomized%20session%20variable%20from%09changing%0A%09when%20page%20is%20refreshed&In-Reply-To=%3C48ACC144.6060909%40gmx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026566.html">
   <LINK REL="Next"  HREF="026574.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] preventing randomized session variable from	changing	when page is refreshed</H1>
    <B>David Krings</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20preventing%20randomized%20session%20variable%20from%09changing%0A%09when%20page%20is%20refreshed&In-Reply-To=%3C48ACC144.6060909%40gmx.net%3E"
       TITLE="[nycphp-talk] preventing randomized session variable from	changing	when page is refreshed">ramons at gmx.net
       </A><BR>
    <I>Wed Aug 20 21:13:40 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="026566.html">[nycphp-talk] preventing randomized session variable from	changing	when page is refreshed
</A></li>
        <LI>Next message: <A HREF="026574.html">[nycphp-talk] preventing randomized session variable from	changing	when page is refreshed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26569">[ date ]</a>
              <a href="thread.html#26569">[ thread ]</a>
              <a href="subject.html#26569">[ subject ]</a>
              <a href="author.html#26569">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Kristina Anderson wrote:
&gt;<i> Yes, but if I do $_SESSION['cart_id'], it is effectively the same 
</I>&gt;<i> thing, I'm using this random string as an identifier for the unique 
</I>&gt;<i> cart.  This is effectively the same as $_SESSION['session_id'] -- only 
</I>&gt;<i> the name is different.
</I>
And there is no reason to name it differently. I have a script using sessions 
extensively and create a temporary folder using the session string. I have 
code in place that checks if the directory already exists, but session IDs 
generated by PHP are so unique that I yet have to see that code getting 
executed - and that after I don't know how many ten thousand times. I agree 
with John that there is absolutely no reason to generate your own ID.

&gt;<i> the unique identifier is generated when index.php loads, and is passed 
</I>&gt;<i> as a querystring throughout the user's shopping and each product they 
</I>&gt;<i> view/order is tagged with their unique identifier.
</I>
Which isn't necessary if you run session_start() at the top of each page 
before executing any other code and sending anything to the browser.


&gt;<i> The problem is that if they refresh/reload index.php...that value will 
</I>&gt;<i> change and their cart will be nuked.  Which will be bad.  
</I>
Not if you use session_start() as John rightfully mentioned already. As far as 
I know session_start() checks if the requesting browser connection ever 
started a PHP session and if yes, it uses the same session ID again, otherwise 
it generates a new one. And that is exactly that you want. You have an entry 
point such as a login or a &quot;Shop 'til you drop now&quot; button or in your case the 
index.php. When the browser requests that resource for the first time 
session_start() will not find any session ID for that requesting browser 
session. So it creates a new one that can be retrieved via session_id(). And 
that ID does not change when each consecutive script calls session_start() 
before executing any other code and before sending anything to the browser. So 
when you have session_start() as the first line after the opening tag in the 
index.php two things can happen:
a) the current browser connection never had a session ID and a new one is 
generated
b) the current browser connection has already a session ID established and 
uses that one

Especially case b) allows for a browser to call index.php as many times as 
desired and any consecutive request will cause that PHP / the web server 
always end up with exactly the same session ID. And what is even better, PHP 
takes care of getting this to work even when the requesting browser does not 
accept cookies. I think PHP's session handling is absolutely awesome and makes 
things so much easier. I key everything off the session ID, even the name of 
temporary tables in MySQL (you just need to add a _ in front of the ID to 
prevent illegal table names to occur). And the big master key for everything 
is always in place when you just make sure that the first thing to do in a 
script is call session_start().
I have the bad habit to start writing all kinds of things into the session 
array because it gets conveniently carried around for me, but I guess in a 
serious application that involves money you want to keep things on the server.

&gt;<i> One thing that I just thought of a couple minutes ago would be to just 
</I>&gt;<i> use index.php to generate that...then include a new page and exit 
</I>&gt;<i> index.php so they won't ever be going back to that page during the 
</I>&gt;<i> session.
</I>
Well, but they DID get to the initial index.php in the first place, so they 
can get back there again, just by using the back button of their browser. 
Using session_start() will even take care of that.


&gt;<i> 
</I>&gt;<i> As for why I do things the way I do...I am using $_SESSION and not just 
</I>&gt;<i> $_GET which may not have been clear from what I posted.
</I>&gt;<i> 
</I>
I found only one case where GET saved the day in all the years I deal with PHP 
(well, on your schedule it ends up to be maybe only a few months). POST or 
keeping things on the server side and keying off a session ID is better.


What you could do is add code to the index.php to fire some housecleaning 
script that takes care of stale carts. In my projects I store the session ID 
with the user ID and the date / time of login in a table. Each time the main 
page gets loaded I run a quick check against the date / time field and see if 
there are any stale logins. Anything older than a day is considered stale and 
I ditch any temporary directories, tables, and eventually the login entry 
itself. That works reasonably well for my purposes and cleans up the crud for 
all those cases where the user did not log out, which I assume will happen 
often. I doubt that my approach scales well as I hit the database once for 
typically nothing and potentially end up cleaning up a lot of stuff. For 
example on one day I end up with 50000 stale sessions and two days later the 
next user comes along and now I start this big cleanup and let that poor 
bastard wait until I'm done. What might be better is to write the login info 
into a flat file so that a cron / scheduled job can run during slow times and 
kick off a script that does the house cleaning then. There may also be better 
solutions.

Basically, I can only nod in agreement with what John wrote, you do want to 
use session_start().


David


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026566.html">[nycphp-talk] preventing randomized session variable from	changing	when page is refreshed
</A></li>
	<LI>Next message: <A HREF="026574.html">[nycphp-talk] preventing randomized session variable from	changing	when page is refreshed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26569">[ date ]</a>
              <a href="thread.html#26569">[ thread ]</a>
              <a href="subject.html#26569">[ subject ]</a>
              <a href="author.html#26569">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
