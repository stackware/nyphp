<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Hmm, how to count 'online' users?
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2004-August/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Hmm%2C%20how%20to%20count%20%27online%27%20users%3F&In-Reply-To=%3C411B6FBE.6050607%40spacemonkeylabs.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="011069.html">
   <LINK REL="Next"  HREF="011055.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Hmm, how to count 'online' users?</H1>
    <B>Mitch Pirtle</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Hmm%2C%20how%20to%20count%20%27online%27%20users%3F&In-Reply-To=%3C411B6FBE.6050607%40spacemonkeylabs.com%3E"
       TITLE="[nycphp-talk] Hmm, how to count 'online' users?">mitchy at spacemonkeylabs.com
       </A><BR>
    <I>Thu Aug 12 09:25:18 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="011069.html">[nycphp-talk] Hmm, how to count 'online' users?
</A></li>
        <LI>Next message: <A HREF="011055.html">[nycphp-talk] Hmm, how to count 'online' users?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11053">[ date ]</a>
              <a href="thread.html#11053">[ thread ]</a>
              <a href="subject.html#11053">[ subject ]</a>
              <a href="author.html#11053">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Joseph Crawford Jr. wrote:

&gt;<i>Better yet just count the files that are in your session save directory ;)
</I>&gt;<i>
</I>
I'd love to, but I need to aggregate those counts in groups (&quot;125 people 
in group A&quot; etc.).

One of the biggest issues is lock contention on the accounts table, as 
it is constantly getting hammered with SELECTs ('SELECT count(*) FROM 
accounts WHERE group = 3 AND online = 1'), and constantly getting 
hammered with UPDATEs when 10,000 people show up and login ('UPDATE 
accounts SET online = 1 WHERE id = 12323').

Ultimately, the output would include:

group 1   3,545 online
group 2   4,292 online
group 3   5,123 online
...and so on...

The site gets over 3.5 million page views daily, and averages around 
10,000 people logging in daily.  Served on two dual Xeon servers, the 
hardware is fine, but the statistics in MySQL show that InnoDB has some 
major lock issues:

----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 1823, signal count 1709
Mutex spin waits 153589, rounds 772170, OS waits 437
RW-shared spins 1276, OS waits 587; RW-excl spins 531, OS waits 103


These stats were collected right after a restart in the morning, with 
less than 1,000 people online.

I'm redesigning the site with fixes to the most glaring architectural 
issues (using classes instead of redundant includes scattered randomly 
about the filesystem is a big plus), and also will be switching to 
PostgreSQL ;-)

So again, my biggest dilemma is deciding how to separate the account 
info that is static (username, email) with stuff that is constantly 
changing (online status, last logged in timestamp).  Any pearls of 
wisdom out there?

-- Mitch


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="011069.html">[nycphp-talk] Hmm, how to count 'online' users?
</A></li>
	<LI>Next message: <A HREF="011055.html">[nycphp-talk] Hmm, how to count 'online' users?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#11053">[ date ]</a>
              <a href="thread.html#11053">[ thread ]</a>
              <a href="subject.html#11053">[ subject ]</a>
              <a href="author.html#11053">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
