<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Switch-Case v. if/else
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Switch-Case%20v.%20if/else&In-Reply-To=%3C4A0CCF10.7090404%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028065.html">
   <LINK REL="Next"  HREF="028067.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Switch-Case v. if/else</H1>
    <B>Andrew Muraco</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Switch-Case%20v.%20if/else&In-Reply-To=%3C4A0CCF10.7090404%40gmail.com%3E"
       TITLE="[nycphp-talk] Switch-Case v. if/else">amuraco at gmail.com
       </A><BR>
    <I>Thu May 14 22:10:24 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="028065.html">[nycphp-talk] Switch-Case v. if/else
</A></li>
        <LI>Next message: <A HREF="028067.html">[nycphp-talk] Switch-Case v. if/else
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28066">[ date ]</a>
              <a href="thread.html#28066">[ thread ]</a>
              <a href="subject.html#28066">[ subject ]</a>
              <a href="author.html#28066">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>How about this for an idea:
Write the code so that the switch returns the content of the case as a 
function, this way, you can hopefully avoid having to do all those 
comparisons. (obviously you would then be able to use this anonymous 
function in place of the switch)

Not sure if your code would allow it tho.

-Andrew Muraco

<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">oorza2k5 at gmail.com</A> wrote:
&gt;<i> oops, just sent this to one guy =\
</I>&gt;<i>
</I>&gt;<i> On May 14, 2009 3:52pm, <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">oorza2k5 at gmail.com</A> wrote:
</I>&gt;<i> &gt; Alright! answers :P
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Profiling the code, this script (which bottlenecks on the 
</I>&gt;<i> switch-case) is 82% of execution time __with__ APC. Of the script 
</I>&gt;<i> itself, ~45% of the execution time is this particular switch-case.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I can't send the code, NDA's and whatnot, but it was basically 
</I>&gt;<i> (these are all string comparisons that can't be refactored into 
</I>&gt;<i> numerical comparisons, I pulled two cases out into a loop for that):
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; if($) {
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; } elseif ($b || $c || $d || $e) {
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ) elseif ($f || $g) {
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; } else {
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; After changing it to
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; switch($condition) {
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; case 'a':
</I>&gt;<i> &gt; blah;
</I>&gt;<i> &gt; case 'b':
</I>&gt;<i> &gt; case 'c':
</I>&gt;<i> &gt; case 'd':
</I>&gt;<i> &gt; case 'e':
</I>&gt;<i> &gt; blah
</I>&gt;<i> &gt; case 'f':
</I>&gt;<i> &gt; case 'g':
</I>&gt;<i> &gt; blah
</I>&gt;<i> &gt; default:
</I>&gt;<i> &gt; blah
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; that conditional is about 5% faster.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The script itself isn't slow, it's that it's an autoloader that has 
</I>&gt;<i> to be ran 15-30 times per pageload and there's no viable way to make 
</I>&gt;<i> the necessary infrastructure changes to remove it, nor is it viable to 
</I>&gt;<i> require() manually, as that would take even more time. Before anyone 
</I>&gt;<i> suggests, the original __autoload() was &gt;90% of page time, and I split 
</I>&gt;<i> it into an autoloading class and registered 4 different methods on the 
</I>&gt;<i> autoloading stack ordered, of course, in order from most-&gt;least used.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; One of the things I was thinking about trying was keeping track of 
</I>&gt;<i> classnames and paths in an internal array and serializing that 
</I>&gt;<i> resulting array and pushing it into and pulling it out of APC (in the 
</I>&gt;<i> destructor and constructor, respectively) and the first method on the 
</I>&gt;<i> autoloading stack would check for $this-&gt;includeMap[$className] but 
</I>&gt;<i> I'm unsure if that would be a sane approach or not.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On May 14, 2009 5:38pm, John Campbell <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jcampbell1 at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; PHP should run ~1M switch tests per second on decent hardware.  Either
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; you are misinterpreting you profiling data, or running a switch
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; statement a hell of a lot of time.  I can't imagine any sort of
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; if/else vs switch vs. jump table is going to make much of a
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; difference.  At best you will see a speedup of 30% or so, but that
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; won't really fix the underlying problem.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On Thu, May 14, 2009 at 2:12 PM, Eddie Drapkin <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">oorza2k5 at gmail.com</A>&gt; 
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Does anyone know how the PHP Interpreter pulls switch/case 
</I>&gt;<i> statements
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; together?  Does it emulate a C compiler and, for larger case 
</I>&gt;<i> sets, build a
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; huge if/else cascade? Does it do this always?  Is there any way 
</I>&gt;<i> to know when
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; it builds a jump table (like a s/c is supposed to)?  I've got a 
</I>&gt;<i> slow script
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; (it's eating ~85% of execution time) that I can't work around 
</I>&gt;<i> and one of the
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; slower parts is a switch case (which is slightly faster than 
</I>&gt;<i> manually
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; building an if/else cascade) and was wondering if anyone had any 
</I>&gt;<i> performance
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; tips for cases like these.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; New York PHP User Group Community Talk Mailing List
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; New York PHP User Group Community Talk Mailing List
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> New York PHP User Group Community Talk Mailing List
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028065.html">[nycphp-talk] Switch-Case v. if/else
</A></li>
	<LI>Next message: <A HREF="028067.html">[nycphp-talk] Switch-Case v. if/else
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28066">[ date ]</a>
              <a href="thread.html#28066">[ thread ]</a>
              <a href="subject.html#28066">[ subject ]</a>
              <a href="author.html#28066">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
