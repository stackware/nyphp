<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Emailing from a PHP script
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2007-October/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Emailing%20from%20a%20PHP%20script&In-Reply-To=%3C00ac01c80aa0%24306d8c70%249148a550%24%40com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023556.html">
   <LINK REL="Next"  HREF="023558.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Emailing from a PHP script</H1>
    <B>Anthony Wlodarski</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Emailing%20from%20a%20PHP%20script&In-Reply-To=%3C00ac01c80aa0%24306d8c70%249148a550%24%40com%3E"
       TITLE="[nycphp-talk] Emailing from a PHP script">aw at sap8.com
       </A><BR>
    <I>Tue Oct  9 14:14:10 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023556.html">[nycphp-talk] Emailing from a PHP script
</A></li>
        <LI>Next message: <A HREF="023558.html">[nycphp-talk] readcfg a PERL command?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23565">[ date ]</a>
              <a href="thread.html#23565">[ thread ]</a>
              <a href="subject.html#23565">[ subject ]</a>
              <a href="author.html#23565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is my version of sending items via email, I was creating a site where
you can bounce things to a Verizon or Cingular phone from my server such as
wallpapers.  Has some imaging resizing code in there as well but the code
mostly illustrates how to send multimedia files using the right header
information.

 

&lt;?php

 

// Borrowed from PHP.net

// Edited and commented by Anthony Wlodarski

function send_mail($emailaddress, $fromaddress, $emailsubject, $body, $file)

{

                // create a temp file and resize to 25% of image size if it
is not already smaller than 240 x 320

                $tempfile = $file.&quot;.tmp.jpg&quot;;

                if(copy($file, $tempfile))

                {

                                list($width, $height) =
getimagesize($tempfile);

                }

                else

                {

                                echo &quot;Error creating temp file, try again
later.&quot;;

                }

 

                // we must see how we want to scale the image if width is &gt;
240 pixels

                if($width &gt; 240)

                {

                                $percent = 240/$width;

                                $new_width = $width * $percent;

                                $new_height = $height * $percent;

                }

                else if($height &gt; 320)

                {

                                $percent = 320/$height;

                                $new_width = $width * $percent;

                                $new_height = $height * $percent;

                }

 

                // create our image resource from the temp file

                $image = imagecreatefromjpeg($tempfile);

                // create a resized image

                $imagetemp = imagecreatetruecolor($new_width, $new_height);;

                // resize the image

                imagecopyresampled($imagetemp, $image, 0, 0, 0, 0,
$new_width, $new_height, $width, $height);

                

                // save the resized file into the temp file and send the
message upon success

                if(imagejpeg($imagetemp, $tempfile))

                {

                                // end of line characters

                                $eol=&quot;\r\n&quot;;

                                $mime_boundary=md5(time());

                 

                                //Common Headers

                                $headers .= 'From:
MyName&lt;'.$fromaddress.'&gt;'.$eol;

                                $headers .= 'Reply-To:
MyName&lt;'.$fromaddress.'&gt;'.$eol;

                                $headers .= 'Return-Path:
MyName&lt;'.$fromaddress.'&gt;'.$eol;    // these two to set reply address

                                $headers .= &quot;Message-ID: &lt;&quot;.$now.&quot;
TheSystem@&quot;.$_SERVER['SERVER_NAME'].&quot;&gt;&quot;.$eol;

                                $headers .= &quot;X-Mailer: PHP
v&quot;.phpversion().$eol;          // These two to help avoid spam-filters


 

                                # Boundry for marking the split &amp; Multitype
Headers

                                $headers .= 'MIME-Version: 1.0'.$eol;

                                $headers .= &quot;Content-Type:
multipart/related; boundary=\&quot;&quot;.$mime_boundary.&quot;\&quot;&quot;.$eol;


 

                                $msg = &quot;&quot;;     

 

                                //original php.net code ends here

                                //Anthony W. edits

                                if(is_file($tempfile))

                                {  

                                //File for Attachment

                                                //Find the last occurence of
&quot;/&quot; in the absolute path and then chop

                                $file_name = substr($tempfile,
(strrpos($tempfile, &quot;/&quot;)+1));

                

                                $handle=fopen($tempfile, 'rb');

                                $f_contents=fread($handle,
filesize($tempfile));

 
$f_contents=chunk_split(base64_encode($f_contents));    //Encode The Data
For Transition using base64_encode();

                                fclose($handle);

                                

                                # Attachment

                                $msg .= &quot;--&quot;.$mime_boundary.$eol;

                                $msg .= &quot;Content-Type: image/jpeg;
name=\&quot;&quot;.$file_name.&quot;\&quot;&quot;.$eol;

                                $msg .= &quot;Content-Transfer-Encoding:
base64&quot;.$eol;

                                $msg .= &quot;Content-Disposition: attachment;
filename=\&quot;&quot;.$file_name.&quot;\&quot;&quot;.$eol.$eol; // !! This line needs TWO end of
lines !! IMPORTANT !!

                                $msg .= $f_contents.$eol.$eol;

                                }              

                                else

                                {

                                                echo &quot;Error, file does not
exist&quot;;

                                }

 

                                // Setup for text OR html

                                $msg .= &quot;Content-Type:
multipart/alternative&quot;.$eol;

                

                                // text only messages are sent

                                $msg .= &quot;--&quot;.$mime_boundary.$eol;

                                $msg .= &quot;Content-Type: text/plain;
charset=iso-8859-1&quot;.$eol;

                                $msg .= &quot;Content-Transfer-Encoding:
8bit&quot;.$eol;

                                $msg .= strip_tags(str_replace(&quot;&lt;br&gt;&quot;, &quot;\n&quot;,
$body)).$eol.$eol;

                

                                // end of mime

                                $msg .= &quot;--&quot;.$mime_boundary.&quot;--&quot;.$eol.$eol;
// finish with two eol's for better security. see Injection.

   

                                // send the email

                                ini_set(sendmail_from,$fromaddress);  // the
INI lines are to force the From Address to be used !

                                mail($emailaddress, $emailsubject, $msg,
$headers);

                                ini_restore(sendmail_from);

                                echo &quot;Message sent to &quot;.$emailaddress;

                                

                }// end of if(imagecopy...

 

                // delete the temporary file

                unlink($tempfile);

}

 

// store all teh variable posted from the previous html form

// catch the phone number

if($_POST['mobilenum'] == '')

{

                echo 'Phone number must be entered please return to the &lt;a
href=&quot;./index.php?page=uploadimageform&quot;&gt;previous&lt;/a&gt; page.';

}

else

{

                $mobilenum = $_POST['mobilenum'];

                $domobile = true;

}

 

// simple check for email validation

if($_POST['email'] == '')

{

                echo 'Email must be entered please return to the &lt;a
href=&quot;./index.php?page=uploadimageform&quot;&gt;previous&lt;/a&gt; page.';

}

else

{

                $email = $_POST['email'];

                $doemail = true;

}

 

// simple check for email validation

if(isset($_POST['file']))

{

                $file = $_POST['file'];

                $dofile = true;

 

}

else

{

                echo 'File handle has been lost please return to the &lt;a
href=&quot;./index.php?page=uploadimageform&quot;&gt;previous&lt;/a&gt; page.&lt;br/&gt;';

}

 

// simple check for email validation

if(isset($_POST['carrier']))

{

                $carrier = $_POST['carrier'];

                $docarrier = true;

}

else

{

                echo 'Carrier has not been selected please return to the &lt;a
href=&quot;./index.php?page=uploadimageform&quot;&gt;previous&lt;/a&gt; page.&lt;br/&gt;';

}

 

// Message Subject

$emailsubject=&quot;picture&quot;;

 

// Message Body

$body=&quot;&quot;;

 

if($carrier == 'verizon')

{

                $mobilenum .= &quot;@vzwpix.com&quot;;

}

else if($carrier == 'cingular')

{

                $mobilenum .= &quot;@cingularme.com&quot;;

}

 

// call function to resize and send image

send_mail($mobilenum, $email, $emailsubject, $body, $file);

?&gt;

 

Hope this helps in addition to Paul's infol.

 

Anthony Wlodarski

Senior Technical Recruiter

Shulman Fleming &amp; Partners

646-285-0500 x230

<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">aw at sap8.com</A>

 

From: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A> [mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>] On
Behalf Of PaulCheung
Sent: Tuesday, October 09, 2007 8:38 AM
To: NYPHP Talk
Subject: Re: [nycphp-talk] Emailing from a PHP script

 

It must be my birthday today. As I have managed to solve my two knottiest
problems today.

Here is the solution to my email problem

 

&lt;?php session_start; ob_start;

    ini_set(&quot;SMTP&quot;, &quot;smtp.isp.com&quot;);
    ini_set(&quot;smtp_port&quot;, &quot;25&quot;);
    ini_set(&quot;sendmail_from&quot;, <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">admin at isp.com</A>);

 

   $to  = &quot;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">johndoe at hotmail.com</A> &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">johndoe at hotmail.com</A>&gt; &quot;;
   $subject  = &quot;Enter your subject here&quot;;


   $message = &quot;YES IT WORKED @ LONG LAST
                        I can put anything I like here&quot;;


   

   $from  = &quot;FROM: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">admin at isp.com</A> &quot;; 
   mail(&quot;$to&quot;, &quot;$subject&quot;, &quot;$message&quot;, &quot;$from&quot;);


   echo &quot;The email has been sent&quot;;
?&gt;

 

I hope this helps others who are wrestling with the same problem

  

----- Original Message ----- 

From: PaulCheung &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">paulcheung at tiscali.co.uk</A>&gt;  

To: NYPHP Talk &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;  

Sent: Friday, September 14, 2007 4:34 PM

Subject: Re: [nycphp-talk] Emailing from a PHP script

 

Thanks for the solution. I've tried it and it did not work for me

changed php.ini to reflect change rebooted my system. Don't really
understand why it is necessary to download QK SMTP 

Has all my problems been something to do with XAMPP under windows??

 

Paul

 

----- Original Message ----- 

From: Jason Sia &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jsia18 at yahoo.com</A>&gt;  

To: NYPHP Talk &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;  

Sent: Friday, September 14, 2007 4:00 PM

Subject: Re: [nycphp-talk] Emailing from a PHP script

 

ok that will not really work 
you should use SMTP=localhost then download QK SMTP Server to make this
work.

----- Original Message ----
From: PaulCheung &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">paulcheung at tiscali.co.uk</A>&gt;
To: NYPHP Talk &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
Sent: Friday, September 14, 2007 10:37:11 PM
Subject: Re: [nycphp-talk] Emailing from a PHP script

Yes, that is correct.

Has this anything to do with my problem?

 

 

----- Original Message ----- 

From: Jason Sia &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">jsia18 at yahoo.com</A>&gt;  

To: NYPHP &lt;mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;  Talk 

Sent: Friday, September 14, 2007 3:24 PM

Subject: Re: [nycphp-talk] Emailing from a PHP script

 

you are just using XAMPP for windows right?

----- Original Message ----
From: Ken Robinson &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">kenrbnsn at rbnsn.com</A>&gt;
To: NYPHP Talk &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>&gt;
Sent: Friday, September 14, 2007 9:32:07 PM
Subject: Re: [nycphp-talk] Emailing from a PHP script

At 09:09 AM 9/14/2007, PaulCheung wrote:
&gt;<i>Can anybody see what I am doing wrong??
</I>&gt;<i>
</I>&gt;<i>I have set php.ini (as per the manual) to my email settings
</I>&gt;<i>======================================
</I>&gt;<i>[mail function]
</I>&gt;<i>; For Win32 only.
</I>&gt;<i>SMTP = smtp.tiscali.co.uk
</I>&gt;<i>smtp_port = 25
</I>&gt;<i>
</I>&gt;<i>; For Win32 only.
</I>&gt;<i>sendmail_from = <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">paulcheung at tiscali.co.uk</A>
</I>&gt;<i>========================================================
</I>&gt;<i>I run the script and the following message appears
</I>
Did you restart your web server (Apache?) after making the changes to 
the PHP.INI file? This has to be done for the changes to take affect.

Ken 

_______________________________________________
New York PHP Community Talk Mailing List
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>

NYPHPCon 2006 Presentations Online
<A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>

Show Your Participation in New York PHP
<A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>

 


Send instant messages to your online friends <A HREF="http://uk.messenger.yahoo.com">http://uk.messenger.yahoo.com</A> 

_______________________________________________
New York PHP Community Talk Mailing List
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>

NYPHPCon 2006 Presentations Online
<A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>

Show Your Participation in New York PHP
<A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>

 


Send instant messages to your online friends <A HREF="http://uk.messenger.yahoo.com">http://uk.messenger.yahoo.com</A> 

  _____  

_______________________________________________
New York PHP Community Talk Mailing List
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>

NYPHPCon 2006 Presentations Online
<A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>

Show Your Participation in New York PHP
<A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>

  _____  

_______________________________________________
New York PHP Community Talk Mailing List
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>

NYPHPCon 2006 Presentations Online
<A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>

Show Your Participation in New York PHP
<A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20071009/3f540e76/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20071009/3f540e76/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023556.html">[nycphp-talk] Emailing from a PHP script
</A></li>
	<LI>Next message: <A HREF="023558.html">[nycphp-talk] readcfg a PERL command?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23565">[ date ]</a>
              <a href="thread.html#23565">[ thread ]</a>
              <a href="subject.html#23565">[ subject ]</a>
              <a href="author.html#23565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
