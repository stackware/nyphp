<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Need About creating search
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2007-November/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Need%20About%20creating%20search&In-Reply-To=%3C1CC7D4BE-A7A5-4006-95CD-0E250BC79E48%40beaffinitive.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024006.html">
   <LINK REL="Next"  HREF="024008.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Need About creating search</H1>
    <B>Rob Marscher</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Need%20About%20creating%20search&In-Reply-To=%3C1CC7D4BE-A7A5-4006-95CD-0E250BC79E48%40beaffinitive.com%3E"
       TITLE="[nycphp-talk] Need About creating search">rmarscher at beaffinitive.com
       </A><BR>
    <I>Tue Nov 27 16:37:39 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024006.html">[nycphp-talk] Need About creating search
</A></li>
        <LI>Next message: <A HREF="024008.html">[nycphp-talk] Need About creating search
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24007">[ date ]</a>
              <a href="thread.html#24007">[ thread ]</a>
              <a href="subject.html#24007">[ subject ]</a>
              <a href="author.html#24007">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Nov 27, 2007, at 11:21 AM, Mitch Pirtle wrote:
&gt;<i> <A HREF="http://www.sphinxsearch.com/">http://www.sphinxsearch.com/</A>
</I>&gt;<i>
</I>&gt;<i> Basically it is the fastest search tool I have found anywhere on any
</I>&gt;<i> platform. Wicked fast, and pretty decent interfaces for a variety of
</I>&gt;<i> languages as well. Using it on some major projects now with millions
</I>&gt;<i> of content entries submitted by users - this is a great environment
</I>&gt;<i> for huge social sites.
</I>
+1.  We're using it here: <A HREF="http://www.heynielsen.com/search/">http://www.heynielsen.com/search/</A> (sorry for  
the promo... but it seemed that people wanted to see it in action)

What I love about it is the way it uses mysql as the source for the  
index.  All you need to do is setup the sphinx.conf file and set a  
cron to periodically rebuild the indexes.  No other programming  
required to create the indexes.  They already have a php api class  
which is including the server download... so searching it from php is  
simple too.  Documentation on the api could use some help though...  
have to get the details by reading the source... maybe I should  
contribute.

You can search multiple indexes in one Query by separating the indexes  
by a space.  That's not documented as far as I know.  I discovered it  
in the sphinx forums.  You can also just search every index you have  
available in one query.  Here's some code that I use.  I have a main  
index - &quot;mainIndex&quot; - that I reindex once an hour (it indexes over  
100,000 records in a couple seconds and then sends a sighup so that  
the search server reloads the index).  I also have a &quot;delta&quot; index  
that contains only the new entries since the last time the main index  
was reindexed.  I do this every couple minutes and the operation takes  
under a second.  They talk about how to do this in the documentation.   
I also created stemmed and soundex indexes... so if no results were  
found in the regular index, it tries those other indexes next:

$spx = new SphinxClient();
$spx-&gt;SetServer($host, $port);
$spx-&gt;SetWeights(array(100, 1));
$spx-&gt;SetLimits(0, 250);
$spx-&gt;SetMatchMode(SPH_MATCH_ALL);
$spx-&gt;SetFilter('category', array($category));
$spx-&gt;SetSortMode(SPH_SORT_RELEVANCE);
$_rs = $spx-&gt;Query($search, 'mainIndex mainIndexDelta');
if (count($_rs['matches']) == 0) {
	// give another try with the soundex index &lt;- love this!! :)
	$_rs = $spx-&gt;Query($search, 'mainIndexSoundex mainIndexSoundexDelta');
}
if (count($_rs['matches']) == 0) {
	// still no results?  how about stemming
	$_rs = $spx-&gt;Query($search, 'mainIndexStemmed mainIndexStemmedDelta');
}
if (count($_rs['matches']) == 0) {
	// still no results?  how about a different match mode
	$spx-&gt;SetMatchMode(SPH_MATCH_ANY);
	$spx-&gt;SetLimits(0, 20);
	$_rs = $spx-&gt;Query($search, 'mainIndex mainIndexDelta');
}

The search only returns the primary keys for the matched records.  You  
then have to do a separate mysql query to get any extra details... but  
you'd be surprised how fast searching mysql via those primary keys  
is.  You don't need any where clause because your search has already  
been narrowed.

-Rob


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024006.html">[nycphp-talk] Need About creating search
</A></li>
	<LI>Next message: <A HREF="024008.html">[nycphp-talk] Need About creating search
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24007">[ date ]</a>
              <a href="thread.html#24007">[ thread ]</a>
              <a href="subject.html#24007">[ subject ]</a>
              <a href="author.html#24007">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
