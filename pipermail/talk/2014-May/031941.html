<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Promote Secure Coding
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2014-May/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Promote%20Secure%20Coding&In-Reply-To=%3CCAAyV7nH2EYapQ_J7Qrnze07ZqsXkeM7uQoT%3Djt5Ki8xyzuL4qw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031939.html">
   <LINK REL="Next"  HREF="031944.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Promote Secure Coding</H1>
    <B>Anthony Ferrara</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Promote%20Secure%20Coding&In-Reply-To=%3CCAAyV7nH2EYapQ_J7Qrnze07ZqsXkeM7uQoT%3Djt5Ki8xyzuL4qw%40mail.gmail.com%3E"
       TITLE="[nycphp-talk] Promote Secure Coding">ircmaxell at gmail.com
       </A><BR>
    <I>Thu May 22 11:35:39 EDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="031939.html">[nycphp-talk] Promote Secure Coding
</A></li>
        <LI>Next message: <A HREF="031944.html">[nycphp-talk] Promote Secure Coding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31941">[ date ]</a>
              <a href="thread.html#31941">[ thread ]</a>
              <a href="subject.html#31941">[ subject ]</a>
              <a href="author.html#31941">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gary,

On Thu, May 22, 2014 at 10:26 AM, Gary Mort &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">garyamort at gmail.com</A>&gt; wrote:
&gt;<i> On 05/21/2014 02:32 PM, Anthony Ferrara wrote:
</I>&gt;&gt;<i> First off, I do $name = $_GET['name']. I filter when I know what's
</I>&gt;&gt;<i> going to happen with it (such as when it gets bound against a data
</I>&gt;&gt;<i> model).
</I>&gt;<i> But your not a novice programmer, so this doesn't apply to you. Though
</I>&gt;<i> personally, I wouldn't do $name = $_GET['name'].  I'd use $name =
</I>&gt;<i> filter_input(INPUT_GET, 'name', FILTER_UNSAFE_RAW)
</I>
Then you completely missed the point of what my intention was. And why
in the world would you use FILTER_UNSAFE_RAW over $_GET['name']? There
is quite literally no benefit. And you're running it through a method
for literally no reason. Exposing yourself to potential bugs in the
process.

Aim for readability, use input directly.

&gt;<i> $_GET is fine when you are writing code for a specific platform where you
</I>&gt;<i> know in advance what the configuration will be.
</I>&gt;<i>
</I>&gt;<i> However, I'm seeing a lot of linux distro's have started set filter_default
</I>&gt;<i> to FILTER_SANITIZE_STRING in their PHP install packages.
</I>
And that's a horrific idea. And one reason you should avoid the
filter_* APIs at all costs.

&gt;<i> I prefer writing code which doesn't depend on specific php.ini directives in
</I>&gt;<i> order to work.
</I>
That has nothing to do with what we're talking about. I'm talking
about using request information directly.

If you're using a framework, use its request object. If you're not,
use the superglobals directly.

But please don't use filter_*. You think you're making yourself safer.
It tells you it's safer, but it's not. In many cases, it's worse.

&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Example: you're using filter_var with FILTER_SANITIZE_STRING. Do you
</I>&gt;&gt;<i> know what that *really* means under the hood?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It's really no better than running strip_tags. And we know that we
</I>&gt;&gt;<i> shouldn't be running strip_tags, right?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> For this use case, yes we should.
</I>
Absolutely not. strip_tags is known to be unsafe. It's not something
you should rely upon for security. And that's what we're talking about
here.

&gt;<i> Consider the secretary updating their company website.  They have been told
</I>&gt;<i> that they need some landing page to say &quot;Welcome &lt;name&gt;&quot; at the top.
</I>&gt;<i>
</I>&gt;<i> The pages are mostly html with a bit of PHP here and there.  So they go to
</I>&gt;<i> an online tutorial, go through steps 1-4 where they learn about &quot;hello
</I>&gt;<i> world&quot; which is a simple little tutorial of
</I>&gt;<i> $name = $_GET['name'];
</I>&gt;<i> echo &quot;Hello $name&quot;;
</I>
Who said to `echo &quot;Hello $name&quot;`? I sure didn't.

I said you need to escape and encode properly for the output context.
If you're rendering to HTML, as a property or as a text node, you
**must** use htmlspecialchars. And you **must** use it properly:

echo &quot;Hello &quot; . htmlspecialchars($name, ENT_QUOTES | ENT_DISALLOWED |
ENT_HTML5, &quot;utf-8&quot;);

Anything else is likely going to have holes in it that would allows
you to possibly exploit certain circumstances (just like strip_tags
does).

Yes, that's a lot to write, but more on that in a minute.

&gt;<i> Well, that's good enough for their needs.  A small tweak and now they have
</I>&gt;<i> the page and the company sends out e-mail to their clients and all they have
</I>&gt;<i> to do is add ?name=XXX on the e-mail.
</I>&gt;<i>
</I>&gt;<i> They ALSO have a horrible cross site scripting issue where someone else can
</I>&gt;<i> craft custom links to their website and insert any html and javascript they
</I>&gt;<i> want to.
</I>
Which is why you never output unescaped data. But the point is that
you escape it **on output**. NOT on input.

&gt;<i> Strip tags is the correct solution for 90% of introductory coding. It
</I>&gt;<i> sanitizes the input from a bunch of common exploits.   On the downside, it
</I>&gt;<i> removes all text from within angle brackets - but 95% of all minor uses of
</I>&gt;<i> PHP it means everything just works.
</I>
It absolutely is not. It's very well understood that it's not ideal:

Example: <A HREF="http://stackoverflow.com/questions/3605629/php-prevent-xss-with-strip-tags">http://stackoverflow.com/questions/3605629/php-prevent-xss-with-strip-tags</A>
Example: <A HREF="https://isisblogs.poly.edu/2013/07/02/php-strip_tags-not-a-complete-protection-against-xss-repost-from-archive/">https://isisblogs.poly.edu/2013/07/02/php-strip_tags-not-a-complete-protection-against-xss-repost-from-archive/</A>
Example: <A HREF="http://security.stackexchange.com/questions/10011/is-strip-tags-horribly-unsafe">http://security.stackexchange.com/questions/10011/is-strip-tags-horribly-unsafe</A>
Example: <A HREF="http://forums.devshed.com/php-development-5/strip_tags-removes-html-tags-stop-xss-934238.html">http://forums.devshed.com/php-development-5/strip_tags-removes-html-tags-stop-xss-934238.html</A>

Instead, you should follow actual recommendations on the subject:
<A HREF="https://www.owasp.org/index.php/XSS_%28Cross_Site_Scripting%29_Prevention_Cheat_Sheet">https://www.owasp.org/index.php/XSS_%28Cross_Site_Scripting%29_Prevention_Cheat_Sheet</A>

&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And that's why a solution like you're proposing is bad. It conflates
</I>&gt;&gt;<i> filtering with escaping. And that's **always** a bad thing.
</I>&gt;<i>
</I>&gt;<i> Nope, all solutions are based on what is simplest, what performs best, what
</I>&gt;<i> is most comprehensive, and what is most appropriate.
</I>
And what you're recommending is neither simplest, best, most
comprehensive or appropriate.

&gt;<i> My solution maximizes simplest - because that is the most important thing
</I>&gt;<i> for beginning programmers. And deals with what is most appropriate for new
</I>&gt;<i> programmers.
</I>
There are easier solutions that that. But more on that in a second.

&gt;<i> When people are learning, they put the code up on whatever 'temporary' web
</I>&gt;<i> space they have at hand.  Whether that is a godaddy site they just setup, a
</I>&gt;<i> subdirectory on an active website someone has given them, on virtual systems
</I>&gt;<i> running as subdomains for a university vps123.sandbox.marist.edu [which
</I>&gt;<i> means that they can set cookie information for the entire marist.edu domain]
</I>&gt;<i>
</I>&gt;<i> And when their done, they forget about it and leave it running - publicly
</I>&gt;<i> accessible and exploitable.
</I>&gt;<i>
</I>&gt;<i> That harms everyone on the internet - because those exploitable bits of code
</I>&gt;<i> are used as launching points for denial of service attacks, controlling
</I>&gt;<i> e-mail spam botnets, and many more.
</I>&gt;<i>
</I>&gt;<i> Furthermore, unlike most solutions out there, using an anonmous function
</I>&gt;<i> tied to a variable means that as programmer learns, they can grow and make
</I>&gt;<i> it better.
</I>&gt;<i>
</I>&gt;<i> Eventually, they will get to the point where they learn about including
</I>&gt;<i> files and maintaining common code.  So then, instead of sticking 4 lines of
</I>&gt;<i> code at the top of every php file, they can move it all to a file of common
</I>&gt;<i> declarations.
</I>&gt;<i>
</I>&gt;<i> Then they will learn about better ways of filtering data, so instead of
</I>&gt;<i> going through every piece of legacy code that they have, they can instead
</I>&gt;<i> change it in one place.
</I>&gt;<i>
</I>&gt;<i> $get = function($varName, $filter = 'string') {
</I>&gt;<i>
</I>&gt;<i> $var = filter_input(INPUT_GET, $varName, FILTER_UNSAFE_RAW);
</I>&gt;<i> return \Filterus\filter($var, $filter);
</I>&gt;<i> }
</I>
PLEASE NO. This kind of thinking that security is &quot;generic&quot; and
something you can just sprinkle on after the fact and tune is part of
the reason XSS is so prevalant. Because you have people writing
functions like

make_safe($name) {
    return mysql_real_escape_string(addslashes(htmlspecialchars($_REQUEST[$name])));
}

And I strongly hope I don't need to elaborate on why that's a horrific idea.

&gt;<i> If instead they started with using a specific filter library and then
</I>&gt;<i> discover that the library is no longer supported, then they have to go
</I>&gt;<i> throughout ALL their code where they called
</I>&gt;<i> $var = \Filterus\filter($var, $filter);
</I>
Which if you used abstraction, isn't that many places. But more on
that in a minute.

&gt;<i> And change every single instance.... of course, this assumes that they had
</I>&gt;<i> the patience to wait until they reached the course section on filtering
</I>&gt;<i> data.
</I>&gt;<i>
</I>&gt;<i> And for the professional PHP developers, promoting these simple 4 lines has
</I>&gt;<i> an added benefit.  When the small business grows and reaches the point of
</I>&gt;<i> needing to hire a professional - when the professional opens that code up in
</I>&gt;<i> their IDE they can easily find every instance of problem code - since it is
</I>&gt;<i> all flagged with the \\FIXME:  tag which every IDE I know of automatically
</I>&gt;<i> will parse and display a list of ever single instance of those tags[in
</I>&gt;<i> PHPStorm it's View--&gt;Tools--&gt;ToDo]
</I>&gt;<i>
</I>&gt;<i> I'm certainly open to alternatives that actually address the problem: novice
</I>&gt;<i> programmers writing insecure code. <A HREF="https://github.com/ircmaxell/filterus">https://github.com/ircmaxell/filterus</A> as
</I>&gt;<i> it is written right now is not it.  Looking at that page, you have to go all
</I>&gt;<i> the way to the bottom to get something a novice programmer might be able to
</I>&gt;<i> use - and even there what is written is not of any real use.  But then, I
</I>&gt;<i> assume that you didn't write it for the novice programmer, so I don't see a
</I>&gt;<i> problem with it.  Just re-iterating that it doesn't address the same issues
</I>&gt;<i> my solution does.
</I>
The point is that there's a difference between input and output. You
**never** escape input. That's the wrong place to do it. It leads to
second-order injections and XSS. Where you thought the data in the
database was safe, because you escaped it when it came in the first
time. But that doesn't mean it will be safe forever.

Example: what if your escaping routine isn't good enough, and there's
a bug. Now you're screwed. Because you need to change it, but all of
your data is already escaped. So instead, you're stuck having to
either double-encode everything (yuck), or somehow go back and
re-parse everything in the DB to fix it. Both solution SUCK. And I've
done both of them in the past. And it sucked. And you should be doing
that right now, since you're not safe either (as I pointed out,
filter_var doesn't actually protect you from XSS).



The correct way of handling these issues is splitting up filtering
(ensuring input is in a valid data domain) and escaping (ensuring
output is encoded properly for the output context).

For input, Filterus, or even is_string, etc can help a lot. The point
though is that you want to verify that the data is valid to you. Not
that it's safe from XSS. That it's valid for your business purpose.
That's all you should **ever** worry about from input.

For output, the easiest, simplest and most proper way to handle this
sort of thing is by not handling it at all. Use a templating engine
like Twig or Mustache, which will auto-escape for you by default. This
isn't a magic bullet, as output into JS or CSS contexts can still
cause you a lot of pain, but it handles the 98% case quite well. If
you're outputting directly from PHP, either define an escape function
which wraps htmlspecialchars, or don't output directly from PHP.



As far as &quot;catering to the novices&quot;, that's a completely bullshit
phrasing. Novices don't need to be catered to. They don't need things
to be dummbed down. They don't need to be spoon fed. They need to be
educated. And telling them that &quot;just use this and you're fine&quot; is
dangerous. And it's doubly dangerous when what you're suggesting is
not actually fine (as I've pointed out numerous times in this thread.

Never mediate, always educate.

If you think filterus is too hard for a novice to navigate, then
improve the documentation. Make a pull request to make it simpler to
understand. Write a blog post explaining how to properly work these
systems. Don't just assume that just because they are a beginner that
they are too dumb to understand. Most of the time it's simply that
they don't understand the terminology. But if you explain it to them
properly, no problem.

But saying that they should do the wrong thing, which is known to be
insecure, because they won't be able to understand the wright thing,
is horrible.

Anthony
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031939.html">[nycphp-talk] Promote Secure Coding
</A></li>
	<LI>Next message: <A HREF="031944.html">[nycphp-talk] Promote Secure Coding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31941">[ date ]</a>
              <a href="thread.html#31941">[ thread ]</a>
              <a href="subject.html#31941">[ subject ]</a>
              <a href="author.html#31941">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
