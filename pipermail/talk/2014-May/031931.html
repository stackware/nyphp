<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Promote Secure Coding
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2014-May/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Promote%20Secure%20Coding&In-Reply-To=%3C537CDEA4.3090409%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031930.html">
   <LINK REL="Next"  HREF="031932.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Promote Secure Coding</H1>
    <B>Gary Mort</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Promote%20Secure%20Coding&In-Reply-To=%3C537CDEA4.3090409%40gmail.com%3E"
       TITLE="[nycphp-talk] Promote Secure Coding">garyamort at gmail.com
       </A><BR>
    <I>Wed May 21 13:13:08 EDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="031930.html">[nycphp-talk] Promote Secure Coding
</A></li>
        <LI>Next message: <A HREF="031932.html">[nycphp-talk] Promote Secure Coding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31931">[ date ]</a>
              <a href="thread.html#31931">[ thread ]</a>
              <a href="subject.html#31931">[ subject ]</a>
              <a href="author.html#31931">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 05/21/2014 11:44 AM, Pierpaolo D'Aimmo wrote:
&gt;<i> Interesting, thank you for the contribution.
</I>&gt;<i> Same rules can be applied to $_REQUEST and $_POST, but I guess you 
</I>&gt;<i> think that's already clear from what you write in the last comments. 
</I>&gt;<i> Unfortunately, many people I think just want ready-made functions to 
</I>&gt;<i> copy and paste.
</I>
I want to create those as seperate articles and then crosslink them 
all.  Yes, the idea is purely for people who are going to cut and paste 
code.  IE all of this would be much better to declare once somewhere 
rather then in every single file - but that all requires at least 3 or 4 
lessons in programming PHP before you get to that point.

$_REQUEST is special in that there is no input stream for it,
<A HREF="http://us1.php.net/manual/en/function.filter-input.php">http://us1.php.net/manual/en/function.filter-input.php</A>

So a $_REQUEST filter either has to reimplement the GPC logic OR it can 
be done by calling filter_var($_REQUEST[$varName], $filter) - both of 
which are not ideal. I know that I at least like to pretend I think I 
know what code I'm cutting and pasting into my programs does so the 
whole GPC testing logic will look confusing.  Wheras using the $_REQUEST 
variable means you can't unset it for safety.

What I really like about using closures is that it becomes novice 
friendly.  If instead I had written:
function get($varName = '')
{
    return filter_input(INPUT_GET, $varName, FILTER_SANITIZE_STRING);
}


Functionally it performs the same, but once the junior programmer starts 
using multiple files, it will break if it is used in multiple files.

As an experienced programmer,
$myvar = $_GET['myvar'];
and
$myvar = filter_input(INPUT_GET, 'myvar', FILTER_SANITIZE_STRING);

Those 2 lines read the same to me.  The second line reads as &quot;I am 
explicitly filtering the data for my needs&quot; while the first line reads 
as &quot;This is just an example and don't use this in real code&quot;.

But beginners aren't going to see that.   And it really frustrates me 
because PHP is such a rich language that it can be used by people who 
have taken a short course on html as well as programmers.  So I feel 
that we[the PHP community] are at fault for insecure PHP programs 
written in the past 10 years.  By not providing and promoting a simple 
means for novices to write more secure code - we allow it to prolifigate.

The secretary updating the company website for a small business is not 
going to bother to go past lesson 3 or 4 when she is told to add an 
input field for subject on the contact form.   She will go as far as she 
needs to figure out she can add $subject = $_GET['subject'] and then be 
done.


&gt;<i> You can make it more complete or be more clear in the &quot;FIXME&quot; line. 
</I>&gt;<i> Also, at least comments shouldn't be self-explained when not talking 
</I>&gt;<i> about them.
</I>&gt;<i> Something like:
</I>&gt;<i> //FIXME: This code is just an example, it's not complete, don't use 
</I>&gt;<i> it, just learn what it does and implement something that suit your 
</I>&gt;<i> real needs.
</I>&gt;<i> // You may want to apply it to other variables as well, or even not 
</I>&gt;<i> use it at all (in some special cases.)
</I>&gt;<i>
</I>
Thanks, I'll take a look.  I also have a couple other versions of the 
same code which I want to post with this one.  The most complex is 
around 30 lines to deal with posted variables.  One of the nice things 
with using INPUT_GET was that even if PHP is configured not to create 
the $_GET superglobal, you can always get the original query info from 
it.   Wheras if you configure PHP not to create the $_POST variable then 
you have to use the <A HREF="php://input">php://input</A> stream  - so it takes a few more lines 
for that as well as adding a set and exists option to filtering.

My thinking is that it can all be crosslinked.  Promote the simple 4 
liners as the minimum, while providing links to more complex bits of 
code like this one which they can grow into:


     // 30ish lines to sanitize and modify query string variables
     // FIXME: make sure to use custom filters for your needs
     unset($_POST); // Force yourself not to use the global variable
     $post = function($varName, $filter=FILTER_SANITIZE_STRING, 
$action='get',$value=null) {
         // Internal variable to allow updating of input data
         static $pRaw = false;
         // Load the post data from input
         if (!is_array($pRaw))
         {
             $postInput = file_get_contents('<A HREF="php://input">php://input</A>');
             echo 'post input is ' . $postInput;
             if ($postInput)
             {
                 parse_str($postInput, $pRaw);
             } else
             {
                 $pRaw = array();
             }
         }
         $return = null;
         if ($action == 'get' &amp; isset($pRaw[$varName]))
         {
             $return  = filter_var($pRaw[$varName], $filter);
         }
         if($action == 'set')
         {
             if (isset($pRaw[$varName]) )
             {
                 $return = $pRaw[$varName];
             }
             $pRaw[$varName] = $value;
         }
         if ($action =='has')
         {
               $return = isset($gRaw[$varName]);
         }
         return $return;
     }
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031930.html">[nycphp-talk] Promote Secure Coding
</A></li>
	<LI>Next message: <A HREF="031932.html">[nycphp-talk] Promote Secure Coding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31931">[ date ]</a>
              <a href="thread.html#31931">[ thread ]</a>
              <a href="subject.html#31931">[ subject ]</a>
              <a href="author.html#31931">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
