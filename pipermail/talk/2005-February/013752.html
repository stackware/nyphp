<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] html php form problem
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2005-February/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20html%20php%20form%20problem&In-Reply-To=%3C421E3532.3070202%40phpwerx.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013751.html">
   <LINK REL="Next"  HREF="013753.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] html php form problem</H1>
    <B>Dan Cech</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20html%20php%20form%20problem&In-Reply-To=%3C421E3532.3070202%40phpwerx.net%3E"
       TITLE="[nycphp-talk] html php form problem">dcech at phpwerx.net
       </A><BR>
    <I>Thu Feb 24 15:12:34 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="013751.html">[nycphp-talk] html php form problem
</A></li>
        <LI>Next message: <A HREF="013753.html">[nycphp-talk] html php form problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13752">[ date ]</a>
              <a href="thread.html#13752">[ thread ]</a>
              <a href="subject.html#13752">[ subject ]</a>
              <a href="author.html#13752">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>One other solution is to embed a one-time token in each form you want to 
protect.  Below is a simplified example:

if (!isset($_SESSION['tokens'])) {
   $_SESSION['tokens'] = array();
}

if (isset($_POST['action'])) {
   if (array_key_exists($_POST['token'],$_SESSION['tokens'])) {
     // do something here

     // unset token so it can't be used again
     unset($_SESSION['tokens'][$_POST['token']]);
   } else {
     // form was submitted twice
   }
}

$token = md5(uniqid());

$_SESSION['tokens'][$token] = time();

&lt;input type=&quot;hidden&quot; name=&quot;token&quot; value=&quot;&lt;?php print 
htmlentities($token);?&gt;&quot; /&gt;

As you may have noticed the code above also stored the issue time for 
each token, so you can also prevent users submitting 'stale' forms.

There are also definite merits to using a system which redirects users 
to result pages after they submit a form, especially in terms of making 
the 'back' button work in an intuitive way.

Dan

Daniel Convissor wrote:
&gt;<i> On Thu, Feb 24, 2005 at 04:54:34PM -0300, Henry Ponce wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>I've been searching for the solution to my problem. I do not want a 
</I>&gt;&gt;<i>form to be 
</I>&gt;&gt;<i>resubmitted when i refresh a page.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> That is not possible as far as I know.  To work around it, process the 
</I>&gt;<i> form in one script and then forward to another page once processing is 
</I>&gt;<i> done:
</I>&gt;<i> 
</I>&gt;<i> form.php
</I>&gt;<i>    &lt;form action=&quot;process.php&quot;&gt;
</I>&gt;<i> 
</I>&gt;<i> process.php
</I>&gt;<i>    &lt;?php
</I>&gt;<i>    // validate and save info
</I>&gt;<i>    if (!$errors) {
</I>&gt;<i>       header('Location: <A HREF="http://host/thanks.php">http://host/thanks.php</A>');
</I>&gt;<i>    }
</I>&gt;<i> 
</I>&gt;<i> thanks.php
</I>&gt;<i>    &lt;h1&gt;Thanks for your submission&lt;/h1&gt;
</I>&gt;<i> 
</I>&gt;<i> --Dan
</I>&gt;<i> 
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013751.html">[nycphp-talk] html php form problem
</A></li>
	<LI>Next message: <A HREF="013753.html">[nycphp-talk] html php form problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13752">[ date ]</a>
              <a href="thread.html#13752">[ thread ]</a>
              <a href="subject.html#13752">[ subject ]</a>
              <a href="author.html#13752">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
