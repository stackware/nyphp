<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Session security: protecting against hijacking	attempts POSSIBLE SOLUTION
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2004-December/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Session%20security%3A%20protecting%20against%20hijacking%0A%09attempts%20POSSIBLE%20SOLUTION&In-Reply-To=%3CBDEF24ED.E287%25corey%40domanistudios.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013031.html">
   <LINK REL="Next"  HREF="013040.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Session security: protecting against hijacking	attempts POSSIBLE SOLUTION</H1>
    <B>corey szopinski</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Session%20security%3A%20protecting%20against%20hijacking%0A%09attempts%20POSSIBLE%20SOLUTION&In-Reply-To=%3CBDEF24ED.E287%25corey%40domanistudios.com%3E"
       TITLE="[nycphp-talk] Session security: protecting against hijacking	attempts POSSIBLE SOLUTION">corey at domanistudios.com
       </A><BR>
    <I>Wed Dec 22 13:19:41 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="013031.html">[nycphp-talk] Session security: protecting against hijacking	attempts POSSIBLE SOLUTION
</A></li>
        <LI>Next message: <A HREF="013040.html">[nycphp-talk] Session security: protecting against hijacking	attempts POSSIBLE SOLUTION
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13038">[ date ]</a>
              <a href="thread.html#13038">[ thread ]</a>
              <a href="subject.html#13038">[ subject ]</a>
              <a href="author.html#13038">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Eric-

One idea to throw in with this: the idea of using a session id along with a
key. The key is generated by an algorithm on the client and the server, and
&#179;merged&#178; into the session id. I&#185;m thinking of something like the md5sum of
the useragent+ip address+seconds since last request. All three values are
known entities to both the client and the server, so you can do the md5sum
on both sides without passing the actual value. Instead, you can merge the
php session id with this md5sum in a way that you can subtract the key to
get the session id. I&#185;m not sure what merging technique to suggest that&#185;s
reversible, but the general idea is to vary the id passed to the server in a
known and predictable way, without it looking predictable (the md5 will look
random). At the end of all of this you get the original session id issued by
the server, without passing that id in the clear.

It&#185;s essentially a poor-man&#185;s SSL. Since the handshake sequence happens on
every request. You won&#185;t be encrypting anything, but you could be 95% sure
that no one is getting in the middle. For extra security, throw in a random
seed generated by the server on the first request and use that in your md5.

Although I have to ask: why not just set up a self-signed certificate for
this?

-c


On 12/22/04 9:36 AM, &quot;Eric Rank&quot; &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">flakie at gmail.com</A>&gt; wrote:

&gt;<i> After thinking hard about what's involved with session hijacking, one
</I>&gt;<i> thing seemed to be the lynchpin in attacks, the session id. If an
</I>&gt;<i> attacker knows the session id, he can hijack the victim's session.
</I>&gt;<i> 
</I>&gt;<i> So my thought was to change the session id with every request. This
</I>&gt;<i> way, the session is only good for a very short time. It also does a
</I>&gt;<i> very adequate job of protecting against session fixation attacks
</I>&gt;<i> (<A HREF="http://www.acros.si/papers/session_fixation.pdf">http://www.acros.si/papers/session_fixation.pdf</A>) because once the
</I>&gt;<i> attackers session is used to gain permissions, it becomes an invalid
</I>&gt;<i> id.
</I>&gt;<i> 
</I>&gt;<i> The php function session_regenerate_id() looked promissing. However,
</I>&gt;<i> it falls a bit short by not deleting the old session id once the new
</I>&gt;<i> session id is generated. So I whipped together a procedure to make it
</I>&gt;<i> work.
</I>&gt;<i> 
</I>&gt;<i> The things that it relies on are 1. the id being hard to catch, and 2.
</I>&gt;<i> the attacker doesn't beat the legit user to the punch. For example,
</I>&gt;<i> let's say an attacker was sniffing the network and sees a session id
</I>&gt;<i> go by. if he goes to a page specifying the stolen session id as his
</I>&gt;<i> own, the legit user will lose all her data in the session because the
</I>&gt;<i> id she specifies on her next page is no longer valid. However, if
</I>&gt;<i> you've got someone sniffing the network, there are probably bigger
</I>&gt;<i> problems to be concerned about.
</I>&gt;<i> 
</I>&gt;<i> To me, the following approach does a fairly adequate job of protecting
</I>&gt;<i> against session hijack attempts. You can use this in addition to other
</I>&gt;<i> validation tests (using cookies with unique id's, using user-agent &amp;
</I>&gt;<i> ip comparisons, etc). I've done some preliminary testing and it seems
</I>&gt;<i> to work ok. I'd love to hear some feedback.
</I>&gt;<i> 
</I>&gt;<i> It goes something like this:
</I>&gt;<i> 
</I>&gt;<i> &lt;?php
</I>&gt;<i> session_start();
</I>&gt;<i> $temp = $_SESSION;  //make a copy of the session
</I>&gt;<i> session_unset(); //clear the session data. probably an unnecessary line
</I>&gt;<i> if (isset($_COOKIE[session_name()])) {   //kill the cookie on the client
</I>&gt;<i>       @setcookie(session_name(), '', time()-42000, '/');
</I>&gt;<i> } 
</I>&gt;<i> 
</I>&gt;<i>  //use this instead of session destroy to kill the session file on the server
</I>&gt;<i> unlink(session_save_path().'/'.'sess_'.session_id());
</I>&gt;<i> 
</I>&gt;<i> session_regenerate_id();  //generate a new session id. this sets a new
</I>&gt;<i> cookie on client as well
</I>&gt;<i> $_SESSION = $temp;  //put the temp info back on the session superglobal
</I>&gt;<i> 
</I>&gt;<i> //The rest of your code that uses sessions below...
</I>&gt;<i> ?&gt;
</I>&gt;<i> 
</I>



Corey Szopinski
Director of Technology

DOMANI STUDIOS
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">corey at domanistudios.com</A>
55 Washington St. Suite 822
Brooklyn, NY 11201
718-797-4470  x116 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20041222/56e5668d/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20041222/56e5668d/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013031.html">[nycphp-talk] Session security: protecting against hijacking	attempts POSSIBLE SOLUTION
</A></li>
	<LI>Next message: <A HREF="013040.html">[nycphp-talk] Session security: protecting against hijacking	attempts POSSIBLE SOLUTION
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13038">[ date ]</a>
              <a href="thread.html#13038">[ thread ]</a>
              <a href="subject.html#13038">[ subject ]</a>
              <a href="author.html#13038">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
