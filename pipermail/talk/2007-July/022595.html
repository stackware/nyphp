<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Inserting duplicate SQL primary keys
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Inserting%20duplicate%20SQL%20primary%20keys&In-Reply-To=%3C46A7AF9C.9040905%40polymerdb.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022594.html">
   <LINK REL="Next"  HREF="022596.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Inserting duplicate SQL primary keys</H1>
    <B>Allen Shaw</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Inserting%20duplicate%20SQL%20primary%20keys&In-Reply-To=%3C46A7AF9C.9040905%40polymerdb.org%3E"
       TITLE="[nycphp-talk] Inserting duplicate SQL primary keys">ashaw at polymerdb.org
       </A><BR>
    <I>Wed Jul 25 16:16:28 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="022594.html">[nycphp-talk] Inserting duplicate SQL primary keys
</A></li>
        <LI>Next message: <A HREF="022596.html">[nycphp-talk] Inserting duplicate SQL primary keys
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22595">[ date ]</a>
              <a href="thread.html#22595">[ thread ]</a>
              <a href="subject.html#22595">[ subject ]</a>
              <a href="author.html#22595">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Cliff Hirsch wrote:
&gt;<i> While testing, I just did a page refresh, which caused this action to be
</I>&gt;<i> repeated:
</I>&gt;<i> 
</I>&gt;<i> $query_string = &quot;INSERT INTO task_category (task_id, category_id) VALUES
</I>&gt;<i> ($taskId, $categoryId)&quot;;
</I>&gt;<i> $this-&gt;dbManager-&gt;DbQuery($query_string);
</I>&gt;<i> 
</I>&gt;<i> Obviously, on the page refresh, it threw an error (DB Error: already
</I>&gt;<i> exists), since it was already inserted.
</I>&gt;<i> 
</I>&gt;<i> The question:
</I>&gt;<i> 
</I>&gt;<i> Where should I be checking for this? Should I just suppress the error with
</I>&gt;<i> @$this-&gt;dbManager-&gt;DbQuery($query_string);? Should I just do a select
</I>&gt;<i> before-hand to see if the join is already in the table? Other ideas?
</I>&gt;<i> 
</I>
Seems like the real problem here is that the application itself is not 
aware of which requests have been submitted already and which haven't. 
Of course you could do some things to skip out the error (error 
supression with @, using &quot;insert IGNORE into ...&quot; to prevent errors on 
duplicate keys, etc.), but I think you will make your life easier by 
addressing the root of the problem: if the page is reloaded, make sure 
the code isn't run a second time, unless that's what's supposed to happen.

In my systems, I'll assign a unique ID (based on microtime) to each 
submitted request (added as a hidden input in forms, else appended to 
the query string), to be stored in the database.  For each request, the 
system checks to see if the ID has been submitted; if so, the action 
code is skipped and only the display code is run; if not, the request ID 
is recorded in the databse, and the action code is processed as normal. 
  Garbage collection routines keep the request-ID cache from getting too 
big but keep the contents long enough to avoid false negatives.

That's just one way to do it.  Others here can probably recommend better 
methods, but I think you have to find some way to do it.  You probably 
don't want to go down the path of just supressing errors all over the 
place, because when a real error surfaces you need to be able to see it 
and handle it properly.

- Allen



-- 
Allen Shaw
slidePresenter (<A HREF="http://slides.sourceforge.net">http://slides.sourceforge.net</A>)

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022594.html">[nycphp-talk] Inserting duplicate SQL primary keys
</A></li>
	<LI>Next message: <A HREF="022596.html">[nycphp-talk] Inserting duplicate SQL primary keys
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22595">[ date ]</a>
              <a href="thread.html#22595">[ thread ]</a>
              <a href="subject.html#22595">[ subject ]</a>
              <a href="author.html#22595">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
