<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] PHP 5 singleton/destructor question
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2005-March/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20PHP%205%20singleton/destructor%20question&In-Reply-To=%3CPine.BSF.4.58.0503311728040.54498%40emra.pair.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014151.html">
   <LINK REL="Next"  HREF="014153.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] PHP 5 singleton/destructor question</H1>
    <B>David Mintz</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20PHP%205%20singleton/destructor%20question&In-Reply-To=%3CPine.BSF.4.58.0503311728040.54498%40emra.pair.com%3E"
       TITLE="[nycphp-talk] PHP 5 singleton/destructor question">dmintz at davidmintz.org
       </A><BR>
    <I>Thu Mar 31 17:59:01 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="014151.html">[nycphp-talk] PHP 5 singleton/destructor question
</A></li>
        <LI>Next message: <A HREF="014153.html">[nycphp-talk] PHP 5 singleton/destructor question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14152">[ date ]</a>
              <a href="thread.html#14152">[ thread ]</a>
              <a href="subject.html#14152">[ subject ]</a>
              <a href="author.html#14152">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 31 Mar 2005, csnyder wrote:

&gt;<i> On Thu, 31 Mar 2005 17:02:06 -0500 (EST), David Mintz
</I>&gt;<i> &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">dmintz at davidmintz.org</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; OK, here is the ugliest workaround you've seen all day.
</I>&gt;<i>
</I>&gt;<i> Testing your code on my server, I have a few observations.
</I>&gt;<i>
</I>&gt;<i> 1) it worked for me BUT I don't have mysqli compiled into this server,
</I>&gt;<i> so I wrote a dummy mysqli class
</I>&gt;<i>
</I>&gt;<i> 2) PHP complained that the __construct() function was private -- why
</I>&gt;<i> is it private?
</I>&gt;<i>
</I>
I am stealing liberally from G. Schlossnagle's &quot;Advanced PHP Programming.&quot;
The private constructor is to prevent everyone except my class from
instantiating it, and thus make sure the singleton is truly single.


&gt;<i> So I'm guessing that mysqli steps on your destruct() function, and/or
</I>&gt;<i> the private construct() is weird-making.
</I>
Let's see what happens when I make the constructor public... nope, same
story.

I have also tried having a mysqli as a static member variable rather than
extending mysqli, and various variations -- in some of which, the
destructor worked too well, i.e., it destroyed the object before all my
code was done using it, because the singleton thing is working.

OK, let's try it with a non-mysqli parent... hmmm. I don't get any
complaints about private constructor in my mysqli subclass, but I do
in this example:

class MySingleton extends ParentClass {

	private static $db = false;
	private function __construct() {
		printf(&quot;constructing %s...&lt;br /&gt;&quot;,__CLASS__);
		parent::__construct();
	}

	public static function getInstance() {

		if (self::$db === false) {
			self::$db = new MySingleton();

		}
		return self::$db;
	}

	function __destruct() {
		// ParentClass has a close() method
		self::$db-&gt;close();
	}
}
$instance = MySingleton::getInstance();

...with an nice informative error message. You can't override a method and
give it more restrictive access than the parent method (as w/ Java). I
make the constructor public and it runs fine, destructor and all.

I wonder why I get away with a private constructor in my mysqli subclass.

Thanks,

---
David Mintz
<A HREF="http://davidmintz.org/">http://davidmintz.org/</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014151.html">[nycphp-talk] PHP 5 singleton/destructor question
</A></li>
	<LI>Next message: <A HREF="014153.html">[nycphp-talk] PHP 5 singleton/destructor question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14152">[ date ]</a>
              <a href="thread.html#14152">[ thread ]</a>
              <a href="subject.html#14152">[ subject ]</a>
              <a href="author.html#14152">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
