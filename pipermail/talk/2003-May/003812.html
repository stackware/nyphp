<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] sanitizing user-submitted html
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2003-May/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20sanitizing%20user-submitted%20html&In-Reply-To=%3C000801c32739%24759abc40%24550e6c42%40BURDEN%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003813.html">
   <LINK REL="Next"  HREF="003814.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] sanitizing user-submitted html</H1>
    <B>James Wetterau</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20sanitizing%20user-submitted%20html&In-Reply-To=%3C000801c32739%24759abc40%24550e6c42%40BURDEN%3E"
       TITLE="[nycphp-talk] sanitizing user-submitted html">james at surgam.net
       </A><BR>
    <I>Sat May 31 01:57:02 EDT 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="003813.html">[nycphp-talk] sanitizing user-submitted html
</A></li>
        <LI>Next message: <A HREF="003814.html">[nycphp-talk] sanitizing user-submitted html
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3812">[ date ]</a>
              <a href="thread.html#3812">[ thread ]</a>
              <a href="subject.html#3812">[ subject ]</a>
              <a href="author.html#3812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Chris Snyder says:
&gt;<i> James Wetterau wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;This submission breaks it:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Strips some attibutes:&lt;br&gt;
</I>&gt;<i> &gt;&lt;img src='<A HREF="http://fotola.com/berylium/csnyder/?method=latestimage">http://fotola.com/berylium/csnyder/?method=latestimage</A>'
</I>&gt;<i> &gt;onmouseover='whatever(whatever=&quot;onmouseover='
</I>&gt;<i> &gt;alert(&quot;gotcha&quot;);
</I>&gt;<i> &gt;alert(&quot;I can do anything in here&quot;);
</I>&gt;<i> &gt;'/&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> Not anymore. Two things happened there-- I needed to create separate
</I>&gt;<i> patterns for attributes delimited with &quot; and with ', and I didn't
</I>&gt;<i> realize that the dot wasn't matching newline chars. Fixed both of those,
</I>&gt;<i> and thanks for the shakedown!!
</I>
I can now break it with this input:         

Strips some attibutes:&lt;br /&gt;
&lt;img src='<A HREF="http://fotola.com/berylium/csnyder/?method=latestimage">http://fotola.com/berylium/csnyder/?method=latestimage</A>'
onmouseover=onmouseover='alert(&quot;gotcha&quot;)''alert(&quot;gotcha&quot;);
alert(&quot;I can also do multiple lines!&quot;);' title='a photo' /&gt;
&lt;blink&gt;blink!&lt;/blink&gt;
&lt;b&gt;adds &lt;b&gt;closing&lt;/b&gt; tags if necessary.

...
&gt;<i> I took a crash course in state machines this evening via Google, and I
</I>&gt;<i> must admit that I have no idea what this problem would like if modeled
</I>&gt;<i> as one. It's true that I would be happier with mathematical proof that
</I>&gt;<i> the routine was unexploitable, but anecdotal proof will be enough for me
</I>&gt;<i> to allow HTML posts in non-critical applications. Thanks again for
</I>...

My pleasure, and thank you for putting your code out there for review.
I think it's a good lesson to see how hard it is to sanitize user input, even
starting with a lot of initial cleverness. 

I think at minimum you need to loop over the resulting output to
verify that you haven't transformed your input into an output which
still triggers your conditions for requiring modification.

One thing you might want to do is add extraneous spaces around things
you've expunged, which might prevent parts from joining together around
an expunged piece.  This should generally be ok, because most legitimate
HTML shouldn't care about whitespaces.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20030530/d0d912cd/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20030530/d0d912cd/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003813.html">[nycphp-talk] sanitizing user-submitted html
</A></li>
	<LI>Next message: <A HREF="003814.html">[nycphp-talk] sanitizing user-submitted html
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3812">[ date ]</a>
              <a href="thread.html#3812">[ thread ]</a>
              <a href="subject.html#3812">[ subject ]</a>
              <a href="author.html#3812">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
