<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Logging and file locking.
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2006-July/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Logging%20and%20file%20locking.&In-Reply-To=%3CD21B3AD78C55F44EBEAF1E84DCF0A7810141BFA9%40anaexch2-nyc.ana.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="018699.html">
   <LINK REL="Next"  HREF="018701.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Logging and file locking.</H1>
    <B>Rothe, Robert</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Logging%20and%20file%20locking.&In-Reply-To=%3CD21B3AD78C55F44EBEAF1E84DCF0A7810141BFA9%40anaexch2-nyc.ana.net%3E"
       TITLE="[nycphp-talk] Logging and file locking.">rrothe at ana.net
       </A><BR>
    <I>Mon Jul 17 08:22:28 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="018699.html">[nycphp-talk] unsubscribe
</A></li>
        <LI>Next message: <A HREF="018701.html">[nycphp-talk] PHP_Compat - any issues?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18700">[ date ]</a>
              <a href="thread.html#18700">[ thread ]</a>
              <a href="subject.html#18700">[ subject ]</a>
              <a href="author.html#18700">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is a very simple example of cooperative locking.  Be sure to read
the PHP flock() docs concerning locking files opened with truncation --
which is not the case in this example.  

This was written long ago and I recall testing it on both *nix and Win.
It creates a simple text log file with date, time, IP, and a passed
string.  As a byproduct, it also auto-rotates daily.


function WriteLog( $s )
{
	global $LOG_FILE_PATH;

	$fn = $LOG_FILE_PATH.'log-'.date('Ymd');

	// Open file (or create it).  You should check for errors.

	$fp = fopen( $fn, 'a' );

	/*
	* flock() will block waiting for another proc to release
acquired 
	* lock.  You should probably check error condition here.  See
docs 
	* for how to get EWOULDBLOCK flag.
	*/

	flock($fp, LOCK_EX );		

	/*
	* See to end, write, and then close.  Fclose() releases all
locks.
	* Check for errors as appropriate.
	*/

	fseek( $fp, 0, SEEK_END );

	fwrite($fp, date('Y-m-d H:i:s '));   // Write date/time
	fwrite($fp, $_SERVER['REMOTE_ADDR'].' ');  //Write IP

	fwrite($fp, $s.&quot;\n&quot;);	// Write passed string and newline.

	fclose($fp);	// Close file which releases lock.
}




-----Original Message-----
From: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A> [mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>]
On Behalf Of David A.Roth
Sent: Sunday, July 16, 2006 9:43 PM
To: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
Subject: [nycphp-talk] Logging and file locking.

When you do your own logging of various events to text logfiles created 
from PHP, is file locking needed or does Linux handle this for us? I am 
designing a new web application which will have multiple processes 
appending to the same text logfile, and I'm concerned entries might get 
lost.

If the answer is yes you need to do your own file locking, I'd be 
interested to know how you handle the problem yourself and a pointer to 
resources/discussion would be appreciated.

Thanks!

David Roth

_______________________________________________
New York PHP Community Talk Mailing List
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>

NYPHPCon 2006 Presentations Online
<A HREF="http://www.nyphpcon.com">http://www.nyphpcon.com</A>

Show Your Participation in New York PHP
<A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="018699.html">[nycphp-talk] unsubscribe
</A></li>
	<LI>Next message: <A HREF="018701.html">[nycphp-talk] PHP_Compat - any issues?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#18700">[ date ]</a>
              <a href="thread.html#18700">[ thread ]</a>
              <a href="subject.html#18700">[ subject ]</a>
              <a href="author.html#18700">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
