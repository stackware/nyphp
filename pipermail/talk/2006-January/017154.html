<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] [OT] number of files in a directory?
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2006-January/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20%5BOT%5D%20number%20of%20files%20in%20a%20directory%3F&In-Reply-To=%3Cp06230903bfdfcfcc199a%40%5B192.168.1.44%5D%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017151.html">
   <LINK REL="Next"  HREF="017152.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] [OT] number of files in a directory?</H1>
    <B>Marc Antony Vose</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20%5BOT%5D%20number%20of%20files%20in%20a%20directory%3F&In-Reply-To=%3Cp06230903bfdfcfcc199a%40%5B192.168.1.44%5D%3E"
       TITLE="[nycphp-talk] [OT] number of files in a directory?">suzerain at suzerain.com
       </A><BR>
    <I>Tue Jan  3 02:18:31 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017151.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
        <LI>Next message: <A HREF="017152.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17154">[ date ]</a>
              <a href="thread.html#17154">[ thread ]</a>
              <a href="subject.html#17154">[ subject ]</a>
              <a href="author.html#17154">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey y'all:

Thanks for the thoughtful notes.  As usual, people here have given me 
entirely new ways to think about things.

In my case, I'm not accepting uploads from web site visitors; all 
these images are coming from the owner of the site.  They are a store 
that sells one-of-a-kind rare items, and at any given time there will 
be an inventory of ~75,000.

Each item in the inventory will have something like 6-10 images, each 
used for different purposes (for example, we will be displaying 
rotatable versions of the products via Flash).

However, they've indicated a future desire to be able to offer people 
order histories, and so forth, so for the time being sold items will 
be kept in the system.  So the probability of getting into the 
millions pretty quickly with images is definitely there.

It seems, then, like the most sensible idea for me is to create md5() 
hashed directories based on the product ID number (rather than image 
ID number), as I don't think it's necessary for me to store 
information about every image in the database.

So, if I translated the product ID number into something like

IMAGES_DIR/ab5/81d

I could then store inside that directory any images which are needed 
for the particular product.  Something like:

12345_signature.jpg
12345_rotate_1.jpg
12345_rotate_2.jpg
12345_rotate_3.jpg
12345_rotate_4.jpg
12345_rotate_5.jpg
12345_rotate_6.jpg
12345_thumb.jpg

I suppose it is probable under this scenario that two different 
products will end up with the same path, since we're only using the 
first 6 characters of the hash. but it shouldn't really matter as 
long as I have the images keyed with the product ID as well.

Anyone see any major red flags with this strategy?

Cheers,

Marc


&gt;<i>max goldberg wrote:
</I>&gt;<i>  &gt; The downside is that you have to make sure your code really keeps track
</I>&gt;&gt;<i>  of your file system and you aren't accessing it by hand. Another thing
</I>&gt;&gt;<i>  you might worry about using md5 is collisions. If this is a mission
</I>&gt;&gt;<i>  critical system, you may want to avoid md5 as it is possible (but
</I>&gt;&gt;<i>  somewhat unlikely) you will encounter collisions. I've read anyone with
</I>&gt;&gt;<i>  a decent computer can create an md5 collision in about an hour, so
</I>&gt;&gt;<i>  that's something to keep in mind.
</I>&gt;<i>
</I>&gt;<i>Yeah, this is probably the best the solution.  To avoid collisions what
</I>&gt;<i>you want to do is assign a unique database ID to every asset, use that
</I>&gt;<i>ID to create the MD5 hash, then store the asset with a filename
</I>&gt;<i>containing that unique ID.  That should eliminate collisions.  The worst
</I>&gt;<i>that can happen is that you'll have two different files in the same
</I>&gt;<i>directory but with different filenames, which is cool.
</I>&gt;<i>
</I>&gt;<i>A function like this could be used to both plant the file in the MD5
</I>&gt;<i>filesystem and extract its path later on based on that unique ID:
</I>&gt;<i>
</I>&gt;<i>function get_upload_target($file_id) {
</I>&gt;<i>      $hash_id = md5($file_id);
</I>&gt;<i>      $subdir = substr($hash_id, 0, 3) .
</I>&gt;<i>        '/' .
</I>&gt;<i>        substr($hash_id, 3, 3);
</I>&gt;<i>      return $subdir;
</I>&gt;<i>    }
</I>&gt;<i>
</I>&gt;<i>Use case: someone uploads the file &quot;mykitty.jpg&quot; and it's inserted into
</I>&gt;<i>the database as id=1234.  get_upload_target(1234) returns:
</I>&gt;<i>
</I>&gt;<i>   81d/c9b
</I>&gt;<i>
</I>&gt;<i>The file is then written as $ASSET_DIR/81d/c9b/1234
</I>&gt;<i>
</I>&gt;<i>Or 1234.jpg, or 1234.mykitty.jpg, whatever.  I like to give the file a
</I>&gt;<i>recognizable file type extension.
</I>&gt;<i>
</I>&gt;<i>To extract that file later, just run the ID through get_upload_target()
</I>&gt;<i>again to build the filesystem path.
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017151.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
	<LI>Next message: <A HREF="017152.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17154">[ date ]</a>
              <a href="thread.html#17154">[ thread ]</a>
              <a href="subject.html#17154">[ subject ]</a>
              <a href="author.html#17154">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
