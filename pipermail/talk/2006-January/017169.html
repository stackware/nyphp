<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] MySQL Query Help
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2006-January/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20MySQL%20Query%20Help&In-Reply-To=%3C37048.38.117.147.25.1136591015.squirrel%4038.117.147.25%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017168.html">
   <LINK REL="Next"  HREF="017166.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] MySQL Query Help</H1>
    <B>Kenneth Downs</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20MySQL%20Query%20Help&In-Reply-To=%3C37048.38.117.147.25.1136591015.squirrel%4038.117.147.25%3E"
       TITLE="[nycphp-talk] MySQL Query Help">ken at secdat.com
       </A><BR>
    <I>Fri Jan  6 18:43:35 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017168.html">[nycphp-talk] MySQL Query Help
</A></li>
        <LI>Next message: <A HREF="017166.html">[nycphp-talk] MySQL Query Help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17169">[ date ]</a>
              <a href="thread.html#17169">[ thread ]</a>
              <a href="subject.html#17169">[ subject ]</a>
              <a href="author.html#17169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'll bet you'll see major speedup with two items:

1) Indexes required: VItems.mcn, VItems.V_ID, VItems.mcn

2) Break up the command into multiple commands, varying for CN3, CN4 etc:

update VItems set
       VItems.Inventory= feed.cn3quan
      ,VItems.ItemCst  = feed.unitcost
      ,VItems.ItemPrce = feed.unitcost
  from feed
 where VItems.MCN=feed.mcn
   and VItems.V_ID = 'CN3'

(Disclaimer: I don't use MySQL so you may have to tweak the SQL for
syntactical variations).

Here is why this should work.

FIRST, Transaction performance goes *exponentially* as the number of rows
in the transaction.  Consider 10 transactions of 5000 rows each, you get
(5000^2) * 10 = 2.5e8 &quot;units&quot; of time.  But one transaction of (50,000^2)
or 2.5e9 &quot;units&quot; of time, 10 times as long!

SECOND, It's really easy to test.  If the theory is right, the first
command will take 1/10 of 1/10 of the total time, or 1/10 of ( 1/10 of 4
hours ) = 2.4 minutes.  This is of course only a rule of thumb, but at
least it won't take 4 hours to find out :)

THIRD.  If this works, the best thing to do is cut the cron job down to
every five minutes.  I'm assuming  you clear the &quot;feeds&quot; table every time
you finish the job, so if you go every 5 minutes the transactions are
always very tiny.  You could possibly go back to one command in that case.

On a totally different track, we call this entire operation a &quot;transpose&quot;.
 In particular it is a de-normalizing transpose, turning a normalized feed
into a denormalized feed.  These are always bad, and this will give you
trouble forever.  If you have control over the database and can get rid of
this your life would be much better for it.

Hope this helps.


&gt;<i> Hello guys,
</I>&gt;<i>
</I>&gt;<i> I have a sql query that basically copies data from one table to another,
</I>&gt;<i> here is the query
</I>&gt;<i>
</I>&gt;<i> use mydb;
</I>&gt;<i> update Vtems left join  feed on Vtems.MCN=feed.mcn
</I>&gt;<i> set VItems.Inventory= case (VItems.V_ID)
</I>&gt;<i> when 'CN3' then feed.cn3quan
</I>&gt;<i> when 'CN4' then feed.cn4quan
</I>&gt;<i> when 'CN5' then feed.cn5quan
</I>&gt;<i> when 'CN6' then feed.cn6quan
</I>&gt;<i> when 'CN7' then feed.cn7quan
</I>&gt;<i> when 'CN8' then feed.cn8quan
</I>&gt;<i> when 'CN9' then feed.cn9quan
</I>&gt;<i> when 'CN10' then feed.cn10quan
</I>&gt;<i> when 'CN11' then feed.cn11quan
</I>&gt;<i> when 'CN16' then feed.cn16quan
</I>&gt;<i> else '' end
</I>&gt;<i> ,VItems.ItemCst = feed.unitcost,
</I>&gt;<i> VItems.ItemPrce = feed.unitcost
</I>&gt;<i> commit;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We have a php cron job which executes and runs this query, however it
</I>&gt;<i> takes
</I>&gt;<i> anywhere between 4-8 hours for this to run on 50,000 records, now this
</I>&gt;<i> number will also grow and we have determined that the left join is what is
</I>&gt;<i> slowing it down.  What i need to know is do you have any suggestions on a
</I>&gt;<i> better method for doing this that would speed it up considerably.
</I>&gt;<i>
</I>&gt;<i> I know we could run this on the mysql command line and we have tried.  It
</I>&gt;<i> seems to take just as long on the command line as the php cron, however we
</I>&gt;<i> are also wishing to implement emails when there are errors etc..  The avg
</I>&gt;<i> time is 6 hours on the production server to complete the import.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> --
</I>&gt;<i> Joseph Crawford Jr.
</I>&gt;<i> Zend Certified Engineer
</I>&gt;<i> Codebowl Solutions, Inc.
</I>&gt;<i> 1-802-671-2021
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">codebowl at gmail.com</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> New York PHP Talk Mailing List
</I>&gt;<i> AMP Technology
</I>&gt;<i> Supporting Apache, MySQL and PHP
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i> <A HREF="http://www.nyphp.org">http://www.nyphp.org</A>
</I>

-- 
Kenneth Downs
Secure Data Software
631-379-0010
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">ken at secdat.com</A>
PO Box 708
East Setauket, NY 11733


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017168.html">[nycphp-talk] MySQL Query Help
</A></li>
	<LI>Next message: <A HREF="017166.html">[nycphp-talk] MySQL Query Help
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17169">[ date ]</a>
              <a href="thread.html#17169">[ thread ]</a>
              <a href="subject.html#17169">[ subject ]</a>
              <a href="author.html#17169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
