<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] [OT] number of files in a directory?
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2006-January/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20%5BOT%5D%20number%20of%20files%20in%20a%20directory%3F&In-Reply-To=%3C87e6ded30601022155t6dc0fb14j1f805748be9e1760%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017152.html">
   <LINK REL="Next"  HREF="017155.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] [OT] number of files in a directory?</H1>
    <B>max goldberg</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20%5BOT%5D%20number%20of%20files%20in%20a%20directory%3F&In-Reply-To=%3C87e6ded30601022155t6dc0fb14j1f805748be9e1760%40mail.gmail.com%3E"
       TITLE="[nycphp-talk] [OT] number of files in a directory?">max.goldberg at gmail.com
       </A><BR>
    <I>Tue Jan  3 00:55:05 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017152.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
        <LI>Next message: <A HREF="017155.html">[nycphp-talk] problems loading a custom, shared extension
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17153">[ date ]</a>
              <a href="thread.html#17153">[ thread ]</a>
              <a href="subject.html#17153">[ subject ]</a>
              <a href="author.html#17153">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was trying to explain that I use a straight md5 sum of each file (the
contents) as the file name, to keep from storing and serving duplicate
files. When a user uploads a file that already exists in my system, it
discards it and just links to the previously uploaded version. I have no
concern about people &quot;stealing&quot; my images as filename has relatively little
to do with it. The files are stored with a 32 character md5 and a filetype
extension.

I guess it really depends on what your major goals are.

On 1/3/06, Anirudh Zala &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">arzala at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On Tue, 03 Jan 2006 06:06:58 +0530, max goldberg &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">max.goldberg at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; I started a site a couple years ago which had a similar problem. Users
</I>&gt;<i> can
</I>&gt;<i> &gt; create pages and each page had one or many assets.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; At first I just did /content/page_id/assets.ext, after I got to 32,000
</I>&gt;<i> &gt; directories, it stopped working. At that point I moved to a system where
</I>&gt;<i> I
</I>&gt;<i> &gt; had 250 directories like, 0, 1000, 2000, 3000, etc. Each of those
</I>&gt;<i> &gt; directories had 1000 sub directories in them, each named after the
</I>&gt;<i> page_id.
</I>&gt;<i> &gt; After I got to around 300,000 sub directories and a little over a
</I>&gt;<i> million
</I>&gt;<i> &gt; files, I moved to a completely md5 based system.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I tried to avoid keeping track of files in the database as it tends to
</I>&gt;<i> get
</I>&gt;<i> &gt; messy, but I suppose it's inevitable. The benefits of an md5 system for
</I>&gt;<i> me
</I>&gt;<i> &gt; outweigh a non md5 system. This may not be the case for you but the main
</I>&gt;<i> &gt; drawing points to me were:
</I>&gt;<i>
</I>&gt;<i> Sometimes you must need to store those values related to images into
</I>&gt;<i> database because you need to store various information of images like size,
</I>&gt;<i> height, width, original file name etc, for which DB storage is inevitable. I
</I>&gt;<i> also prefer to store various image information like size, height, width into
</I>&gt;<i> db directly to display it anywhere rather than finding those values on the
</I>&gt;<i> fly using functions like &quot;getimagesize()&quot; etc. But if you think you will not
</I>&gt;<i> need those information regarding images and you just need to display it,
</I>&gt;<i> then you can avoid usage of DB.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1) Lowered server I/O, there were quite a few duplicated files. Each
</I>&gt;<i> time
</I>&gt;<i> &gt; two identical files were read, they were pulled from two different spots
</I>&gt;<i> on
</I>&gt;<i> &gt; the disk. My site quickly grew to using huge amounts of I/O. (around
</I>&gt;<i> &gt; 15,000-20,000 hits a minute on the content server). This definitely
</I>&gt;<i> helped
</I>&gt;<i> &gt; out for me as some files were duplicated over 1,000 times.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2) Made it a lot easier to keep track of what was being used and what
</I>&gt;<i> &gt; wasn't. Without a DB back end I couldn't tell which files I could delete
</I>&gt;<i> and
</I>&gt;<i> &gt; which I needed to keep without writing a script that basically checked
</I>&gt;<i> every
</I>&gt;<i> &gt; directory for a matching entry in the database.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3) Lowered disk space. Again duplicate files.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 4) Allowed me to ban certain images and other files, mass delete things
</I>&gt;<i> that
</I>&gt;<i> &gt; had a certain md5 attached to it. This is very useful if you will ever
</I>&gt;<i> need
</I>&gt;<i> &gt; to moderate or have troublesome users.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The downside is that you have to make sure your code really keeps track
</I>&gt;<i> of
</I>&gt;<i> &gt; your file system and you aren't accessing it by hand. Another thing you
</I>&gt;<i> &gt; might worry about using md5 is collisions. If this is a mission critical
</I>&gt;<i> &gt; system, you may want to avoid md5 as it is possible (but somewhat
</I>&gt;<i> unlikely)
</I>&gt;<i> &gt; you will encounter collisions. I've read anyone with a decent computer
</I>&gt;<i> can
</I>&gt;<i> &gt; create an md5 collision in about an hour, so that's something to keep in
</I>&gt;<i> &gt; mind.
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i> I don't understand how can there be collisions with generating randome
</I>&gt;<i> hash? Consider below method to generate 16 digit random hash.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> $hash=substr(md5(md5(time().rand().$GLOBALS['REMOTE_ADDR'].microtime()).time()),0,16);
</I>&gt;<i>
</I>&gt;<i> Can you ever get duplicate hash by above method? I don't think so. However
</I>&gt;<i> usage of &quot;md5()&quot; only might do that. However main purpose of using hash
</I>&gt;<i> value in filename is to avoid stealing of them because by this way stealers
</I>&gt;<i> can't directly downaload images by guessing directory and file name
</I>&gt;<i> structure of your website. Moreover in file name like
</I>&gt;<i>
</I>&gt;<i> \RECORDID_SOME&gt;10CHARACTERHASH.EXT (i.e 123456_aswe34567bg.jpg)
</I>&gt;<i>
</I>&gt;<i> where we use combination of &quot;primary column ID 123456&quot; of particualr
</I>&gt;<i> record that is attached to this image and above mentioned 10 to 16 digit
</I>&gt;<i> hash will solve both of our purposes. Since RECORDID is always unique, you
</I>&gt;<i> will never have duplication of images, that is for sure.
</I>&gt;<i>
</I>&gt;<i> &gt; The way I structured my file system was three levels of single character
</I>&gt;<i> &gt; directories.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; /content/a-f0-9/a-f0-9/a-f0-9/filename.ext (4096 directories (16*16*16))
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This way I can take any asset md5 and figure out it's location on the
</I>&gt;<i> file
</I>&gt;<i> &gt; system without database access, and leaves ample room for expansion, as
</I>&gt;<i> well
</I>&gt;<i> &gt; as moving large (or small) chunks to other servers. At this point I am
</I>&gt;<i> using
</I>&gt;<i> &gt; this system for over a million files and most of the sub directories
</I>&gt;<i> only
</I>&gt;<i> &gt; have a few hundred files in them tops.
</I>&gt;<i>
</I>&gt;<i> This is another good mechanism of storing large number of files
</I>&gt;<i> efficiently. But I would like to know a real example of this &quot;filename.ext&quot;.
</I>&gt;<i> I assume if it is just like &quot;ASSET.ext&quot; i.e 1.jpg, 1234.jpg, 4567.jpg then
</I>&gt;<i> I would say that your system is prone to stealing of your images. md5 or
</I>&gt;<i> another kind of hash, here, gives you protection against it since stealers
</I>&gt;<i> can't guess exact file name of your images and even if they try hard, they
</I>&gt;<i> wont get benefited much.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If you decided to use a single directory approach you will most likely
</I>&gt;<i> run
</I>&gt;<i> &gt; into quite a few problems. I remember when I had around 15-20,000 files,
</I>&gt;<i> &gt; everything I did in that directory became extra slow. With the setup I'm
</I>&gt;<i> &gt; using now I don't really get any lag.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hope that helped.
</I>&gt;<i> &gt; -Max
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 12/31/05, Marc Antony Vose &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">suzerain at suzerain.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Hey all:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; First of all:  Happy New Year!
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Secondly: I am rebuilding a site that was coded somewhat sloppily,
</I>&gt;<i> &gt;&gt; and they have product images all stored in one directory (a script
</I>&gt;<i> &gt;&gt; that I am not writing auto-uploads them to the web server from
</I>&gt;<i> &gt;&gt; elsewhere).  Presently, this directory contains about 33,000 files.
</I>&gt;<i> &gt;&gt; It will be more like 75,000 when the site launches, if things remain
</I>&gt;<i> &gt;&gt; the same.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; The question is:  should I be worried about this, or was this only a
</I>&gt;<i> &gt;&gt; problem several years ago? (I remember people at one time attempting
</I>&gt;<i> &gt;&gt; to not put too many files in one place.)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; If I should be worried, what could happen?  Will we ever reach a hard
</I>&gt;<i> &gt;&gt; limit of files per directory?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Is it better if each product instead has its own directory inside
</I>&gt;<i> &gt;&gt; there (i.e., 75,000 directories), each with as many files as we need
</I>&gt;<i> &gt;&gt; inside, or is that just the same problem?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Cheers,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; --
</I>&gt;<i> &gt;&gt; Marc Antony Vose
</I>&gt;<i> &gt;&gt; <A HREF="http://www.suzerain.com/">http://www.suzerain.com/</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Imagination is more important than knowledge.
</I>&gt;<i> &gt;&gt; -- Albert Einstein
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; New York PHP Talk Mailing List
</I>&gt;<i> &gt;&gt; AMP Technology
</I>&gt;<i> &gt;&gt; Supporting Apache, MySQL and PHP
</I>&gt;<i> &gt;&gt; <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i> &gt;&gt; <A HREF="http://www.nyphp.org">http://www.nyphp.org</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> -----------------------------------------------------
</I>&gt;<i> Anirudh Zala (Production Manager)
</I>&gt;<i> ASPL, <A HREF="http://www.aspl.in">http://www.aspl.in</A>
</I>&gt;<i> Ph: +91 281 245 1894
</I>&gt;<i> arzala at gmail.com
</I>&gt;<i> -----------------------------------------------------
</I>&gt;<i> _______________________________________________
</I>&gt;<i> New York PHP Talk Mailing List
</I>&gt;<i> AMP Technology
</I>&gt;<i> Supporting Apache, MySQL and PHP
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i> <A HREF="http://www.nyphp.org">http://www.nyphp.org</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20060103/3bfaf658/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20060103/3bfaf658/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017152.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
	<LI>Next message: <A HREF="017155.html">[nycphp-talk] problems loading a custom, shared extension
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17153">[ date ]</a>
              <a href="thread.html#17153">[ thread ]</a>
              <a href="subject.html#17153">[ subject ]</a>
              <a href="author.html#17153">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
