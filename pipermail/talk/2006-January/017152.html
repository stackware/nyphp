<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] [OT] number of files in a directory?
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2006-January/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20%5BOT%5D%20number%20of%20files%20in%20a%20directory%3F&In-Reply-To=%3Cop.s2sfgegc6dyt8l%40aum1.aum.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017154.html">
   <LINK REL="Next"  HREF="017153.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] [OT] number of files in a directory?</H1>
    <B>Anirudh Zala</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20%5BOT%5D%20number%20of%20files%20in%20a%20directory%3F&In-Reply-To=%3Cop.s2sfgegc6dyt8l%40aum1.aum.com%3E"
       TITLE="[nycphp-talk] [OT] number of files in a directory?">arzala at gmail.com
       </A><BR>
    <I>Tue Jan  3 00:42:04 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="017154.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
        <LI>Next message: <A HREF="017153.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17152">[ date ]</a>
              <a href="thread.html#17152">[ thread ]</a>
              <a href="subject.html#17152">[ subject ]</a>
              <a href="author.html#17152">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, 03 Jan 2006 06:06:58 +0530, max goldberg &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">max.goldberg at gmail.com</A>&gt; wrote:

&gt;<i> I started a site a couple years ago which had a similar problem. Users can
</I>&gt;<i> create pages and each page had one or many assets.
</I>&gt;<i>
</I>&gt;<i> At first I just did /content/page_id/assets.ext, after I got to 32,000
</I>&gt;<i> directories, it stopped working. At that point I moved to a system where I
</I>&gt;<i> had 250 directories like, 0, 1000, 2000, 3000, etc. Each of those
</I>&gt;<i> directories had 1000 sub directories in them, each named after the page_id.
</I>&gt;<i> After I got to around 300,000 sub directories and a little over a million
</I>&gt;<i> files, I moved to a completely md5 based system.
</I>&gt;<i>
</I>&gt;<i> I tried to avoid keeping track of files in the database as it tends to get
</I>&gt;<i> messy, but I suppose it's inevitable. The benefits of an md5 system for me
</I>&gt;<i> outweigh a non md5 system. This may not be the case for you but the main
</I>&gt;<i> drawing points to me were:
</I>
Sometimes you must need to store those values related to images into database because you need to store various information of images like size, height, width, original file name etc, for which DB storage is inevitable. I also prefer to store various image information like size, height, width into db directly to display it anywhere rather than finding those values on the fly using functions like &quot;getimagesize()&quot; etc. But if you think you will not need those information regarding images and you just need to display it, then you can avoid usage of DB.

&gt;<i>
</I>&gt;<i> 1) Lowered server I/O, there were quite a few duplicated files. Each time
</I>&gt;<i> two identical files were read, they were pulled from two different spots on
</I>&gt;<i> the disk. My site quickly grew to using huge amounts of I/O. (around
</I>&gt;<i> 15,000-20,000 hits a minute on the content server). This definitely helped
</I>&gt;<i> out for me as some files were duplicated over 1,000 times.
</I>&gt;<i>
</I>&gt;<i> 2) Made it a lot easier to keep track of what was being used and what
</I>&gt;<i> wasn't. Without a DB back end I couldn't tell which files I could delete and
</I>&gt;<i> which I needed to keep without writing a script that basically checked every
</I>&gt;<i> directory for a matching entry in the database.
</I>&gt;<i>
</I>&gt;<i> 3) Lowered disk space. Again duplicate files.
</I>&gt;<i>
</I>&gt;<i> 4) Allowed me to ban certain images and other files, mass delete things that
</I>&gt;<i> had a certain md5 attached to it. This is very useful if you will ever need
</I>&gt;<i> to moderate or have troublesome users.
</I>&gt;<i>
</I>&gt;<i> The downside is that you have to make sure your code really keeps track of
</I>&gt;<i> your file system and you aren't accessing it by hand. Another thing you
</I>&gt;<i> might worry about using md5 is collisions. If this is a mission critical
</I>&gt;<i> system, you may want to avoid md5 as it is possible (but somewhat unlikely)
</I>&gt;<i> you will encounter collisions. I've read anyone with a decent computer can
</I>&gt;<i> create an md5 collision in about an hour, so that's something to keep in
</I>&gt;<i> mind.
</I>&gt;<i>
</I>
I don't understand how can there be collisions with generating randome hash? Consider below method to generate 16 digit random hash.

$hash=substr(md5(md5(time().rand().$GLOBALS['REMOTE_ADDR'].microtime()).time()),0,16);

Can you ever get duplicate hash by above method? I don't think so. However usage of &quot;md5()&quot; only might do that. However main purpose of using hash value in filename is to avoid stealing of them because by this way stealers can't directly downaload images by guessing directory and file name structure of your website. Moreover in file name like

\RECORDID_SOME&gt;10CHARACTERHASH.EXT (i.e 123456_aswe34567bg.jpg)

where we use combination of &quot;primary column ID 123456&quot; of particualr record that is attached to this image and above mentioned 10 to 16 digit hash will solve both of our purposes. Since RECORDID is always unique, you will never have duplication of images, that is for sure.

&gt;<i> The way I structured my file system was three levels of single character
</I>&gt;<i> directories.
</I>&gt;<i>
</I>&gt;<i> /content/a-f0-9/a-f0-9/a-f0-9/filename.ext (4096 directories (16*16*16))
</I>&gt;<i>
</I>&gt;<i> This way I can take any asset md5 and figure out it's location on the file
</I>&gt;<i> system without database access, and leaves ample room for expansion, as well
</I>&gt;<i> as moving large (or small) chunks to other servers. At this point I am using
</I>&gt;<i> this system for over a million files and most of the sub directories only
</I>&gt;<i> have a few hundred files in them tops.
</I>
This is another good mechanism of storing large number of files efficiently. But I would like to know a real example of this &quot;filename.ext&quot;. I assume if it is just like &quot;ASSET.ext&quot; i.e 1.jpg, 1234.jpg, 4567.jpg then I would say that your system is prone to stealing of your images. md5 or another kind of hash, here, gives you protection against it since stealers can't guess exact file name of your images and even if they try hard, they wont get benefited much.

&gt;<i>
</I>&gt;<i> If you decided to use a single directory approach you will most likely run
</I>&gt;<i> into quite a few problems. I remember when I had around 15-20,000 files,
</I>&gt;<i> everything I did in that directory became extra slow. With the setup I'm
</I>&gt;<i> using now I don't really get any lag.
</I>&gt;<i>
</I>&gt;<i> Hope that helped.
</I>&gt;<i> -Max
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 12/31/05, Marc Antony Vose &lt;<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">suzerain at suzerain.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hey all:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> First of all:  Happy New Year!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Secondly: I am rebuilding a site that was coded somewhat sloppily,
</I>&gt;&gt;<i> and they have product images all stored in one directory (a script
</I>&gt;&gt;<i> that I am not writing auto-uploads them to the web server from
</I>&gt;&gt;<i> elsewhere).  Presently, this directory contains about 33,000 files.
</I>&gt;&gt;<i> It will be more like 75,000 when the site launches, if things remain
</I>&gt;&gt;<i> the same.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The question is:  should I be worried about this, or was this only a
</I>&gt;&gt;<i> problem several years ago? (I remember people at one time attempting
</I>&gt;&gt;<i> to not put too many files in one place.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> If I should be worried, what could happen?  Will we ever reach a hard
</I>&gt;&gt;<i> limit of files per directory?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is it better if each product instead has its own directory inside
</I>&gt;&gt;<i> there (i.e., 75,000 directories), each with as many files as we need
</I>&gt;&gt;<i> inside, or is that just the same problem?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Marc Antony Vose
</I>&gt;&gt;<i> <A HREF="http://www.suzerain.com/">http://www.suzerain.com/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Imagination is more important than knowledge.
</I>&gt;&gt;<i> -- Albert Einstein
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> New York PHP Talk Mailing List
</I>&gt;&gt;<i> AMP Technology
</I>&gt;&gt;<i> Supporting Apache, MySQL and PHP
</I>&gt;&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;&gt;<i> <A HREF="http://www.nyphp.org">http://www.nyphp.org</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>


-- 
-----------------------------------------------------
Anirudh Zala (Production Manager)
ASPL, <A HREF="http://www.aspl.in">http://www.aspl.in</A>
Ph: +91 281 245 1894
arzala at gmail.com
-----------------------------------------------------

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017154.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
	<LI>Next message: <A HREF="017153.html">[nycphp-talk] [OT] number of files in a directory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17152">[ date ]</a>
              <a href="thread.html#17152">[ thread ]</a>
              <a href="subject.html#17152">[ subject ]</a>
              <a href="author.html#17152">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
