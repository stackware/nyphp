<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Trying to decide between MDB2 and PHP PDO
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2009-June/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Trying%20to%20decide%20between%20MDB2%20and%20PHP%20PDO&In-Reply-To=%3C8f0676b40906251438u2bfef69cx900834ef1776b9b3%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="028302.html">
   <LINK REL="Next"  HREF="028295.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Trying to decide between MDB2 and PHP PDO</H1>
    <B>John Campbell</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Trying%20to%20decide%20between%20MDB2%20and%20PHP%20PDO&In-Reply-To=%3C8f0676b40906251438u2bfef69cx900834ef1776b9b3%40mail.gmail.com%3E"
       TITLE="[nycphp-talk] Trying to decide between MDB2 and PHP PDO">jcampbell1 at gmail.com
       </A><BR>
    <I>Thu Jun 25 17:38:20 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="028302.html">[nycphp-talk] Trying to decide between MDB2 and PHP PDO
</A></li>
        <LI>Next message: <A HREF="028295.html">[nycphp-talk] Trying to decide between MDB2 and PHP PDO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28294">[ date ]</a>
              <a href="thread.html#28294">[ thread ]</a>
              <a href="subject.html#28294">[ subject ]</a>
              <a href="author.html#28294">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> I was told that using a prepare is much faster then using raw sql but my
</I>&gt;<i> test results prove otherwise. Why is the prepare and execute method is
</I>&gt;<i> slower than building the statement manually and querying the server?
</I>
The &quot;prepare is faster&quot; lie was started as a conspiracy to trick the
idiots into using prepared statement for security reasons.  Prepared
statements are typically twice as slow because you have to talk to the
database twice, and in your case, they are about the same as not using
a prepared since you are doing repeated queries.

&gt;<i>From your data, it looks like MDB2 is probably doing something stupid
</I>under the hood and possibly re-preparing in each iteration.

I think MDB2 and PDO offer some sort of &quot;Emulate Prepared Statements&quot;
mode, and I would re-run your tests using that.

Personally, I find PDO pointless, and MDB2 overkill.  Any reason you
are ruling out mysqli?

Regards,
John Campbell

&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; echo &quot;Array of Field Names From Header Record in Input data is \n&quot;;
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; print_r($arrFields);
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $seqno++;
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; continue;&#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $key = 0+$inrec[$arrFields['Unique #']];
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; //for normal prepare
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $values = array($key);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $time_start1 = getmicrotime();
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $affectedRows =&amp; $sth1-&gt;execute($values);
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $arrCnt['select'] += getmicrotime() - $time_start1;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $time_elapsed = getmicrotime() - $time_start;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; if (PEAR::isError($res)) {
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; die($res-&gt;getMessage());
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $values = array();
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $values = array('Kevin',$key);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $time_start1 = getmicrotime();
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $affectedRows =&amp; $sth2-&gt;execute($values);
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $arrCnt['update'] += getmicrotime() - $time_start1;
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $time_elapsed = getmicrotime() - $time_start;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; if (PEAR::isError($res)) {
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; die($res-&gt;getMessage());
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; if($seqno &gt; 20000) break;
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $seqno++;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> echo &quot;total: &quot;. $time_elapsed.&quot;\n&quot;;
</I>&gt;<i> echo &quot;execution times:\n&quot;;
</I>&gt;<i> var_dump($arrCnt);
</I>&gt;<i> $rate = $time_elapsed / $seqno;
</I>&gt;<i> echo &quot;rate: &quot;.$rate.&quot;\n&quot;;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; // ***************
</I>&gt;<i> &#160;&#160;&#160; // Calculate the time including fractions of a second
</I>&gt;<i> &#160;&#160;&#160; // ***************
</I>&gt;<i> &#160;&#160;&#160; function getmicrotime() {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; $mtime = microtime();
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; $mtime = explode(' ', $mtime);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; return($mtime[1] + $mtime[0]);
</I>&gt;<i> &#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> fclose($fpiDataAddr) or die(&quot;can not close data file&quot;);
</I>&gt;<i>
</I>&gt;<i> $mdb2-&gt;disconnect();
</I>&gt;<i>
</I>&gt;<i> ?&gt;
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------------------------------------------
</I>&gt;<i> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</I>&gt;<i> ------------------------------------------------------------------------------------------------------------
</I>&gt;<i> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</I>&gt;<i> ------------------------------------------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &lt;?php
</I>&gt;<i> $fpiDataAddr = fopen('outputAddr.txt','r') or die(&quot;can not open New In File
</I>&gt;<i> &quot;);
</I>&gt;<i> ini_set('memory_limit', -1);
</I>&gt;<i>
</I>&gt;<i> //Connect to the Database
</I>&gt;<i> $dsn = 'mysql:host=localhost;dbname=demo';
</I>&gt;<i>
</I>&gt;<i> $connHandle = new PDO ($dsn,'u1','');
</I>&gt;<i>
</I>&gt;<i> $seqno = 0;
</I>&gt;<i> $time_start = getmicrotime();
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; //for normal prepare
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $sql1 = 'SELECT * FROM demo.kb_addr WHERE UNIQUE_NUM = ?';
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $sth1 = $connHandle-&gt;prepare($sql1);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $sql2 = 'UPDATE demo.kb_addr SET AM_CITY = ? WHERE UNIQUE_NUM = ?';
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $sth2 = $connHandle-&gt;prepare($sql2);
</I>&gt;<i>
</I>&gt;<i> while($inrec = fgetcsv($fpiDataAddr,0,',','&quot;')){
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; if($seqno == 0){
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $x= count($inrec);
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $arrFields = array();
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; for ($y = 0; $y &lt; $x; $y++) {
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; $arrFields[$inrec[$y]] = $y; //creates associative array that
</I>&gt;<i> associates fields with the index in $inrec
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $seqno++;
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; continue;&#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $key = 0+$inrec[$arrFields['Unique #']];
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; //for normal prepare
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $values = array($key);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $time_start1 = getmicrotime();
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $affectedRows =&amp; $sth1-&gt;execute($values);
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $arrCnt['select'] += getmicrotime() - $time_start1;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $time_elapsed = getmicrotime() - $time_start;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; if (PEAR::isError($res)) {
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; die($res-&gt;getMessage());
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $values = array();
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $values = array('Kevin',$key);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $time_start1 = getmicrotime();
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $affectedRows =&amp; $sth2-&gt;execute($values);
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $arrCnt['update'] += getmicrotime() - $time_start1;
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $time_elapsed = getmicrotime() - $time_start;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; if (PEAR::isError($res)) {
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; &#160;&#160;&#160; die($res-&gt;getMessage());
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; if($seqno &gt; 20000) break;
</I>&gt;<i> &#160;&#160;&#160; &#160;&#160;&#160; $seqno++;
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> echo &quot;total: &quot;. $time_elapsed.&quot;\n&quot;;
</I>&gt;<i> echo &quot;execution times:\n&quot;;
</I>&gt;<i> var_dump($arrCnt);
</I>&gt;<i> $rate = $time_elapsed / $seqno;
</I>&gt;<i> echo &quot;rate: &quot;.$rate.&quot;\n&quot;;
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160; // ***************
</I>&gt;<i> &#160;&#160;&#160; // Calculate the time including fractions of a second
</I>&gt;<i> &#160;&#160;&#160; // ***************
</I>&gt;<i> &#160;&#160;&#160; function getmicrotime() {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; $mtime = microtime();
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; $mtime = explode(' ', $mtime);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160; return($mtime[1] + $mtime[0]);
</I>&gt;<i> &#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> fclose($fpiDataAddr) or die(&quot;can not close data file&quot;);
</I>&gt;<i>
</I>&gt;<i> //disconnect
</I>&gt;<i> $connHandle = null;
</I>&gt;<i>
</I>&gt;<i> ?&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> New York PHP User Group Community Talk Mailing List
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.nyphp.org/show_participation.php">http://www.nyphp.org/show_participation.php</A>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="028302.html">[nycphp-talk] Trying to decide between MDB2 and PHP PDO
</A></li>
	<LI>Next message: <A HREF="028295.html">[nycphp-talk] Trying to decide between MDB2 and PHP PDO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#28294">[ date ]</a>
              <a href="thread.html#28294">[ thread ]</a>
              <a href="subject.html#28294">[ subject ]</a>
              <a href="author.html#28294">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
