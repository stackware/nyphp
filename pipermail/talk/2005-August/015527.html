<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] (no subject)
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2005-August/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20%3D%3Fiso-8859-1%3Fq%3F%3D28no_subject%3D29%3F%3D&In-Reply-To=%3C200508060646.j766kXF0024291%40centrifuge1.centrifugeit.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015521.html">
   <LINK REL="Next"  HREF="015549.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] (no subject)</H1>
    <B>Jeff Hegedus</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20%3D%3Fiso-8859-1%3Fq%3F%3D28no_subject%3D29%3F%3D&In-Reply-To=%3C200508060646.j766kXF0024291%40centrifuge1.centrifugeit.com%3E"
       TITLE="[nycphp-talk] (no subject)">jhegedus at centrifugeit.com
       </A><BR>
    <I>Sat Aug  6 02:52:36 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="015521.html">[nycphp-talk] AWStats vs Webalizer - more experience
</A></li>
        <LI>Next message: <A HREF="015549.html">[nycphp-talk] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15527">[ date ]</a>
              <a href="thread.html#15527">[ thread ]</a>
              <a href="subject.html#15527">[ subject ]</a>
              <a href="author.html#15527">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

 

I have multiple domains but only a single IP address and I'd like to support
encrypted connections for certain operations like login, credit card info,
secure file upload and download, etc.  I've heard a lot about how SSL can't
be used with name based virtual hosting but I'm still looking for a solution
that does not force me to set up a separate IP for each domain that has
needs for secure operations.  I've had a couple of ideas that I think might
work but I'd like a few other smart folks to bounce the idea off if
possible.

 

 

 

1.  IPTABLES + APACHE REVERSE PROXY + MULTIPLE INTERNAL WEB SERVERS

 

There are two domains.  domain1 and domain2 both mapped to the internet
address inet_ip by dns.

 

The firewallServer located at inet_ip (internally this is internal_ip_4) has
iptables installed and running.

There is an iptables rule that redirects all traffic with a destination of
inet_ip:443 that is not part of an established connection to internal_ip_3

(not sure exactly how to write this yet.  Can anyone give a definitive
answer on whether it is possible and how?  If not, I'll look into it as time
permits)

Internal_ip_3 is running an apache server with name based virtual hosts and
reverse proxy rules set up to map domain1 to internal_ip_1 and domain2 to
internal_ip_2

Internal_ip_1 is running an apache server set up with SSL and a certificate
for domain1

Internal_ip_2 is running an apache server set up with SSL and a certificate
for domain2

 

 

I'm not sure if this is accurate, but I was thinking that if a client were
to make a request to <A HREF="https://www.domain1.com">https://www.domain1.com</A> &lt;<A HREF="https://www.domain1.com/">https://www.domain1.com/</A>&gt; 

the initial packet would come into the firewall server and be routed to
internal_ip_3.

I was also thinking that at this point the connection has not yet been made
to the destination server so no encryption has actually been performed.

This would allow Apache to freely read the header information.

If this is correct, SSL shouldn't actually need to be installed on the
internal_ip_3 server and port 443 could be set up as a standard http server

 

OK, the above is one of the key points in this method of supporting SSL.
Please let me know if you know this won't work.

 

If the above is true, progress continues by the initial packet being routed
to the internal_ip_1 server.

This server has Apache set up with SSL and a certificate for domain1

The request is received and the handshake is performed.

Finally, the response from Apache on internal_ip_2 is encrypted with the
certificate for domain1 and returned to the client.

 

Further requests come in from client1 that are encrypted but due to the fact
that they are part of 

an established connection they are routed appropriately to the machine the
client previously connected to.

This is the second key question.  Will conntrack actual be able to do this
mapping with an encrypted packet.  If it can't the whole thing falls apart.

 

If this doesn't work exactly as is, would doing an SNAT when incoming
packets hit the firewallServer and the reverseProxy allow it to work?

 

Ok, that's that was my first attempt to design a solution.

 

 

 

next.

 

2.  ONE DOMAIN WITH SSL ENABLED THAT IS LEVERAGED FOR ALL LOGINS AND OTHER
SECURE REQUIREMENTS

 

I haven't worked out all of the details on this but it seems like it should
be pretty manageable

to have the site that needs secure services pass a site id and perhaps an
original URL to the secure site.

This should allow the secure site to brand the pages and fulfill secure
services with things like site specific user lists and redirects to the
referring page.

 

This seems like a pretty workable solution with the key drawbacks being some
confusion and potentially paranoia

on the part of the user due to the URL not being part of the original domain
and some additional coding and deployment complexity

due to the fact that the functionality of a &quot;site&quot; would really be split
across multiple domains.

With any luck,  proper branding could reduce the user confusion and proper
architecture and documentation would make it easier for developers to
implement.

 

OK, that's the second attempt.

 

 

 

I'd really appreciate any input anyone has.

 

Thanks,

 

 

 

 

Jeff

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.nyphp.org/pipermail/talk/attachments/20050806/53f1e66f/attachment.html">http://lists.nyphp.org/pipermail/talk/attachments/20050806/53f1e66f/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015521.html">[nycphp-talk] AWStats vs Webalizer - more experience
</A></li>
	<LI>Next message: <A HREF="015549.html">[nycphp-talk] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15527">[ date ]</a>
              <a href="thread.html#15527">[ thread ]</a>
              <a href="subject.html#15527">[ subject ]</a>
              <a href="author.html#15527">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
