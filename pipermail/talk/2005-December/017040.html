<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] crypt() issue
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2005-December/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20crypt%28%29%20issue&In-Reply-To=%3C43A35BBB.7010008%40neuropunks.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017057.html">
   <LINK REL="Next"  HREF="017041.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] crypt() issue</H1>
    <B>Max Gribov</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20crypt%28%29%20issue&In-Reply-To=%3C43A35BBB.7010008%40neuropunks.org%3E"
       TITLE="[nycphp-talk] crypt() issue">max at neuropunks.org
       </A><BR>
    <I>Fri Dec 16 19:28:43 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017057.html">[nycphp-talk] December Meeting or Party?
</A></li>
        <LI>Next message: <A HREF="017041.html">[nycphp-talk] crypt() issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17040">[ date ]</a>
              <a href="thread.html#17040">[ thread ]</a>
              <a href="subject.html#17040">[ subject ]</a>
              <a href="author.html#17040">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
Strange issue, cant figure out what Im doing wrong.

I have users sign up, and then add their password into database after
running
$passwd = crypt($post['passwd1']);
$user-&gt;create($post['username'], $passwd, $post['email']);

The user class handles the creation fine, there is a crypt'ed entry in
the password field in the DB.
Then, I am trying to authenticate a user on login like so:

In index.php:
$user-&gt;login($post[username], $post[password],
$_SERVER[HTTP_USER_AGENT], 'user');

In classes file for User class:
public function login($username, $password, $user_agent, $realm) {
    $this-&gt;username = $username;
    $this-&gt;password = $password;
    $sql = &quot;select password from users where username='$this-&gt;username'
and admin='f'&quot;;
    $db_res = $this-&gt;db-&gt;Execute($sql);
    if (crypt($this-&gt;password, $db_res-&gt;fields['password']) !=
$db_res-&gt;fields['password']) {
        $this-&gt;error = &quot;Invalid username/password &quot;;
        return false;
    } else {
        // set session vars, redirect, etc
    }
}

$post is the processed array of $_POST but its not being modified when
processed, only checked for invalid input and the program will die() if
it doesnt comply.

So basically,
crypt($post['passwd1'])
during signup creates one value, but

crypt($this-&gt;password, $db_res-&gt;fields['password'])
during authentication returns a different, although always the same, value.

I have exactly same code, in index.php and in classes file and in SQL
command in other apps, and it works without a problem.
I am starting to get lost here, I basically copy/paste all the auth
code, and it stops working.
I checked if input from $_POST is being modified anywhere, and its not.

If anyone wants to see the code in action, look at
<A HREF="http://www.angrycollegekid.com/index.php?a=signup,">http://www.angrycollegekid.com/index.php?a=signup,</A> signup for an account
and then try to login, or just use crap/crap for testing.
There are debugs of what you enter, what first crypt() returns, and what
is actually stored in the DB.

(sorry for spamming with the actual domain name)

max

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017057.html">[nycphp-talk] December Meeting or Party?
</A></li>
	<LI>Next message: <A HREF="017041.html">[nycphp-talk] crypt() issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17040">[ date ]</a>
              <a href="thread.html#17040">[ thread ]</a>
              <a href="subject.html#17040">[ subject ]</a>
              <a href="author.html#17040">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
