<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>
   <TITLE> [nycphp-talk] memory_get_usage() on win32
   </TITLE>
   <LINK REL="Index" HREF="http://nyphp.org/pipermail/talk/2004-April/index.html" >
   <LINK REL="made" HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20memory_get_usage%28%29%20on%20win32&In-Reply-To=%3C34992.69.31.90.22.1080850091.squirrel%40www.bebinary.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008698.html">
   <LINK REL="Next"  HREF="008722.html">
 <meta name="description" content="PHP jobs stackware web application support and development forums for Mongo LAMP MySQL SQL Windows IIS Linux." />
<meta name="author" content="Stackware Web Development - http://stackware.com" />
<meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
<meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
<meta name="y_key" content="265502be3db4fb6e" />
</HEAD>
         <BODY BGCOLOR="#ffffff">
<h1 style="float: right; margin: 0; padding: 0 0 0 15px;"><a href="https://www.meetup.com/new-york-php/">NYCPHP Meetup</a></h1><h1><a href="http://www.nyphp.org">NYPHP.org</a></h1>
   <H1>[nycphp-talk] memory_get_usage() on win32</H1>
    <B>felix zaslavskiy</B> 
    <A HREF="mailto:talk%40lists.nyphp.org?Subject=Re:%20Re%3A%20%5Bnyphp-talk%5D%20memory_get_usage%28%29%20on%20win32&In-Reply-To=%3C34992.69.31.90.22.1080850091.squirrel%40www.bebinary.com%3E"
       TITLE="[nycphp-talk] memory_get_usage() on win32">felix at bebinary.com
       </A><BR>
    <I>Thu Apr  1 15:08:11 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="008698.html">[nycphp-talk] memory_get_usage() on win32
</A></li>
        <LI>Next message: <A HREF="008722.html">[nycphp-talk] memory_get_usage() on win32
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8718">[ date ]</a>
              <a href="thread.html#8718">[ thread ]</a>
              <a href="subject.html#8718">[ subject ]</a>
              <a href="author.html#8718">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I did some test on Linux/mysql4.0.18/php4.3.4

I rewrote the program a bit though , see below.
The memory climbed from initial of Virtual 26680 Resident 9460 to Virtual
26796 Resident 9488. So that is 116KB virual mem increas and 28KB resident
memory increase. What interesting it climbs gradually for about first 200
iterations and then stops climbing. Also after DB stuff is done and only
fake work is done then it does not affect the memory size.

I didnt not use memory_get_usage because my php is not compiled for it. I
dont think this is a memroy leak because it seems like normal operation of
php garbage collection. I would expect the internal tables to grow to some
initial size and not be released at all. Just because a reference is unset
does not mean php has to release the actual memory. Maybe someone with
better internal knowledge of php can understand this better.

My modified test program:
 #!/usr/bin/php -q
&lt;?php
include 'DB.php';
$db_object = &amp;DB::connect('<A HREF="mysql://root:secret@localhost/test">mysql://root:secret@localhost/test</A>',TRUE);
$db_object-&gt;setFetchMode(DB_FETCHMODE_ASSOC);
   $count = 0;
   $ref= null;
   $row = null;
function fake_work(){
    $t = array();
    for($x=0;$x &lt; 150; $x++){
        $t[] = $x + 4 + time() + count($t) -
strlen(md5(uniqid(rand()).time())) + rand()%20;
    }
    for($x=149; $x &gt;= 0; $x--){
        unset($t[$x]);
    }
    unset($t);
}
while($count &lt;= 500)
{
    usleep(5000);//dont go crazy
    $res=&amp;$db_object-&gt;query( &quot;select linkid from test2 where linkid=2&quot; );
    $row=&amp;$res-&gt;fetchRow();
    //this is a dumbed down version, but does the memleak
    $res-&gt;free();
    unset($row);
    unset($res);
    $count++;
    //lets do some other fake work
    fake_work();

    echo &quot;tick $count \n&quot;;
     //echo memory_get_usage().&quot;\n&quot;;
}
fake_work();
unset($db_object);
for($x = 0; $x &lt; 100; $x++)
{   usleep(5000); fake_work(); }
//its kind of useless because it does not let php run
echo &quot;end of run sleeping for 5 seconds\n&quot;;
sleep(5);
?&gt;

&gt;<i> Someon reported a bug in DB about a memory leak
</I>&gt;<i> (<A HREF="http://pear.php.net/bugs/bug.php?id=1112">http://pear.php.net/bugs/bug.php?id=1112</A>)
</I>&gt;<i>
</I>&gt;<i> Their example uses memory_get_usage(), which isn't enabled on Win32
</I>&gt;<i> systems (unless, I guess, I compile my own with the --enable-memory-limit
</I>&gt;<i> configuration option).  Any ideas how I can track memory usage some other
</I>&gt;<i> way via PHP?
</I>&gt;<i>
</I>&gt;<i> Know what, it probably doesn't matter.  I've watched the process via the
</I>&gt;<i> Task Manger's process list (Windows 2000 Pro) and the memory usage doesn't
</I>&gt;<i> increase even after several itterations of the loop.  So he may be having
</I>&gt;<i> a problem due to his OS/PHP/MySQL combination.
</I>&gt;<i>
</I>&gt;<i> Anyone feel like testing it on other platforms?
</I>&gt;<i>
</I>&gt;<i> Other thoughts?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> --Dan
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>  T H E   A N A L Y S I S   A N D   S O L U T I O N S   C O M P A N Y
</I>&gt;<i>             data intensive web and database programming
</I>&gt;<i>                 <A HREF="http://www.AnalysisAndSolutions.com/">http://www.AnalysisAndSolutions.com/</A>
</I>&gt;<i>  4015 7th Ave #4, Brooklyn NY 11232  v: 718-854-0335 f: 718-854-0409
</I>&gt;<i> _______________________________________________
</I>&gt;<i> talk mailing list
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">talk at lists.nyphp.org</A>
</I>&gt;<i> <A HREF="http://lists.nyphp.org/mailman/listinfo/talk">http://lists.nyphp.org/mailman/listinfo/talk</A>
</I>&gt;<i>
</I>

-- 
Felix Zaslavskiy
<A HREF="http://lists.nyphp.org/mailman/listinfo/talk">felix at bebinary.com</A>
(718) 576-1923
<A HREF="http://www.zaslavskiy.net">http://www.zaslavskiy.net</A>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008698.html">[nycphp-talk] memory_get_usage() on win32
</A></li>
	<LI>Next message: <A HREF="008722.html">[nycphp-talk] memory_get_usage() on win32
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8718">[ date ]</a>
              <a href="thread.html#8718">[ thread ]</a>
              <a href="subject.html#8718">[ subject ]</a>
              <a href="author.html#8718">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.nyphp.org/mailman/listinfo/talk">More information about the talk
mailing list</a><br>
</body></html>
