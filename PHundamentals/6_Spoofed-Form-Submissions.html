<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-51353372-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-51353372-3');
</script>

    <script src="http://cdn.speedr.io/speeder.js"></script>
    <script>speeder('55730cc6','df9');</script>
    
    <meta name="verify-v1" content="zWMoPwMn/dolscLkjLXTpRqgr9K8bzlzL1vM9WTjpHc=" />
    <meta name="msvalidate.01" content="F85F81C1D0BAB5C349E8395628845E27" />
    <meta name="y_key" content="265502be3db4fb6e" />

    <link rel="icon" type="image/vnd.microsoft.icon" href="/img/favicon.ico">

    <title>Spoofed Form Submissions - PHundamental PHP Best Practices -</title>

    <link href="../css/nyphp2.css" rel="stylesheet" media="screen" type="text/css" />
    <link href="../css/nyphp2_print.css" rel="stylesheet" media="print" type="text/css" />

    <meta name="robots" content="index,follow" />
    <meta name="description" content="Spoofed Form Submissions - PHP best practices and LAMP stack strategy." />
    <meta name="author" content="Stackware Web Development - http://stackware.com" />
</head>


<body>


<div id="GlobalContainer">

    <div id="Header">
        
<div class="HeaderContainer">
    <div class="HeaderLeft">
        <a href="../index.html"><img src="../img/new_york_php.gif" alt="New York PHP User Group Community" /></a>
    </div>
    <div class="HeaderRight">
        <h1><a href="http://stackware.com/nyc-php-training">PHP Training</a></h1>
    </div>
    <div class="HeaderFirstBar" style="padding: 0; margin: 0 0 0 -6px;">
    <ul>
        <li>
            <a  href="../index.html" title="Home">Home</a>
        </li>
        <li>
            <a  href="../mailing-lists.html" title="PHP Mailing Lists">Mailing Lists</a>
        </li>
        <li>
            <a style="text-decoration: underline;" href="../phunny/err_sample_include.php.html" title="PHundamentals">PHundamentals</a>
        </li>
        <li>
            <a  href="../php-presentations/index.html" title="Presentations">Presentations</a>
        </li>
        <li>
            <a href="http://www.meetup.com/new-york-php/" title="NY PHP Meetup">Contact Us</a>
        </li>
    </ul>
    </div>

    <div class="HeaderSecondBar">
        <div style="margin: 11px 0 0 -4px; padding: 0;">
        <small>don't forget to</small>
        <a style="font-weight: bold;" href="https://www.facebook.com/groups/367255050049061/">facebook friend</a> -
        <a style="font-weight: bold;" href="http://twitter.com/nyphp">twitter follow</a> -
        <a style="font-weight: bold;" href="http://www.meetup.com/new-york-php/">NYC PHP meetup</a>
        </div>
    </div>
</div>



    </div>

    <div id="MainLayout">
    <div id="TwoColumn">
        <div id="LeftColumn">
            
<div class="LeftNav">

    <div class="NowLinks">


        <div class="ShowParticipation">
        <a href="../show-participation.html">Show Your Participation
        <img style="margin: 2px;" alt="NYPHP Member" src="../img/nyphporgmember.gif" />
        Click for Details</a>
        </div>

        <div style="height: 15px;"></div>

    </div>

    <div style="height: 15px;"></div>

<div class="LeftNavSection">

    <div class="LeftNavSubSection">
        <a target="_blank" href="https://www.meetup.com/tampa-bay-php/">
            <img width="120px" src="../img/tbphp.gif" alt="Tampa Bay Florida PHP" title="Tampa Bay Florida PHP" />
        </a>
        <a target="_blank" title="Tampa Bay Florida PHP" href="http://www.tbphp.org/">
            Tampa Bay<br />Florida PHP
        </a>
    </div>


    <div class="LeftNavSubSection">
        <a href="http://www.flickr.com/groups/nyphp/">
        <img src="../img/flickr.logo.gif" alt="NYPHP flickr Group" title="New York PHP flickr Group" />
        </a>
        Browse and upload photos of events, at the
        <a href="http://www.flickr.com/groups/nyphp/">NYPHP flickr Group</a>.
    </div>
    <div class="LeftNavSubSection">
        <a href="http://www.linkedin.com/e/gis/110439">
        <img src="../img/linkedin.logo.gif" alt="PHP Community" title="New York PHP Community LinkedIn" />
        </a>
        Link up with NYPHP at the
        <a href="http://www.linkedin.com/groups?about=&amp;gid=110439">PHP LinkedIn Group</a>.
    </div>

</div>


<div class="BoxLinks" style="text-align: left;">
    <p class="BoxLinkHeader">About NYPHP</p>
    <p><a href="../about-us/charter.html">&raquo; Charter</a></p>
    <p><a href="../about-us/mission.html">&raquo; Mission</a></p>
    <p><a href="../about-us/index.html">&raquo; What is NYPHP?</a></p>
    <p><a href="../about-us/principals.html">&raquo; Principals</a></p>
    <p><a href="../about-us/sponsors.html">&raquo; Sponsors</a></p>
</div>


</div>

            <div class="SubLeftColumn">
            
<div class="Event">

<h1>Spoofed Form Submissions</h1>
<h2>NYPHP - <span style="color: rgb(0, 0, 153);">PH</span>undamentals</h2>

<h3>PROBLEM:</h3>
<p>
Almost every website has an HTML form for visitors to complete.
But how do you know that the person who completed the form did so
through your website? That is, how do you make sure that no one has 'spoofed', i.e.,
'forged', a form submission?
</p>
<h3>BACKGROUND INFORMATION: SPOOFING SUBMISSIONS &amp; FORGING REQUESTS</h3>
<p>
<h3>METHOD 1: Spoofing Submissions</h3>
</p>
<p>
How can you &quot;spoof&quot; a form submission?
</p>
<p>
Let's assume you have the following HTML form that is located
at http://yourdomain.org/form.php:
</p>
<pre>
	&lt;form action="/submit.php&quot; method=&quot;post&quot;&gt;
	&lt;select name=&quot;myvar&quot;&gt;
		 &lt;option value=&quot;foo&quot;&gt;foo&lt;/option&gt;
		 &lt;option value=&quot;bar&quot;&gt;bar&lt;/option&gt;
	&lt;/select&gt;
	&lt;input type=&quot;submit&quot;&gt;
	&lt;/form&gt;
</pre>
<p>
It would seem safe to assume that you will be able to reference
$_POST['myvar'] and it will have a value of either &quot;foo&quot; or &quot;bar.&quot;
Assuming the user selects &quot;foo,&quot; the request will look something like this:
</p>
<pre>
	POST /submit.php HTTP/1.1
	Host: example.org
	Content-Type: application/x-www-form-urlencoded
	Content-Length: 9

	myvar=foo
</pre>
<p>
Now let's assume that someone does the following:
<ol>
	<li>Saves your form from their browser to their desktop.</li>
	<li>Opens the &quot;saved&quot; HTML file and makes the following alterations:
		<ol>
			<li>Modifies the &quot;action&quot; tag so that it now contains the full URL to the form.</li>
			<li>Removes the &quot;select&quot; tag and replaces it with a &quot;textarea&quot; tag.
		</ol>
</ol>
<br>
This person would then have a form that looks like the following:
<pre>

	&lt;form action=&quot;http://yourdomain.org/submit.php&quot; method=&quot;post&quot;&gt;
	&lt;textarea name=&quot;myvar&quot;&gt;&lt;/textarea&gt;
	&lt;input type=&quot;submit&quot;&gt;
	&lt;/form&gt;
</pre>
<br>
</p>
<p>
With this simple form, this person can now submit <strong>anything</strong> as
the value of $_POST['myvar']. In fact, there was nothing to prevent the
person who manipulated your form from including unexpected form variables or anything
that can be achieved with an HTML form.
</p>
<p>
<h3>METHOD 2: Forging HTTP Requests</h3>
</p>
<p>
More sophisticated attacks might just use raw HTTP rather than bothering
to generate or modify a form for every desired type of attack. You can telnet to
port 80 and type your requests. Below is a sample request for logging into the
NYPHP forum.
</p>
<pre>
	POST /index.php?act=Login&CODE=01&CookieDate=1 HTTP/1.1
	Host: forums.nyphp.org
	Connection: close
	Referer: http://forums.nyphp.org/
	Cookie: session_id=12345
	Content-Type: application/x-www-form-urlencoded
	Content-Length: 44

	UserName=myname&PassWord=mypass&CookieDate=1
</pre>
<p>
To use these raw requests, you would need to change three items.
<ol>
	<li>Change &quot;myname&quot; to be <strong>your</strong> &quot;username.&quot;</li>
	<li>Change &quot;mypass&quot; to be <strong>your</strong> &quot;password.&quot;</li>
	<li>Change &quot;session_id&quot; to the necessary value.</li>
	<li>Finally, change the the &quot;Content-Length&quot; to be the new length of the POST data.</li>
</ol>
<p>
<br>
A more advanced form of attack leaves out the typing and uses specific software
written to automate attacks.
</p>
<h3>SOLUTION:</h3>
<p>
Since, from a strict protocol perspective, the only thing you know is that HTTP requests and responses
are going back and forth, there is no definitive way to know that a form submission has not been &quot;spoofed&quot;.
Therefore, our recommended &quot;best practice&quot; reduces the possibility of a spoofed form submission by
relying on the use of a &quot;shared secret&quot; and, reducing the possiblity of unwanted values being
submitted by outlining a general architecture for handling data and forms. (See Note 1)
</p>
<h3>A) SHARED SECRETS:</h3>
<p>Also referred to as one-time tokens or hashes, the idea is typically the same. You create a secret that is intended to only be known by the server and the legitimate user.
Implementations vary widely but they share the characteristics of being 
transparent to your users and difficult to exploit.
</p>
<p>
One implementation would be to store the secret in the user's session:
</p>
<pre>
	$secret = md5(uniqid(rand(), true));
	$_SESSION['secret'] = $secret;
</pre>
<p>
This would then be used as a hidden form variable in the form:
</p>
<pre>
	&lt;input type=&quot;hidden&quot; name=&quot;secret&quot; value=&quot;&lt;? echo $secret; ?&gt;&quot; /&gt;
</pre>
<p>
Every time you display the form, you would regenerate this secret, so
that the user always has a current, fresh, and correct secret.
</p>
<p>
The receiving page can check this by comparing the &quot;secret&quot; sent by the form with the &quot;secret&quot; that was stored in the corresponding session variable.
You can improve the security of this method by restricting the timeout window rather than relying on the
session timeout, which might be too large for your needs.
</p>

<h3>B) KNOWING WHAT TO EXPECT:</h3>
<p>
A solid &quot;architecture&quot; would assure that:
<ol>
	<li><strong>You know what you are sending out</strong>
		<br>Keep track of forms you've put on your site and develop a policy
		for accepting form submittals (for instance
		time outs, multiple forms per user id, multiple submissions, not
		accepting forms you don't expect, etc).
		This can be implemented using tokens.(See Note 2)
	</li>
	<li><strong>You know what you should be getting back (see Note 3)</strong>
		<br>This is crucial. Just because a &lt;select&gt; field contains
			certain values, don't think you can't get back something
			<strong>totally different</strong> such as as PHP code, SQL, etc.
			<ol>
				<li>know the fields you need to have back to accept the form as valid</li>
				<li>restrict exactly what values you'd accept as input</li>
				<li>always minimize taking data from forms (or any external
					source) and using it directly in database queries, or other inner and
					intimate parts of your application.</li>
			</ol>
</ol>

</p>
<h3>Notes:</h3>
<p>
	1 - A bad practice is the use of &quot;generic&quot; form handling scripts that
	rely on hidden form values to determine what form fields may be required, etc. Any user can, using the
	&quot;Spoofed Form&quot; technique noted earlier, manipulate the submitted values.
</p>
<p>
	2 - Some have suggested the use of a CAPTCHA as a method to eliminate spoofed form submissions.
	Unfortunately it does not eliminate spoofed form submissions. The original intent of the use of CAPTCHAs
	was to determine if a human being, not a webbot, has filled out a form. However, CAPTCHAs can be of use in
	reducing the possibility of a website being flooded with form submissions since it effectively slows
	down the rate at which those forms can be submitted.
	<br>
	<br>
	Nonetheless, CAPTCHAs - especially those that rely on letter and numbers - can be circumvented. One technique
	utilizes a form of OCR using something like GOCR (see: <a href="http://jocr.sourceforge.net/" target="_blank">
	http://jocr.sourceforge.net/</a>.
	<br>
	<br>
	To learn more about CAPTCHAs, see <a href="http://www.captcha.net/" target="_blank">http://www.captcha.net/</a>.
	See also, on captcha.net, the section that describes the use of pictures instead of text.

</p>
<p>
	3- Be sure you know which variables contain the values you want and whether you are inadvertently
	relying on <i>register_globals</i>. Though as of PHP 4.2.0 this particular
	ini setting is &quot;OFF&quot; by default, nonetheless, it is still common for this setting to be
	&quot;ON&quot; in shared server environments (some open source applications require <i>register_globals</i>
	to be on). It's considered &quot;best practice&quot; to write your code with the assumption
	that <i>register_globals</i> is off. For more information, see <a href="http://php.net/manual/security.globals.php" target="_blank">http://php.net/manual/security.globals.php</a>.
</p>
<hr />
<p>
Contributors to this note include the following:<br />
Jon Baer<br />
Dan Cech<br />
Joel De Gan<br />
Chris Shiflett<br />
Hans Zaunere<br />
the PHundamentals Team: Jeff Siegel, Michael Southwell<br />
</p>

</div>

            </div>

        </div>
        <div id="RightColumn">
            

<div class="RightColumnContent">

   
   
       <div class="MiniCal" style="margin: 0px 0 15px 0;">

        <h2>RELATED ARTICLES</h2>
               <div class="MiniCalOdd">
            <p>
                <a title="From Zero to AMP with XAMPP - Installing PHP and MySQL on Windows with XAMPP" href="../PHundamentals/0_Zero-AMP-XAMPP-Installing-PHP-MySQL-Windows.html">From Zero to AMP with XAMPP - Installing PHP and MySQL on Windows with XAMPP</a>
            </p>
        </div>
               <div class="MiniCalEven">
            <p>
                <a title="PHP Initialization and php.ini" href="../PHundamentals/1_PHP-Initialization-phpini.html">PHP Initialization and php.ini</a>
            </p>
        </div>
               <div class="MiniCalOdd">
            <p>
                <a title="Virtual Hosting with PHP" href="../PHundamentals/2_Virtual-Hosting-PHP.html">Virtual Hosting with PHP</a>
            </p>
        </div>
               <div class="MiniCalEven">
            <p>
                <a title="PHP Site Structure: Where to Locate Includes?" href="../PHundamentals/3_PHP-Site-Structure-Where-Locate-Includes.html">PHP Site Structure: Where to Locate Includes?</a>
            </p>
        </div>
               <div class="MiniCalOdd">
            <p>
                <a title="Variable Evaluation in PHP" href="../PHundamentals/4_Variable-Evaluation-in-PHP.html">Variable Evaluation in PHP</a>
            </p>
        </div>
               <div class="MiniCalEven">
            <p>
                <a title="Storing Data Submitted From a Form and Displaying Data from a Database" href="../PHundamentals/5_Storing-Data-Submitted-Form-Displaying-Database.html">Storing Data Submitted From a Form and Displaying Data from a Database</a>
            </p>
        </div>
               <div class="MiniCalOdd">
            <p>
                <a title="Spoofed Form Submissions" href="../PHundamentals/6_Spoofed-Form-Submissions.html">Spoofed Form Submissions</a>
            </p>
        </div>
               <div class="MiniCalEven">
            <p>
                <a title="PHP Error Handling" href="../PHundamentals/7_PHP-Error-Handling.html">PHP Error Handling</a>
            </p>
        </div>
               <div class="MiniCalOdd">
            <p>
                <a title="Preventing Email Header Injection" href="../PHundamentals/8_Preventing-Email-Header-Injection.html">Preventing Email Header Injection</a>
            </p>
        </div>
    </div>
   


    <div class="RightColumnSubSection" style="text-align: center; margin: 35px 0 25px 0; ">
        <a href="http://cnvyr.io/">
        <img src="../img/cnvyrio.logo.sm.png" alt="CSS JS minify thumbnail maker online API" title="CSS JS minify thumbnail maker online API" />
        </a>
        <p><a href="http://cnvyr.io/">free PHP thumbnail maker CSS &amp; Javascript minify gzip pipeline online API and console</a>
        <br />
        <br />Free API and developer tools console for PageSpeed optimization.
        </p>
    </div>



   
</div>

        </div>
    </div>
    </div>

    <div id="Footer">
        
<div style="float: left;">
11.7</div>

<a href="http://www.meetup.com/new-york-php">NYC PHP Meetup Community </a>
    </div>

</div>

</body>
</html>

